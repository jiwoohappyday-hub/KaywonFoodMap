<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>계원예술대학교 계미지도</title>
    <style>
        /* 기본 리셋 및 폰트 설정 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans KR', 'Noto Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background-color: #F2F4F7;
            color: #111827;
            margin: 0;
            padding: 0;
            width: 100%;
            max-width: 375px;
            margin: 0 auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 화면 전환용 기본 스타일 */
        .screen {
            display: none;
            min-height: 100vh;
            padding-bottom: 81px;
        }

        .screen.active {
            display: block;
        }

        /* 헤더 */
        .header {
            background-color: #F5F8F8;
            border-bottom: 1px solid #F3F4F6;
            width: 100%;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 375px;
            margin: 0 auto;
            padding: 18px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .header-title {
            font-size: 18px;
            line-height: 28px;
            font-weight: 400;
            color: #111827;
        }

        .notification-btn {
            width: 44px;
            height: 44px;
            background: transparent;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .notification-btn:hover {
            background-color: #F3F4F6;
        }

        .notification-btn img {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }

        /* 햄버거 메뉴 버튼 */
        .menu-toggle-btn {
            width: 44px;
            height: 44px;
            background: transparent;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 12px;
            transition: opacity 0.2s;
            color: #FFFFFF;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            flex-shrink: 0;
        }

        .menu-toggle-btn:hover {
            opacity: 0.8;
        }

        .menu-toggle-btn svg {
            width: 20px;
            height: 20px;
        }

        /* 정렬 메뉴 컨테이너 (카테고리 아래) */
        .sort-menu-container {
            margin: 0 20px 16px 20px;
            z-index: 150;
        }

        /* 정렬 메뉴 드롭다운 */
        .sort-menu-dropdown {
            background: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.15);
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }


        .sort-menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            color: #111827;
            transition: all 0.2s;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .sort-menu-item:hover {
            background-color: #FFF5F5;
        }

        .sort-menu-item.active {
            background-color: #FFF5F5;
            color: #FD4B21;
            font-weight: 700;
        }

        .sort-menu-item svg {
            width: 16px;
            height: 16px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .sort-menu-item.active svg {
            opacity: 1;
        }

        /* 메인 콘텐츠 */
        .main-content {
            padding: 24px 20px;
            max-width: 375px;
            margin: 0 auto;
        }

        /* 제목 섹션 */
        .title-section {
            margin-bottom: 24px;
        }

        .title-line {
            font-size: 24px;
            line-height: 32px;
            font-weight: 400;
            color: #000000;
            margin: 0;
        }

        /* 카테고리 그리드 */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 32px;
        }

        .category-btn {
            background-color: #FF4500;
            border: none;
            border-radius: 16px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
            transition: all 0.2s;
            touch-action: manipulation; /* 모바일 터치 지연 제거 */
            -webkit-tap-highlight-color: transparent; /* 모바일 탭 하이라이트 제거 */
            user-select: none; /* 텍스트 선택 방지 */
        }

        .category-btn:active {
            transform: scale(0.98);
        }

        .category-text {
            color: #FFFFFF;
            font-size: 20px;
            font-weight: 400;
            text-align: center;
        }

        /* 랜덤 추천 섹션 */
        .random-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 1) 0%);
            border-radius: 16px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1);
        }

        .random-icon-wrapper {
            width: 80px;
            height: 80px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .random-icon-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .random-title {
            font-size: 18px;
            line-height: 28px;
            font-weight: 400;
            color: #111827;
            text-align: center;
            margin-bottom: 8px;
        }

        .random-subtitle {
            font-size: 14px;
            line-height: 20px;
            font-weight: 400;
            color: #4B5563;
            text-align: center;
            margin-bottom: 16px;
        }

        .random-btn {
            width: 100%;
            height: 48px;
            background-color: #FD4B21;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.05);
            transition: background-color 0.2s;
        }

        .random-btn:hover {
            background-color: #FF5939;
        }

        .random-btn:active {
            transform: scale(0.98);
        }

        .random-btn-text {
            color: #FFFFFF;
            font-size: 16px;
            font-weight: 400;
            text-align: center;
        }

        /* 랜덤 추천 결과 표시 */
        .random-result {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .random-result.show {
            display: flex;
        }

        .random-section.hide-content .random-icon-wrapper,
        .random-section.hide-content .random-title,
        .random-section.hide-content .random-subtitle,
        .random-section.hide-content .random-btn {
            display: none;
        }

        .random-food-result-image {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 0;
            margin-bottom: 16px;
            box-shadow: none;
            background: transparent;
            border: none;
            animation: scaleIn 0.5s ease;
        }

        .random-food-result-name {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            text-align: center;
            margin-bottom: 20px;
        }

        .random-retry-btn {
            width: 100%;
            height: 48px;
            background-color: #FD4B21;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.05);
            transition: background-color 0.2s;
            color: #FFFFFF;
            font-size: 16px;
            font-weight: 400;
            text-align: center;
        }

        .random-retry-btn:hover {
            background-color: #FF5939;
        }

        .random-retry-btn:active {
            transform: scale(0.98);
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* 랜덤 추천 모달 */
        .random-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .random-modal.show {
            display: flex;
        }

        .random-modal-content {
            background: #FFFFFF;
            border-radius: 24px;
            padding: 32px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .random-modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6B7280;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .random-modal-close:hover {
            background: #F3F4F6;
        }

        .random-food-image {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 16px;
            margin: 0 auto 24px;
            display: block;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            animation: scaleIn 0.5s ease;
        }

        .random-food-name {
            font-size: 24px;
            font-weight: 600;
            color: #111827;
            text-align: center;
            margin-bottom: 16px;
        }

        .random-food-description {
            font-size: 16px;
            color: #6B7280;
            text-align: center;
            margin-bottom: 24px;
        }

        .random-modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .random-modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .random-modal-btn-primary {
            background: #FD4B21;
            color: #FFFFFF;
        }

        .random-modal-btn-primary:hover {
            background: #FF5939;
        }

        .random-modal-btn-secondary {
            background: #F3F4F6;
            color: #374151;
        }

        .random-modal-btn-secondary:hover {
            background: #E5E7EB;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* 하단 네비게이션 */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 375px;
            background-color: #FFFFFF;
            border-top: 1px solid #E5E7EB;
            z-index: 100;
            display: none; /* 기본적으로 숨김 */
        }
        
        .bottom-nav.show {
            display: block !important; /* 홈 화면에서만 표시 */
        }

        .nav-content {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 9px 0;
            max-width: 375px;
            margin: 0 auto;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px;
            transition: color 0.2s;
            touch-action: manipulation; /* 모바일 터치 지연 제거 */
            -webkit-tap-highlight-color: transparent; /* 모바일 탭 하이라이트 제거 */
            user-select: none; /* 텍스트 선택 방지 */
        }

        .nav-item svg {
            width: 23px;
            height: 20px;
        }

        .nav-item.active {
            color: #FC7951;
        }

        .nav-item:not(.active) {
            color: #9CA3AF;
        }

        .nav-label {
            font-size: 12px;
            line-height: 16px;
            font-weight: 400;
        }

        /* 기록 화면 스타일 */
        .back-btn {
            background: transparent;
            border: none;
            padding: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
        }

        .back-btn svg {
            width: 24px;
            height: 24px;
            color: #111827;
        }

        .meal-record-form {
            background: #F2F4F7;
            padding: 20px;
            max-width: 375px;
            margin: 0 auto;
            padding-bottom: 100px;
        }

        .card-content {
            background: #F2F4F7;
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0px 4px 6px -4px rgba(0, 0, 0, 0.1), 0px 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
                        transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
                        max-height 0.5s ease-out,
                        margin-bottom 0.4s ease-out;
            /* 기본적으로 보이도록 설정 */
            opacity: 1;
            transform: translateY(0);
        }
        
        /* 숨겨진 섹션 (display: none이 있는 경우) */
        .card-content[style*="display: none"] {
            opacity: 0;
            transform: translateY(-10px);
            max-height: 0;
            overflow: hidden;
            margin-bottom: 0;
            padding: 0;
        }
        
        /* 표시되는 섹션 (show 클래스가 추가되거나 display: none이 없는 경우) */
        .card-content.show {
            opacity: 1;
            transform: translateY(0);
            max-height: 2000px;
            margin-bottom: 16px;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding: 2px 0;
            font-size: 14px;
            font-weight: 400;
            color: #000000;
            min-height: 28px;
            overflow: visible;
        }

        .form-label svg {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
            overflow: visible;
            display: block;
            overflow: visible;
        }

        .required {
            color: #FF6B4A;
            font-size: 16px;
        }

        .optional {
            color: #000000;
            font-size: 14px;
        }

        .form-select {
            width: 100%;
            background: #FFFFFF;
            border: none !important;
            border-radius: 12px;
            padding: 14px 16px;
            font-size: 15px;
            color: #111827;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%236B7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 12px;
            padding-right: 40px;
            box-shadow: none !important;
            outline: none !important;
        }
        
        /* 드롭다운 리스트 스타일 (브라우저 기본 스타일 제거) */
        .form-select::-ms-expand {
            display: none;
        }
        
        .form-select:focus::-ms-value {
            background: transparent;
            color: #111827;
        }

        .form-select:hover {
            background-color: #F9FAFB;
        }

        .form-select:focus,
        .form-select:active,
        .form-select:focus-visible,
        .form-select:focus-within {
            outline: none !important;
            border: none !important;
            box-shadow: none !important;
            background-color: #F9FAFB;
        }
        
        .form-select * {
            border: none !important;
            outline: none !important;
        }

        .form-select:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #F3F4F6;
        }

        .form-select option {
            background: #FFFFFF;
            color: #111827;
            padding: 12px;
            font-size: 15px;
            border: none;
        }

        .form-select option:hover {
            background: #F9FAFB;
        }

        .form-select option:checked,
        .form-select option:focus,
        .form-select option:active,
        .form-select option[selected] {
            background: #FD4B21 !important;
            background-color: #FD4B21 !important;
            color: #FFFFFF !important;
        }
        
        /* 드롭다운 리스트 배경과 경계선 제거 */
        .form-select optgroup,
        .form-select optgroup option {
            background: #FFFFFF;
            border: none;
            outline: none;
        }

        .form-input {
            width: 100%;
            background: #FFFFFF;
            border: 1px solid #CACED5;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 14px;
            color: #000000;
        }

        .form-input::placeholder {
            color: #9CA3AF;
        }

        .submit-custom-btn,
        .cancel-custom-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .submit-custom-btn {
            background: #FD4B21;
            color: #FFFFFF;
        }

        .submit-custom-btn:hover {
            background: #FF5939;
        }

        .cancel-custom-btn {
            background: #CACED5;
            color: #FFFFFF;
        }

        .cancel-custom-btn:hover {
            background: #9CA3AF;
        }

        .add-restaurant-btn,
        .add-keyword-btn {
            background: #CACED5;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #FFFFFF;
            cursor: pointer;
            width: 100%;
            justify-content: flex-start;
        }

        .form-description {
            color: #9CA3AF;
            font-size: 14px;
            line-height: 20px;
            margin-bottom: 12px;
        }

        .time-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .time-btn {
            background: rgba(253, 75, 33, 0.3);
            border: 1px solid rgba(255, 107, 74, 0.4);
            border-radius: 10px;
            padding: 12px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.2s;
        }

        .time-btn:hover {
            background: rgba(253, 75, 33, 0.5);
            color: rgba(255, 255, 255, 0.9);
        }

        .time-btn.active {
            background: #FD4B21;
            border: 2px solid #FF6B4A;
            color: #FFFFFF;
            box-shadow: 0 0 0 3px rgba(255, 107, 74, 0.4), 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: scale(1.02);
            font-weight: 600;
        }

        .mood-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .mood-btn {
            background: rgba(253, 75, 33, 0.3);
            border: 1px solid rgba(255, 107, 74, 0.4);
            border-radius: 14px;
            padding: 16px 8px;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s;
            overflow: visible;
            box-sizing: border-box;
        }

        .mood-btn:hover {
            background: rgba(253, 75, 33, 0.5);
        }

        .mood-btn.active {
            background: #FD4B21;
            border: 2px solid #FF6B4A;
            box-shadow: 0 0 0 3px rgba(255, 107, 74, 0.4), 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }

        .mood-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.2;
            white-space: nowrap;
        }

        .mood-btn.active .mood-label {
            color: #FFFFFF;
            font-weight: 600;
        }

        .mood-emoji {
            font-size: 32px;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            overflow: visible;
        }

        .rating-item {
            margin-bottom: 16px;
        }

        .rating-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
            color: rgba(0, 0, 0, 0.8);
        }

        .rating-score {
            color: #FF6B4A;
            font-size: 14px;
        }

        .rating-stars {
            display: flex;
            gap: 4px;
        }

        .star-btn {
            background: transparent;
            border: none;
            padding: 0;
            cursor: pointer;
            font-size: 32px;
            color: #FF6B4A;
            transition: all 0.2s;
            position: relative;
            opacity: 0.3;
        }

        .star-btn::before {
            content: '⭐';
            position: absolute;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .star-btn.active {
            color: #FF6B4A;
            opacity: 1;
        }

        .star-btn.active::before {
            opacity: 1;
        }

        .visual-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .visual-btn {
            background: rgba(253, 75, 33, 0.3);
            border: 1px solid rgba(255, 107, 74, 0.4);
            border-radius: 10px;
            padding: 12px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.2s;
        }

        .visual-btn:hover {
            background: rgba(253, 75, 33, 0.5);
            color: rgba(255, 255, 255, 0.9);
        }

        .visual-btn.active {
            background: #FD4B21;
            border: 2px solid #FF6B4A;
            color: #FFFFFF;
            box-shadow: 0 0 0 3px rgba(255, 107, 74, 0.4), 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: scale(1.02);
            font-weight: 600;
        }

        .keyword-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .keyword-badge {
            background: transparent;
            border: 2px solid #FD4B21;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 12px;
            color: #FD4B21;
            cursor: pointer;
            transition: all 0.2s;
        }

        .keyword-badge.active {
            background: #E63900;
            border: 2px solid #FF6B4A;
            color: #FFFFFF;
            box-shadow: 0 0 0 2px rgba(255, 107, 74, 0.3), 0 2px 4px rgba(0, 0, 0, 0.15);
            transform: scale(1.05);
            font-weight: 600;
        }

        .photo-upload {
            border: 1px dashed rgba(255, 255, 255, 0.2);
            border-radius: 14px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .photo-upload:hover {
            border-color: #FD4B21;
        }

        .photo-upload svg {
            width: 32px;
            height: 32px;
        }

        .photo-upload span {
            font-size: 14px;
            color: #CACED5;
        }

        .info-card {
            background: rgba(45, 45, 68, 0.5);
            border-radius: 14px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .info-card svg {
            width: 16px;
            height: 16px;
        }

        .info-card span {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
        }

        .submit-btn {
            width: 100%;
            background: #FD4B21;
            border: none;
            border-radius: 8px;
            padding: 14px;
            font-size: 14px;
            color: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 16px;
            touch-action: manipulation; /* 모바일 터치 지연 제거 */
            -webkit-tap-highlight-color: transparent; /* 모바일 탭 하이라이트 제거 */
            user-select: none; /* 텍스트 선택 방지 */
        }

        .submit-btn:hover {
            background: #FF5939;
        }

        .submit-btn:active {
            transform: scale(0.98);
        }

        /* 지도 화면 스타일 */
        #mapScreen {
            touch-action: pan-y; /* 수직 스크롤만 허용 */
            overscroll-behavior: none; /* 스크롤 바운스 효과 제거 */
            -webkit-overflow-scrolling: touch;
        }
        
        .map-filter-container {
            background: #FD4B21;
            border-radius: 16px;
            padding: 13px;
            margin: 20px;
            margin-top: 10px;
            box-shadow: 0px 25px 50px -12px rgba(0, 0, 0, 0.25);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .map-filter-buttons {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            flex-wrap: nowrap;
            scrollbar-width: none; /* Firefox */
            flex: 1;
        }

        .map-filter-buttons::-webkit-scrollbar {
            display: none;
        }

        .map-filter-btn {
            background: rgba(255, 255, 255, 0.5);
            border: none;
            border-radius: 14px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
            transition: all 0.2s;
            box-shadow: 0px 4px 6px -4px rgba(0, 0, 0, 0.1), 0px 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .map-filter-btn.active {
            background: rgba(255, 255, 255, 0.7);
            box-shadow: 0px 4px 15px 0px rgba(0, 0, 0, 0.2);
        }

        .map-filter-btn:not(.active) {
            background: rgba(255, 255, 255, 0.35);
        }

        .filter-emoji {
            font-size: 20px;
            line-height: 28px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
        }
        
        .filter-emoji img {
            width: 16px;
            height: 16px;
            object-fit: contain;
        }

        .filter-text {
            color: #FFFFFF;
            font-size: 14px;
            line-height: 20px;
        }

        .map-filter-btn.active .filter-text {
            color: #FD4B21;
            font-weight: 700;
        }

        .map-filter-btn:not(.active) .filter-text {
            color: rgba(255, 255, 255, 0.9);
        }

        .filter-badge {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 2px 8px;
            font-size: 12px;
            line-height: 16px;
            color: rgba(255, 255, 255, 0.95);
        }

        .map-filter-btn.active .filter-badge {
            background: rgba(255, 255, 255, 0.4);
            color: #FD4B21;
            font-weight: 700;
        }

        /* 카테고리별 식당 리스트 */
        .category-restaurant-list {
            padding: 20px;
            padding-bottom: 100px; /* 하단 네비게이션 바 공간 확보 */
            background: #FFFFFF;
        }
        
        /* 웹 환경 최적화 - 그리드 레이아웃 */
        @media (min-width: 768px) {
            .category-restaurant-list {
                padding: 30px 40px;
                max-width: 1200px;
                margin: 0 auto;
            }
            
            .category-restaurant-items {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 16px;
            }
            
            .restaurant-list-item {
                margin: 0;
            }
        }

        .category-section {
            margin-bottom: 32px;
        }

        .category-section:last-child {
            margin-bottom: 0;
        }

        .category-section-header {
            margin-bottom: 16px;
        }

        .category-section-title {
            color: #111827;
            font-size: 16px;
            font-weight: 600;
            margin: 0;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(255, 107, 74, 0.2);
        }
        
        .category-section-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .category-section-count {
            color: #FD4B21;
            font-size: 14px;
            margin-left: 4px;
            font-weight: 500;
        }

        .category-restaurant-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .map-view-container {
            position: relative;
            width: 100%;
            height: 40vh; /* 높이를 더 줄여서 빈 공간 최소화 */
            min-height: 300px;
            margin-top: 10px;
            touch-action: pan-y; /* 수직 스크롤만 허용 */
            overscroll-behavior: none; /* 스크롤 바운스 효과 제거 */
            -webkit-overflow-scrolling: touch;
        }

        .map-background {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #FFFFFF 0%, #F8FAFC 50%, #F1F5F9 100%);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: pan-y; /* 수직 스크롤만 허용 */
            overscroll-behavior: none; /* 스크롤 바운스 효과 제거 */
        }

        .map-background::before {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                radial-gradient(ellipse 800px 400px at 80% 20%, rgba(253, 107, 74, 0.08) 0%, transparent 40%),
                radial-gradient(ellipse 600px 300px at 20% 80%, rgba(100, 116, 139, 0.06) 0%, transparent 40%);
            pointer-events: none;
        }

        /* 배경 그리드 */
        .map-grid {
            position: absolute;
            inset: 0;
            opacity: 0;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            width: 100%;
            height: 100%;
        }

        .map-grid-cell {
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 지도 중앙 학교 마커 */
        .school-marker {
            display: none; /* 학교 마커 숨김 */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .school-marker-main {
            position: relative;
            width: 48px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .school-marker-main::before {
            content: '';
            position: absolute;
            width: 48px;
            height: 48px;
            background: white;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            border: 3px solid #FD4B21;
            box-shadow: 0px 6px 20px rgba(253, 75, 33, 0.25);
            z-index: -1;
        }

        .school-marker-label {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #111827;
            white-space: nowrap;
            background: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #E5E7EB;
        }

        /* 거리 범위 표시 - 숨김 */
        .distance-ring {
            display: none;
        }

        .distance-ring.green {
            display: none;
        }

        .distance-ring.yellow {
            display: none;
        }

        .distance-ring.orange {
            display: none;
            border: 1px dashed rgba(253, 107, 74, 0.08);
        }

        /* 범례 */
        .map-legend {
            display: none; /* 범례 숨김 */
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #FD4B21;
        }

        /* 식당 리스트 */
        .map-restaurant-list {
            padding: 20px;
            background: linear-gradient(180deg, #F2F4F7 0%, #FFFFFF 100%);
            max-height: 280px;
            overflow-y: auto;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .map-restaurant-list::-webkit-scrollbar {
            width: 6px;
        }

        .map-restaurant-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .map-restaurant-list::-webkit-scrollbar-thumb {
            background: #DDD;
            border-radius: 3px;
        }

        .list-header {
            margin-bottom: 16px;
        }

        .list-title {
            color: #111827;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin: 0;
        }

        .list-count {
            color: #FD4B21;
            font-size: 14px;
            margin-left: 4px;
            font-weight: 500;
        }

        .list-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .restaurant-list-item {
            background: #FFFFFF;
            border-radius: 14px;
            padding: 16px;
            border: 1px solid #E8E8E8;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .restaurant-list-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, #FD4B21 0%, #FF7B54 100%);
            transform: scaleY(0);
            transform-origin: center;
            transition: transform 0.3s ease-out;
        }

        .restaurant-list-item:hover {
            border-color: #FD4B21;
            transform: translateX(4px) translateY(-2px);
            box-shadow: 
                0px 8px 16px rgba(253, 75, 33, 0.12),
                0px 2px 4px rgba(0, 0, 0, 0.06);
            background: linear-gradient(135deg, #FFFFFF 0%, #FFFBF8 100%);
        }

        .restaurant-list-item:hover::before {
            transform: scaleY(1);
        }

        .restaurant-list-item-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }

        .restaurant-list-item-left {
            display: flex;
            align-items: center;
            gap: 14px;
            flex: 1;
        }

        .restaurant-list-emoji {
            font-size: 36px;
            line-height: 1;
            filter: drop-shadow(0px 2px 4px rgba(253, 75, 33, 0.2));
            transition: transform 0.3s ease-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
        }
        
        .restaurant-list-emoji img {
            width: 28px;
            height: 28px;
            object-fit: contain;
        }

        .restaurant-list-item:hover .restaurant-list-emoji {
            transform: scale(1.15) rotate(-5deg);
        }

        .restaurant-list-info {
            flex: 1;
        }

        .restaurant-list-name {
            color: #111827;
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 6px 0;
            letter-spacing: 0.3px;
        }

        .restaurant-list-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .restaurant-list-distance {
            color: #9CA3AF;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .restaurant-list-trend {
            color: #FF6B4A;
            font-size: 12px;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .restaurant-list-arrow {
            color: #FD4B21;
            font-size: 20px;
            transition: all 0.3s ease-out;
            opacity: 0.6;
        }

        .restaurant-list-item:hover .restaurant-list-arrow {
            transform: translateX(4px);
            opacity: 1;
        }

        .distance-color-green {
            color: #4ADE80;
        }

        .distance-color-yellow {
            color: #FACC15;
        }

        .distance-color-orange {
            color: #FB923C;
        }

        .distance-color-red {
            color: #F87171;
        }

        /* 식당 마커 */
        .restaurant-marker {
            position: absolute;
            width: 48px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 5;
        }

        .restaurant-marker::before {
            content: '';
            position: absolute;
            width: 48px;
            height: 48px;
            background: #FD4B21;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            border: 3px solid white;
            box-shadow: 0px 4px 12px rgba(253, 75, 33, 0.3);
            z-index: -1;
        }

        .restaurant-marker:hover {
            transform: translateY(-8px);
        }

        .restaurant-marker:hover::before {
            box-shadow: 0px 8px 20px rgba(253, 75, 33, 0.4);
        }

        .restaurant-marker.active {
            transform: scale(1.2) translateY(-12px);
        }

        .restaurant-marker.active::before {
            box-shadow: 0px 12px 28px rgba(253, 75, 33, 0.5);
            border-width: 4px;
        }
        
        .restaurant-marker img {
            width: 24px;
            height: 24px;
            object-fit: contain;
            z-index: 1;
            position: relative;
        }

        /* Bottom Sheet 배경 오버레이 */
        .bottom-sheet-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 19;
            pointer-events: none;
        }

        .bottom-sheet-overlay.show {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        .restaurant-card {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            width: 100%;
            max-width: 375px;
            background: #FD4B21;
            border-radius: 23px 23px 0 0;
            padding: 25px 16px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0px 25px 50px -12px rgba(0, 0, 0, 0.25);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: pan-y;
            -webkit-overflow-scrolling: touch;
            z-index: 20;
        }

        /* Bottom Sheet peek 상태 (일부만 보임 - 네이버 지도 스타일) */
        .restaurant-card.peek {
            transform: translateX(-50%) translateY(40%);
            /* peek 상태일 때 스크롤 가능하도록 */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* peek 상태일 때 스크롤 영역 활성화 */
        .restaurant-card.peek .card-content {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            max-height: calc(60vh - 80px);
        }

        /* Bottom Sheet 완전히 열림 */
        .restaurant-card.show {
            transform: translateX(-50%) translateY(0);
        }

        .restaurant-card.full {
            max-height: 95vh;
        }

        .card-handle {
            width: 48px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 0 auto 20px;
            cursor: grab;
            touch-action: none;
            user-select: none;
        }

        .card-handle:active {
            cursor: grabbing;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .card-header-left {
            display: flex;
            gap: 12px;
            align-items: center;
            flex: 1;
        }

        .restaurant-emoji {
            font-size: 36px;
            line-height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
        }
        
        .restaurant-emoji img {
            width: 28px;
            height: 28px;
            object-fit: contain;
        }

        .restaurant-info {
            flex: 1;
        }

        .restaurant-name {
            color: #FFFFFF;
            font-size: 16px;
            line-height: 24px;
            font-weight: 400;
            margin: 0 0 4px 0;
        }

        .restaurant-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .distance-badge {
            background: rgba(92, 72, 68, 0.2);
            border-radius: 8px;
            padding: 2px 8px;
            font-size: 12px;
            line-height: 16px;
            color: #FFFFFF;
        }

        .rating-info {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .rating-info svg {
            width: 12px;
            height: 12px;
            color: #FFFFFF;
        }

        .rating-score {
            color: #FFFFFF;
            font-size: 14px;
            line-height: 20px;
        }

        .divider {
            color: rgba(255, 255, 255, 0.4);
            font-size: 12px;
        }

        .review-count {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            line-height: 16px;
        }

        .close-card-btn {
            background: rgba(255, 255, 255, 0.19);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
        }

        .close-card-btn svg {
            width: 16px;
            height: 16px;
            color: #FFFFFF;
        }

        .card-menu-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .menu-section-header {
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
            padding: 8px 0;
            transition: opacity 0.2s;
        }

        .menu-section-header:hover {
            opacity: 0.8;
        }

        .menu-toggle-icon {
            font-size: 14px;
            transition: transform 0.3s ease;
            color: rgba(255, 255, 255, 0.7);
        }

        .menu-section-header.expanded .menu-toggle-icon {
            transform: rotate(180deg);
        }

        .menu-list {
            display: none;
            flex-direction: column;
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 4px;
            margin-top: 8px;
        }

        .menu-list.expanded {
            display: flex;
        }

        .menu-list::-webkit-scrollbar {
            width: 6px;
        }

        .menu-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .menu-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .menu-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .menu-item {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 10px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .menu-name {
            color: #FFFFFF;
            font-size: 14px;
            font-weight: 500;
        }

        .menu-price {
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
        }

        .card-reviews {
            background: #F2F4F7;
            border-radius: 14px;
            padding: 12px;
            margin-top: 12px;
        }

        .reviews-header {
            color: #FD4B21;
            font-size: 14px;
            line-height: 20px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .review-item {
            background: #F2F4F7;
            border-radius: 14px;
            padding: 12px;
        }

        .review-header {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 8px;
        }

        .reviewer-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reviewer-name {
            color: #000000;
            font-size: 14px;
            line-height: 20px;
        }

        .reviewer-dept {
            background: #F5D8D5;
            border-radius: 5px;
            padding: 2px 6px;
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        .review-stars {
            display: flex;
            gap: 2px;
        }

        .review-stars span {
            font-size: 12px;
            color: #FF6B4A;
        }

        .review-menu-badge {
            background: rgba(255, 107, 74, 0.2);
            border-radius: 8px;
            padding: 2px 8px;
            display: inline-block;
        }

        .review-menu-badge span {
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        .review-time {
            color: rgba(0, 0, 0, 0.4);
            font-size: 12px;
            line-height: 16px;
            margin-bottom: 8px;
        }

        .review-content {
            color: rgba(0, 0, 0, 0.8);
            font-size: 14px;
            line-height: 20px;
            margin-bottom: 12px;
        }

        .review-ratings {
            background: #F3E6E5;
            border-radius: 10px;
            padding: 8px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .rating-item-small {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .rating-item-small span:first-child {
            color: rgba(0, 0, 0, 0.6);
            font-size: 12px;
            line-height: 16px;
        }

        .rating-point {
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        .review-keywords {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .keyword-badge-small {
            background: rgba(255, 107, 74, 0.1);
            border: 1px solid rgba(255, 107, 74, 0.3);
            border-radius: 8px;
            padding: 2px 8px;
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        /* 반응형 조정 */
        @media (max-width: 375px) {
            body {
                max-width: 100%;
            }
            
            .header-content,
            .main-content,
            .nav-content,
            .meal-record-form,
            .map-view-container {
                max-width: 100%;
            }

            .map-filter-container {
                margin: 10px;
                padding: 10px;
            }

            .sort-menu-container {
                margin: 0 10px 12px 10px;
            }

            .sort-menu-toggle-btn {
                padding: 10px 14px;
                font-size: 13px;
            }

            .restaurant-card {
                padding: 20px 12px;
            }
        }

        /* 트렌드 화면 스타일 */
        .trend-content {
            background: #F2F4F7;
            padding: 20px;
            padding-bottom: 100px;
            max-width: 375px;
            margin: 0 auto;
        }

        .trend-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #F2F4F7;
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0px 4px 6px -4px rgba(0, 0, 0, 0.1), 0px 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            color: rgba(0, 0, 0, 0.6);
            font-size: 14px;
            line-height: 20px;
            margin-bottom: 4px;
        }

        .stat-value {
            color: #000000;
            font-size: 16px;
            line-height: 24px;
            font-weight: 400;
        }

        .stat-rating {
            display: flex;
            align-items: center;
            gap: 4px;
            background: #E5E7EB;
            border-radius: 10px;
            padding: 4px 8px;
            width: fit-content;
        }

        .stat-rating svg {
            width: 16px;
            height: 16px;
        }

        .stat-rating span {
            color: #000000;
            font-size: 16px;
            line-height: 24px;
        }

        .trend-card {
            background: #F2F4F7;
            border-radius: 14px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0px 4px 6px -4px rgba(0, 0, 0, 0.1), 0px 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .trend-card-title {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
        }

        .trend-card-title svg {
            width: 20px;
            height: 20px;
        }

        .trend-card-title span {
            color: #000000;
            font-size: 16px;
            line-height: 16px;
            font-weight: 400;
        }

        .tab-list {
            background: #E5E7EB;
            border-radius: 14px;
            padding: 3px;
            display: flex;
            margin-bottom: 24px;
        }

        .tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            border-radius: 14px;
            padding: 4px 8px;
            font-size: 14px;
            line-height: 20px;
            color: #000000;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: #FD4B21;
            color: #FFFFFF;
        }

        .popular-restaurant-item {
            background: #F3E6E5;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .rank-badge {
            width: 29px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            line-height: 24px;
            font-weight: 400;
            color: #FFFFFF;
        }

        .rank-badge.gold {
            background: #FBBF24;
        }

        .rank-badge.silver {
            background: #94A3B8;
        }

        .rank-badge.bronze {
            background: #D97706;
        }

        .restaurant-emoji-small {
            font-size: 24px;
            line-height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
        }
        
        .restaurant-emoji-small img {
            width: 20px;
            height: 20px;
            object-fit: contain;
        }

        .restaurant-info-small {
            flex: 1;
        }

        .restaurant-name-small {
            color: #000000;
            font-size: 16px;
            line-height: 24px;
            margin-bottom: 4px;
        }

        .restaurant-count {
            color: rgba(0, 0, 0, 0.6);
            font-size: 14px;
            line-height: 20px;
        }

        .restaurant-rating-small {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .restaurant-rating-small svg {
            width: 16px;
            height: 16px;
        }

        .restaurant-rating-small span {
            color: #FD4B21;
            font-size: 16px;
            line-height: 24px;
        }

        .ranking-swipe-container {
            position: relative;
            width: 100%;
            overflow: hidden;
        }

        .ranking-swipe-wrapper {
            display: flex;
            transition: transform 0.3s ease-out;
            will-change: transform;
        }
        
        .ranking-swipe-card {
            min-width: 100%;
            flex-shrink: 0;
            padding: 0 4px;
            box-sizing: border-box;
        }
        
        .ranking-item {
            width: 100%;
            position: relative;
            background: #F5DED2;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 17px;
        }

        .ranking-item.featured {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(255, 107, 74, 0.2) 100%);
            border-color: rgba(251, 191, 36, 0.5);
        }

        .ranking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .rank-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            line-height: 24px;
            font-weight: 700;
            color: #FFFFFF;
            box-shadow: 0px 4px 6px -4px rgba(0, 0, 0, 0.1), 0px 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .rank-number.gold {
            background: #FBBF24;
        }

        .rank-number.silver {
            background: #94A3B8;
        }

        .rank-number.bronze {
            background: #D97706;
        }

        .rank-change {
            background: rgba(74, 222, 128, 0.2);
            border-radius: 50px;
            padding: 2px 10px;
            font-size: 12px;
            line-height: 16px;
            color: #4ADE80;
        }

        .rank-change.up {
            background: rgba(74, 222, 128, 0.2);
            color: #4ADE80;
        }

        .ranking-restaurant {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
        }

        .restaurant-emoji-large {
            font-size: 48px;
            line-height: 48px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
        }
        
        .restaurant-emoji-large img {
            width: 36px;
            height: 36px;
            object-fit: contain;
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-name {
            color: #000000;
            font-size: 16px;
            line-height: 24px;
            margin-bottom: 8px;
        }

        .ranking-distance {
            background: rgba(255, 107, 74, 0.2);
            border-radius: 8px;
            padding: 2px 8px;
            display: inline-block;
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        .ranking-details {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .detail-item span:first-child {
            font-size: 14px;
            line-height: 20px;
            color: rgba(0, 0, 0, 0.6);
        }

        .detail-value {
            color: #000000;
            font-size: 16px;
            line-height: 24px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .detail-value.highlight {
            color: #FD5D37;
        }
        
        .detail-value svg {
            width: 16px;
            height: 16px;
        }

        .ranking-badge-special {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ranking-badge-special span:first-child {
            font-size: 12px;
            line-height: 16px;
            color: #FBBF24;
        }

        .ranking-badge-special span:last-child {
            font-size: 12px;
            line-height: 16px;
            color: #FD4B21;
        }
        
        .ranking-distance-badge {
            background: rgba(255, 107, 74, 0.2);
            border-radius: 8px;
            padding: 2px 8px;
            display: inline-block;
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }
        
        .ranking-name {
            color: #000000;
            font-size: 16px;
            line-height: 24px;
            margin-bottom: 8px;
        }
        
        /* 페이지네이션 도트 */
        .ranking-pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 16px;
            padding: 0 20px;
        }
        
        .ranking-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #D1D5DB;
            transition: all 0.3s ease;
        }
        
        .ranking-dot.active {
            background: #FF6B4A;
            width: 24px;
            border-radius: 4px;
        }

        .keyword-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .keyword-item {
            background: rgba(255, 107, 74, 0.1);
            border: 1px solid rgba(255, 107, 74, 0.3);
            border-radius: 8px;
            padding: 2px 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .keyword-text {
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        /* 시각평가 스타일 */
        .visual-rating-list {
            padding: 4px 0;
        }

        .visual-rating-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .visual-rating-item {
            background: linear-gradient(135deg, rgba(255, 107, 74, 0.05) 0%, rgba(255, 107, 74, 0.02) 100%);
            border: 1px solid rgba(255, 107, 74, 0.15);
            border-radius: 12px;
            padding: 14px 16px;
            transition: all 0.3s ease;
            animation: slideInUp 0.5s ease-out forwards;
            opacity: 0;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .visual-rating-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 74, 0.15);
            border-color: rgba(255, 107, 74, 0.3);
        }

        .visual-rating-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .visual-rating-emoji {
            font-size: 28px;
            line-height: 1;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }

        .visual-rating-info {
            flex: 1;
        }

        .visual-rating-label {
            font-size: 15px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
        }

        .visual-rating-stats {
            font-size: 12px;
            color: #6B7280;
        }

        .visual-rating-bar-container {
            height: 8px;
            background: rgba(255, 107, 74, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .visual-rating-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF6B4A 0%, #FF8E6B 100%);
            border-radius: 4px;
            transition: width 0.8s ease-out;
            position: relative;
            overflow: hidden;
        }

        .visual-rating-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        /* 카테고리별/학과별 시각평가 스타일 */
        .visual-rating-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(255, 107, 74, 0.2);
        }

        .visual-rating-category-section {
            background: linear-gradient(135deg, rgba(255, 107, 74, 0.08) 0%, rgba(255, 107, 74, 0.03) 100%);
            border: 1px solid rgba(255, 107, 74, 0.15);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            animation: slideInUp 0.5s ease-out forwards;
            opacity: 0;
        }

        .visual-rating-category-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 74, 0.15);
            border-color: rgba(255, 107, 74, 0.3);
        }

        .visual-rating-category-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 107, 74, 0.1);
        }

        .visual-rating-category-emoji {
            font-size: 20px;
            line-height: 1;
        }

        .visual-rating-category-name {
            font-size: 15px;
            font-weight: 600;
            color: #111827;
        }

        .visual-rating-category-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .visual-rating-item-small {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 8px;
            padding: 10px 12px;
            transition: all 0.2s ease;
        }

        .visual-rating-item-small:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateX(4px);
        }

        .visual-rating-header-small {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .visual-rating-emoji-small {
            font-size: 18px;
            line-height: 1;
        }

        .visual-rating-label-small {
            font-size: 13px;
            font-weight: 500;
            color: #111827;
            flex: 1;
        }

        .visual-rating-count-small {
            font-size: 12px;
            color: #FF6B4A;
            font-weight: 600;
        }

        .visual-rating-bar-container-small {
            height: 6px;
            background: rgba(255, 107, 74, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .visual-rating-bar-small {
            height: 100%;
            background: linear-gradient(90deg, #FF6B4A 0%, #FF8E6B 100%);
            border-radius: 3px;
            transition: width 0.6s ease-out;
        }

        /* 통합 시각평가 스타일 */
        .visual-rating-item-unified {
            background: linear-gradient(135deg, rgba(255, 107, 74, 0.08) 0%, rgba(255, 107, 74, 0.03) 100%);
            border: 1px solid rgba(255, 107, 74, 0.15);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            animation: slideInUp 0.5s ease-out forwards;
            opacity: 0;
        }

        .visual-rating-item-unified:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 74, 0.15);
            border-color: rgba(255, 107, 74, 0.3);
        }

        .visual-rating-header-unified {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
        }

        .visual-rating-emoji-unified {
            font-size: 32px;
            line-height: 1;
            animation: bounce 2s ease-in-out infinite;
        }

        .visual-rating-info-unified {
            flex: 1;
        }

        .visual-rating-label-unified {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
        }

        .visual-rating-meta-unified {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .visual-rating-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            line-height: 1.4;
        }

        .visual-rating-tag.category-tag {
            background: rgba(255, 107, 74, 0.1);
            color: #FF6B4A;
            border: 1px solid rgba(255, 107, 74, 0.2);
        }

        .visual-rating-tag.department-tag {
            background: rgba(59, 130, 246, 0.1);
            color: #3B82F6;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .visual-rating-count-unified {
            font-size: 14px;
            font-weight: 600;
            color: #FF6B4A;
            white-space: nowrap;
        }

        .visual-rating-bar-container-unified {
            height: 8px;
            background: rgba(255, 107, 74, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .visual-rating-bar-unified {
            height: 100%;
            background: linear-gradient(90deg, #FF6B4A 0%, #FF8E6B 100%);
            border-radius: 4px;
            transition: width 0.8s ease-out;
            position: relative;
            overflow: hidden;
        }

        .visual-rating-bar-unified::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        /* 그래프 스타일 */
        .visual-rating-graph-container {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .graph-section {
            animation: slideInUp 0.5s ease-out forwards;
            opacity: 0;
        }

        .graph-title {
            font-size: 15px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(255, 107, 74, 0.2);
        }

        .graph-bars {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .graph-bar-item {
            animation: slideInUp 0.5s ease-out forwards;
            opacity: 0;
        }

        .graph-bar-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            font-size: 13px;
        }

        .graph-bar-emoji {
            font-size: 18px;
            line-height: 1;
        }

        .graph-bar-name {
            flex: 1;
            font-weight: 500;
            color: #111827;
        }

        .graph-bar-count {
            font-weight: 600;
            color: #FF6B4A;
            font-size: 12px;
        }

        .graph-bar-wrapper {
            height: 24px;
            background: rgba(255, 107, 74, 0.1);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .graph-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF6B4A 0%, #FF8E6B 50%, #FFB89A 100%);
            border-radius: 12px;
            transition: width 0.8s ease-out;
            position: relative;
            box-shadow: 0 2px 4px rgba(255, 107, 74, 0.2);
        }

        .graph-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        .graph-multi-bars {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .graph-category-group {
            background: linear-gradient(135deg, rgba(255, 107, 74, 0.05) 0%, rgba(255, 107, 74, 0.02) 100%);
            border: 1px solid rgba(255, 107, 74, 0.15);
            border-radius: 12px;
            padding: 14px;
            animation: slideInUp 0.5s ease-out forwards;
            opacity: 0;
        }

        .graph-category-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 107, 74, 0.1);
        }

        .graph-category-emoji {
            font-size: 20px;
            line-height: 1;
        }

        .graph-category-name {
            font-size: 14px;
            font-weight: 600;
            color: #111827;
        }

        .graph-category-bars {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .graph-multi-bar-item {
            animation: fadeIn 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .graph-rank-badge {
            font-size: 16px;
            line-height: 1;
        }
        
        .graph-multi-bar-label {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 4px;
            font-size: 12px;
        }

        .graph-multi-bar-emoji {
            font-size: 16px;
            line-height: 1;
        }

        .graph-multi-bar-name {
            flex: 1;
            font-weight: 500;
            color: #111827;
        }

        .graph-multi-bar-count {
            font-weight: 600;
            color: #FF6B4A;
            font-size: 11px;
        }

        .graph-multi-bar-wrapper {
            height: 18px;
            background: rgba(255, 107, 74, 0.1);
            border-radius: 9px;
            overflow: hidden;
            position: relative;
        }

        .graph-multi-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF6B4A 0%, #FF8E6B 100%);
            border-radius: 9px;
            transition: width 0.6s ease-out;
            position: relative;
        }

        .graph-multi-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.25) 50%, transparent 100%);
            animation: shimmer 1.5s infinite;
        }

        /* 스와이프 가능한 시각평가 그래프 */
        .visual-rating-swipe-container {
            position: relative;
            width: 100%;
            overflow: hidden;
        }

        .visual-rating-swipe-wrapper {
            display: flex;
            transition: transform 0.3s ease-out;
            will-change: transform;
        }

        .visual-rating-swipe-card {
            min-width: 100%;
            flex-shrink: 0;
            padding: 0 4px;
            box-sizing: border-box;
        }

        .graph-card-title {
            font-size: 15px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(255, 107, 74, 0.2);
            text-align: center;
        }

        .graph-card-content {
            padding: 0 8px;
        }

        .visual-rating-pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 16px;
            padding: 0 20px;
        }

        .visual-rating-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 107, 74, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .visual-rating-dot.active {
            background: #FF6B4A;
            width: 24px;
            border-radius: 4px;
        }

        .visual-rating-dot:hover {
            background: rgba(255, 107, 74, 0.6);
        }

        /* 이달의 식당 랭킹 스와이프 스타일 */
        .ranking-swipe-card {
            min-width: 100%;
            flex-shrink: 0;
            padding: 0 4px;
            box-sizing: border-box;
        }

        .ranking-swipe-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            cursor: pointer;
        }

        .ranking-swipe-wrapper {
            display: flex;
            transition: transform 0.3s ease-out;
            will-change: transform;
        }

        .keyword-count {
            color: #FF6B4A;
            font-size: 12px;
            line-height: 16px;
        }

        .recent-records {
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 8px;
        }
        
        .recent-records::-webkit-scrollbar {
            width: 6px;
        }
        
        .recent-records::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        
        .recent-records::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 74, 0.3);
            border-radius: 10px;
        }
        
        .recent-records::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 107, 74, 0.5);
        }

        .record-item {
            background: #F3E6E5;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            padding: 17px;
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .record-left {
            display: flex;
            gap: 8px;
            align-items: center;
            flex: 1;
        }

        .record-emoji {
            font-size: 24px;
            line-height: 32px;
        }

        .record-info {
            flex: 1;
        }

        .record-menu {
            color: #891A00;
            font-size: 16px;
            line-height: 24px;
            margin-bottom: 8px;
        }

        .record-restaurant {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .record-restaurant svg {
            width: 12px;
            height: 12px;
        }

        .record-restaurant span {
            color: #FD4B21;
            font-size: 14px;
            line-height: 20px;
        }

        .record-stars {
            display: flex;
            gap: 4px;
        }

        .record-stars span {
            font-size: 12px;
            color: #FF6B4A;
        }

        .record-content {
            color: #000000;
            font-size: 14px;
            line-height: 20px;
            margin-bottom: 12px;
        }

        .record-keywords {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .record-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .record-author {
            color: #9D9D9D;
            font-size: 12px;
            line-height: 16px;
        }

        .record-time {
            color: #9D9D9D;
            font-size: 12px;
            line-height: 16px;
        }

        /* 한줄 댓글 스타일 */
        .comment-input-container {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .comment-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            background: #FFFFFF;
            font-size: 14px;
            color: #111827;
            outline: none;
            transition: border-color 0.2s;
        }

        .comment-input:focus {
            border-color: #FD4B21;
        }

        .comment-input::placeholder {
            color: #9CA3AF;
        }

        .comment-submit-btn {
            width: 48px;
            height: 48px;
            background: #FD4B21;
            border: none;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
            flex-shrink: 0;
        }

        .comment-submit-btn:hover {
            background: #E63900;
        }

        .comment-submit-btn:active {
            background: #CC3300;
        }

        .comment-submit-btn:disabled {
            background: #E5E7EB;
            cursor: not-allowed;
        }

        .comment-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 8px;
        }
        
        .comment-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .comment-list::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        
        .comment-list::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 74, 0.3);
            border-radius: 10px;
        }
        
        .comment-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 107, 74, 0.5);
        }

        .comment-item {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 12px 16px;
            border: 1px solid #E5E7EB;
        }

        .comment-text {
            color: #111827;
            font-size: 14px;
            line-height: 20px;
            margin-bottom: 8px;
        }

        .comment-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: rgba(0, 0, 0, 0.4);
        }

        .comment-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .comment-action-btn {
            background: transparent;
            border: none;
            color: #FD4B21;
            font-size: 12px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .comment-action-btn:hover {
            background: rgba(253, 75, 33, 0.1);
        }

        .comment-edit-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #FD4B21;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .comment-edit-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .comment-save-btn,
        .comment-cancel-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .comment-save-btn {
            background: #FD4B21;
            color: #FFFFFF;
        }

        .comment-save-btn:hover {
            background: #E63900;
        }

        .comment-cancel-btn {
            background: #E5E7EB;
            color: #111827;
        }

        .comment-cancel-btn:hover {
            background: #D1D5DB;
        }

        /* 문의함 스타일 */
        .inquiry-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .inquiry-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .inquiry-label {
            color: #111827;
            font-size: 14px;
            font-weight: 500;
        }

        .inquiry-input,
        .inquiry-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            background: #FFFFFF;
            font-size: 14px;
            color: #111827;
            outline: none;
            transition: border-color 0.2s;
            font-family: inherit;
            resize: vertical;
        }

        .inquiry-input:focus,
        .inquiry-textarea:focus {
            border-color: #FD4B21;
        }

        .inquiry-input::placeholder,
        .inquiry-textarea::placeholder {
            color: #9CA3AF;
        }

        .inquiry-textarea {
            min-height: 120px;
        }

        .inquiry-submit-btn {
            width: 100%;
            padding: 14px 24px;
            background: #FD4B21;
            border: none;
            border-radius: 12px;
            color: #FFFFFF;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .inquiry-submit-btn:hover {
            background: #E63900;
        }

        .inquiry-submit-btn:active {
            background: #CC3300;
        }
    </style>
</head>
<body>
    <!-- 홈 화면 -->
    <section id="homeScreen" class="screen active">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo-icon">
                        <img src="https://i.imgur.com/36NNkrf.png" alt="계미지도 로고">
                    </div>
                    <h1 class="header-title">계미지도</h1>
                </div>
                <button class="notification-btn" aria-label="알림">
                    <img src="https://i.imgur.com/sKOiF0X.png" alt="알림">
                </button>
            </div>
        </header>

        <!-- 메인 콘텐츠 -->
        <main class="main-content">
            <!-- 제목 섹션 -->
            <div class="title-section">
                <h2 class="title-line">오늘은 무엇을</h2>
                <h2 class="title-line">드셨나요?</h2>
            </div>

            <!-- 카테고리 버튼 그리드 -->
            <div class="category-grid" id="categoryContainer">
                <button class="category-btn" data-category="중식">
                    <span class="category-text">중식</span>
                </button>
                <button class="category-btn" data-category="일식">
                    <span class="category-text">일식</span>
                </button>
                <button class="category-btn" data-category="양식">
                    <span class="category-text">양식</span>
                </button>
                <button class="category-btn" data-category="한식">
                    <span class="category-text">한식</span>
                </button>
                <button class="category-btn" data-category="학식당">
                    <span class="category-text">학식당</span>
                </button>
                <button class="category-btn" data-category="디저트">
                    <span class="category-text">디저트</span>
                </button>
            </div>

            <!-- 랜덤 추천 섹션 -->
            <div class="random-section" id="randomSection">
                <div class="random-icon-wrapper">
                    <img src="https://i.imgur.com/FUVs45k.png" alt="메뉴 고민">
                </div>
                <h3 class="random-title">메뉴 고민 중이신가요?</h3>
                <p class="random-subtitle">랜덤으로 메뉴를 추천해드려요</p>
                <button class="random-btn" id="randomRecommendBtn">
                    <span class="random-btn-text">랜덤 추천 받기</span>
                </button>
                <!-- 랜덤 추천 결과 -->
                <div class="random-result" id="randomResult">
                    <img class="random-food-result-image" id="randomFoodResultImage" src="" alt="추천 음식">
                    <div class="random-food-result-name" id="randomFoodResultName"></div>
                    <button class="random-retry-btn" id="randomRetryBtn">다시뽑기</button>
                </div>
            </div>
        </main>

        <!-- 랜덤 추천 모달 -->
        <div class="random-modal" id="randomModal">
            <div class="random-modal-content">
                <button class="random-modal-close" id="randomModalClose">×</button>
                <img class="random-food-image" id="randomFoodImage" src="" alt="추천 음식">
                <div class="random-food-name" id="randomFoodName"></div>
                <div class="random-food-description" id="randomFoodDescription"></div>
                <div class="random-modal-actions">
                    <button class="random-modal-btn random-modal-btn-secondary" id="randomModalAnother">다시 추천</button>
                    <button class="random-modal-btn random-modal-btn-primary" id="randomModalSelect">이거로 선택</button>
                </div>
            </div>
        </div>

        <!-- 하단 네비게이션 (홈 화면에서만 표시) -->
        <nav class="bottom-nav show">
            <div class="nav-content">
                <button class="nav-item active" data-view="home" onclick="showScreen('home')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 12L5 10M5 10L12 3L19 10M5 10V18C5 18.552 5.448 19 6 19H9M19 10L21 12M19 10V18C19 18.552 18.552 19 18 19H15M9 19C9.552 19 10 18.552 10 18V14C10 13.448 10.448 13 11 13H13C13.552 13 14 13.448 14 14V18C14 18.552 14.448 19 15 19M9 19H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">홈</span>
                </button>
                <button class="nav-item" data-view="map" onclick="showScreen('map')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 20L3.553 17.276C3.214 17.107 3 16.76 3 16.382V5.618C3 5.24 3.214 4.893 3.553 4.724L9 2M9 20L15 17M9 20V2M15 17L20.447 19.276C20.786 19.445 21 19.792 21 20.17V7.618C21 7.24 20.786 6.893 20.447 6.724L15 4M15 17V4M15 4L9 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">지도</span>
                </button>
                <button class="nav-item" data-view="trend" onclick="showScreen('trend')">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 7H20M20 7V14M20 7L13 14L9 10L1 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">트렌드</span>
                </button>
            </div>
        </nav>
    </section>

    <!-- 기록하기 화면 -->
    <section id="recordScreen" class="screen">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <button class="back-btn" onclick="showScreen('home')" aria-label="뒤로가기">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <div class="logo-icon">
                        <img src="https://i.imgur.com/36NNkrf.png" alt="계미지도 로고">
                    </div>
                    <h1 class="header-title">계미지도</h1>
                </div>
                <button class="notification-btn" aria-label="알림">
                    <img src="https://i.imgur.com/sKOiF0X.png" alt="알림">
                </button>
            </div>
        </header>

        <!-- 기록 폼 -->
        <div class="meal-record-form">
            <!-- 위치 선택 -->
            <div class="card-content">
                <div class="form-label">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 10C21 17 12 23 12 23S3 17 3 10C3 5.029 7.029 1 12 1C16.971 1 21 5.029 21 10Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="12" cy="10" r="3" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>위치 선택</span>
                    <span class="required">*</span>
                </div>
                <select id="restaurantSelect" class="form-select">
                    <option value="">식당을 선택하세요</option>
                </select>
                <button class="add-restaurant-btn" id="addRestaurantBtn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 3V13M3 8H13" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>없는 식당 추가하기</span>
                </button>
                <div id="customRestaurantInput" style="display: none; margin-top: 8px;">
                    <input type="text" id="customRestaurantName" class="form-input" placeholder="식당 이름을 입력해주세요">
                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <button class="submit-custom-btn" id="submitCustomRestaurant">추가하기</button>
                        <button class="cancel-custom-btn" id="cancelCustomRestaurant">취소</button>
                    </div>
                </div>
            </div>

            <!-- 메뉴 선택 -->
            <div class="card-content" id="menuSection" style="display: none;">
                <div class="form-label">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 12H21M3 12C3 8.686 5.686 6 9 6H15C18.314 6 21 8.686 21 12M3 12V18C3 19.105 3.895 20 5 20H19C20.105 20 21 19.105 21 18V12" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M9 6V4C9 2.895 9.895 2 11 2H13C14.105 2 15 2.895 15 4V6" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="8" cy="15" r="1" fill="#FF6B4A"/>
                        <circle cx="12" cy="15" r="1" fill="#FF6B4A"/>
                        <circle cx="16" cy="15" r="1" fill="#FF6B4A"/>
                    </svg>
                    <span>메뉴</span>
                    <span class="required">*</span>
                </div>
                <select id="menuSelect" class="form-select" disabled>
                    <option value="">메뉴를 선택하세요</option>
                </select>
                <div id="customMenuInput" style="display: none; margin-top: 12px;">
                    <input type="text" id="customMenuName" class="form-input" placeholder="메뉴 이름을 입력해주세요">
                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <button type="button" class="submit-custom-btn" id="submitCustomMenu" style="flex: 1; padding: 12px; background: #FD4B21; color: #FFFFFF; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer;">확인</button>
                        <button type="button" class="cancel-custom-btn" id="cancelCustomMenu" style="flex: 1; padding: 12px; background: #E5E7EB; color: #111827; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer;">취소</button>
                    </div>
                </div>
            </div>

            <!-- 학과 선택 -->
            <div class="card-content" id="departmentSection" style="display: none;">
                <div class="form-label">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 10L12 4L2 10L12 16L22 10Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M22 10V18L12 22L2 18V10" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 16V22" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 10L12 16L22 10" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>학과</span>
                    <span class="required">*</span>
                </div>
                <select id="departmentSelect" class="form-select">
                    <option value="">학과를 선택하세요</option>
                </select>
            </div>

            <!-- 소요 시간 -->
            <div class="card-content" id="timeSection" style="display: none;">
                <div class="form-label">
                    <span>소요 시간</span>
                </div>
                <p class="form-description">음식이 나오는 데 얼마나 걸렸나요?</p>
                <div class="time-buttons">
                    <button class="time-btn" data-time="5분 미만">5분 미만</button>
                    <button class="time-btn" data-time="5분~15분">5분~15분</button>
                    <button class="time-btn" data-time="15분~25분">15분~25분</button>
                    <button class="time-btn" data-time="25분 이상">25분 이상</button>
                </div>
            </div>

            <!-- 기분 표시 -->
            <div class="card-content" id="moodSection" style="display: none;">
                <div class="form-label">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="overflow: visible;">
                        <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 14C8 14 9.5 16 12 16C14.5 16 16 14 16 14" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="9" cy="10" r="1" fill="#FF6B4A"/>
                        <circle cx="15" cy="10" r="1" fill="#FF6B4A"/>
                    </svg>
                    <span>기분 표시</span>
                    <span class="required">*</span>
                </div>
                <p class="form-description">음식을 먹고 난 후 나의 기분을 표시해주세요.</p>
                <div class="mood-buttons">
                    <button class="mood-btn" data-mood="행복">
                        <div class="mood-emoji">😊</div>
                        <div class="mood-label">행복</div>
                    </button>
                    <button class="mood-btn" data-mood="만족함">
                        <div class="mood-emoji">😋</div>
                        <div class="mood-label">만족함</div>
                    </button>
                    <button class="mood-btn" data-mood="보통">
                        <div class="mood-emoji">😐</div>
                        <div class="mood-label">보통</div>
                    </button>
                    <button class="mood-btn" data-mood="별로">
                        <div class="mood-emoji">😔</div>
                        <div class="mood-label">별로</div>
                    </button>
                    <button class="mood-btn" data-mood="나른함">
                        <div class="mood-emoji">🤤</div>
                        <div class="mood-label">나른함</div>
                    </button>
                    <button class="mood-btn" data-mood="화남">
                        <div class="mood-emoji">😤</div>
                        <div class="mood-label">화남</div>
                    </button>
                </div>
            </div>

            <!-- 상세 평가 -->
            <div class="card-content" id="ratingSection" style="display: none;">
                <div class="form-label">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>상세 평가</span>
                    <span class="required">*</span>
                </div>
                <div id="ratingContainer"></div>
            </div>

            <!-- 시각 평가 -->
            <div class="card-content" id="visualSection" style="display: none;">
                <div class="form-label">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 4H16V16H4V4Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8 8H12M8 12H12" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>시각 평가</span>
                </div>
                <p class="form-description">음식의 맛을 시각적인 느낌으로 선택해주세요.</p>
                <div class="visual-buttons">
                    <button class="visual-btn">부드러운</button>
                    <button class="visual-btn">시원한</button>
                    <button class="visual-btn">전통적인</button>
                    <button class="visual-btn">발랄한</button>
                    <button class="visual-btn">화려한</button>
                    <button class="visual-btn">소박한</button>
                    <button class="visual-btn">세련된</button>
                    <button class="visual-btn">투박한</button>
                </div>
            </div>

            <!-- 학생 한 줄 팁 -->
            <div class="card-content" id="keywordSection" style="display: none;">
                <div class="form-label">
                    <span>학생 한 줄 팁</span>
                </div>
                <p class="form-description">해당하는 키워드를 모두 선택해주세요</p>
                <button class="add-keyword-btn" id="addKeywordBtn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 3V13M3 8H13" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span>기타 키워드 추가</span>
                </button>
                <div id="customKeywordInput" style="display: none; margin-top: 12px; gap: 8px; align-items: center; flex-direction: row;">
                    <input type="text" id="customKeyword" placeholder="직접 입력..." style="flex: 1; padding: 10px 14px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px; outline: none;">
                    <button type="button" id="submitCustomKeyword" style="padding: 10px 16px; background: #FD4B21; color: #FFFFFF; border: none; border-radius: 8px; font-size: 14px; cursor: pointer;">추가</button>
                    <button type="button" id="cancelCustomKeyword" style="padding: 10px 16px; background: #E5E7EB; color: #111827; border: none; border-radius: 8px; font-size: 14px; cursor: pointer;">취소</button>
                </div>
                <div class="keyword-badges" id="keywordContainer"></div>
            </div>

            <!-- 시간 안내 -->
            <div class="info-card">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 14C11.314 14 14 11.314 14 8C14 4.686 11.314 2 8 2C4.686 2 2 4.686 2 8C2 11.314 4.686 14 8 14Z" stroke="rgba(255,255,255,0.6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8 6V8M8 10H8.01" stroke="rgba(255,255,255,0.6)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>현재 시간이 자동으로 기록됩니다</span>
            </div>

            <!-- 기록 완료 버튼 -->
            <button class="submit-btn" id="submitBtn">
                <span>기록 완료</span>
            </button>
        </div>

        <!-- 하단 네비게이션 (기록 화면에서는 숨김) -->
        <nav class="bottom-nav" style="display: none;">
            <div class="nav-content">
                <button class="nav-item" data-view="home" onclick="showScreen('home')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 12L5 10M5 10L12 3L19 10M5 10V18C5 18.552 5.448 19 6 19H9M19 10L21 12M19 10V18C19 18.552 18.552 19 18 19H15M9 19C9.552 19 10 18.552 10 18V14C10 13.448 10.448 13 11 13H13C13.552 13 14 13.448 14 14V18C14 18.552 14.448 19 15 19M9 19H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">홈</span>
                </button>
                <button class="nav-item" data-view="map">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 20L3.553 17.276C3.214 17.107 3 16.76 3 16.382V5.618C3 5.24 3.214 4.893 3.553 4.724L9 2M9 20L15 17M9 20V2M15 17L20.447 19.276C20.786 19.445 21 19.792 21 20.17V7.618C21 7.24 20.786 6.893 20.447 6.724L15 4M15 17V4M15 4L9 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">지도</span>
                </button>
                <button class="nav-item" data-view="trend">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 7H20M20 7V14M20 7L13 14L9 10L1 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">트렌드</span>
                </button>
            </div>
        </nav>
    </section>

    <!-- 지도 화면 -->
    <section id="mapScreen" class="screen">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo-icon">
                        <img src="https://i.imgur.com/36NNkrf.png" alt="계미지도 로고">
                    </div>
                    <h1 class="header-title">계미지도</h1>
                </div>
            </div>
        </header>

        <!-- 카테고리 필터 -->
        <div class="map-filter-container" id="mapFilterContainer">
            <div class="map-filter-buttons" id="mapFilterButtons">
                <!-- 필터 버튼들이 여기에 동적으로 생성됩니다 -->
            </div>
            <button class="menu-toggle-btn" id="menuToggleBtn" aria-label="정렬 메뉴">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2.5 5H17.5M2.5 10H17.5M2.5 15H17.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>

        <!-- 정렬 메뉴 (카테고리 아래) -->
        <div class="sort-menu-container" id="sortMenuContainer" style="display: none;">
            <div class="sort-menu-dropdown" id="sortMenuDropdown">
                <button class="sort-menu-item active" data-sort="popular">
                    <span>인기순</span>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 1L10 6L15 6L11 9L13 14L8 11L3 14L5 9L1 6L6 6L8 1Z" fill="currentColor"/>
                    </svg>
                </button>
                <button class="sort-menu-item" data-sort="review">
                    <span>리뷰순</span>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 1L10 6L15 6L11 9L13 14L8 11L3 14L5 9L1 6L6 6L8 1Z" fill="currentColor"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- 카테고리별 식당 리스트 -->
        <div class="category-restaurant-list" id="categoryRestaurantList">
            <div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">데이터를 불러오는 중...</div>
        </div>

        <!-- 지도 뷰 -->
        <div class="map-view-container">
            <!-- 지도 배경 이미지 영역 -->
            <div class="map-background" id="mapBackground">
                <!-- 배경 그리드 (JavaScript로 동적 생성) -->
                <div class="map-grid" id="mapGrid">
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
                    <div class="map-grid-cell"></div>
            </div>
                <!-- 식당 마커들이 여기에 동적으로 추가됩니다 -->
            </div>

            <!-- 식당 리스트 (지도 아래) - 숨김 -->
            <div class="map-restaurant-list" id="mapRestaurantList" style="display: none;">
                <div class="list-header">
                    <h2 class="list-title">
                        <span id="listTitle">전체 식당</span>
                        <span class="list-count" id="listCount">(0개)</span>
                    </h2>
                </div>
                <div class="list-content" id="restaurantListContent">
                    <!-- 식당 리스트가 여기에 동적으로 추가됩니다 -->
                </div>
            </div>

            <!-- Bottom Sheet 배경 오버레이 -->
            <div class="bottom-sheet-overlay" id="bottomSheetOverlay"></div>

            <!-- 식당 상세 카드 (Bottom Sheet) -->
            <div class="restaurant-card" id="restaurantCard">
                <div class="card-handle"></div>
                <div class="card-header">
                    <div class="card-header-left">
                        <div class="restaurant-emoji"></div>
                        <div class="restaurant-info">
                            <h3 class="restaurant-name"></h3>
                            <div class="restaurant-meta">
                                <span class="distance-badge"></span>
                                <div class="rating-info">
                                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M6 1L7.5 4.5L11 5L8.5 7.5L9 11L6 9L3 11L3.5 7.5L1 5L4.5 4.5L6 1Z" fill="currentColor"/>
                                    </svg>
                                    <span class="rating-score">0.0</span>
                                </div>
                                <span class="divider">·</span>
                                <span class="review-count">0개 리뷰</span>
                            </div>
                        </div>
                    </div>
                    <button class="close-card-btn" id="closeCardBtn">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>
                <div class="card-menu-section" id="cardMenuSection" style="display: none;">
                    <div class="menu-section-header" id="menuSectionHeader">
                        <span>🍽️ 메뉴</span>
                        <span class="menu-toggle-icon">▼</span>
                    </div>
                    <div class="menu-list" id="menuList">
                        <!-- 메뉴 목록이 여기에 동적으로 추가됩니다 -->
                    </div>
                </div>
                <div class="card-reviews">
                    <div class="reviews-header">
                        <span>리뷰 0개</span>
                    </div>
                    <div style="text-align: center; padding: 40px 20px; color: rgba(255, 255, 255, 0.7);">
                        식당을 선택하면 리뷰를 확인할 수 있습니다.
                    </div>
                </div>
            </div>
        </div>

        <!-- 하단 네비게이션 (기록 화면에서는 숨김) -->
        <nav class="bottom-nav" style="display: none;">
            <div class="nav-content">
                <button class="nav-item" data-view="home" onclick="showScreen('home')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 12L5 10M5 10L12 3L19 10M5 10V18C5 18.552 5.448 19 6 19H9M19 10L21 12M19 10V18C19 18.552 18.552 19 18 19H15M9 19C9.552 19 10 18.552 10 18V14C10 13.448 10.448 13 11 13H13C13.552 13 14 13.448 14 14V18C14 18.552 14.448 19 15 19M9 19H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">홈</span>
                </button>
                <button class="nav-item active" data-view="map" onclick="showScreen('map')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 20L3.553 17.276C3.214 17.107 3 16.76 3 16.382V5.618C3 5.24 3.214 4.893 3.553 4.724L9 2M9 20L15 17M9 20V2M15 17L20.447 19.276C20.786 19.445 21 19.792 21 20.17V7.618C21 7.24 20.786 6.893 20.447 6.724L15 4M15 17V4M15 4L9 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">지도</span>
                </button>
                <button class="nav-item" data-view="trend">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 7H20M20 7V14M20 7L13 14L9 10L1 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">트렌드</span>
                </button>
            </div>
        </nav>
    </section>

    <!-- 트렌드 화면 -->
    <section id="trendScreen" class="screen">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo-icon">
                        <img src="https://i.imgur.com/36NNkrf.png" alt="계미지도 로고">
                    </div>
                    <h1 class="header-title">계미지도</h1>
                </div>
                <button class="notification-btn" aria-label="알림">
                    <img src="https://i.imgur.com/sKOiF0X.png" alt="알림">
                </button>
            </div>
        </header>

        <!-- 메인 콘텐츠 -->
        <main class="trend-content">
            <!-- 통계 카드 -->
            <div class="trend-stats">
                <div class="stat-card">
                    <div class="stat-label">오늘 기록</div>
                    <div class="stat-value">0건</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">평균 평점</div>
                    <div class="stat-rating">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 1L10 6L16 6L11 9L13 14L8 11L3 14L5 9L0 6L6 6L8 1Z" fill="#FF6B4A"/>
                        </svg>
                        <span>0.0</span>
                    </div>
                </div>
            </div>

            <!-- 오늘의 인기 식당 -->
            <div class="trend-card">
                <div class="trend-card-title">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 1L12 7L18 7L13 11L15 17L10 13L5 17L7 11L2 7L8 7L10 1Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>오늘의 인기 식당</span>
                </div>
                <div class="trend-tabs">
                    <div class="tab-list">
                        <button class="tab-btn active" data-period="today">오늘</button>
                        <button class="tab-btn" data-period="week">이번 주</button>
                        <button class="tab-btn" data-period="month">이번 달</button>
                    </div>
                    <div class="tab-content" id="popularRestaurantsContent">
                        <div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">데이터를 불러오는 중...</div>
                    </div>
                </div>
            </div>

            <!-- 이달의 식당 랭킹 -->
            <div class="trend-card">
                <div class="trend-card-title">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 1L12 7L18 7L13 11L15 17L10 13L5 17L7 11L2 7L8 7L10 1Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>이달의 식당 랭킹</span>
                </div>
                <div class="ranking-swipe-container" id="rankingSwipeContainer">
                    <div class="ranking-swipe-wrapper" id="rankingSwipeWrapper">
                        <div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">데이터를 불러오는 중...</div>
                </div>
                <div class="ranking-pagination" id="rankingPagination">
                    <!-- 동적으로 업데이트됨 -->
                    </div>
                </div>
            </div>

            <!-- 시각평가 -->
            <div class="trend-card">
                <div class="trend-card-title">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 1L12 7L18 7L13 11L15 17L10 13L5 17L7 11L2 7L8 7L10 1Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>시각평가 트렌드</span>
                </div>
                <div class="visual-rating-list" id="visualRatingList">
                    <div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">데이터를 불러오는 중...</div>
                </div>
            </div>

            <!-- 최근 식사 기록 -->
            <div class="trend-card">
                <div class="trend-card-title">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 1L12 7L18 7L13 11L15 17L10 13L5 17L7 11L2 7L8 7L10 1Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>최근 식사 기록</span>
                </div>
                <div class="recent-records">
                    <div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">데이터를 불러오는 중...</div>
                </div>
            </div>

            <!-- 한줄 댓글 작성 -->
            <div class="trend-card">
                <div class="trend-card-title">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 1L12 7L18 7L13 11L15 17L10 13L5 17L7 11L2 7L8 7L10 1Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>한줄 댓글</span>
                </div>
                <div class="comment-input-container">
                    <input type="text" id="commentInput" class="comment-input" placeholder="한줄 댓글을 작성해주세요..." maxlength="100">
                    <button type="button" id="submitCommentBtn" class="comment-submit-btn">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18 2L9 11M18 2L12 18L9 11M18 2L2 8L9 11" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <div class="comment-list" id="commentList">
                    <!-- 댓글이 동적으로 추가됩니다 -->
                </div>
            </div>

            <!-- 문의함 -->
            <div class="trend-card">
                <div class="trend-card-title">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2 4H18V16H2V4Z" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 4L10 10L18 4" stroke="#FF6B4A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>문의함</span>
                </div>
                <div class="inquiry-form">
                    <div class="inquiry-field">
                        <label class="inquiry-label">제목</label>
                        <input type="text" id="inquiryTitle" class="inquiry-input" placeholder="문의 제목을 입력해주세요">
                    </div>
                    <div class="inquiry-field">
                        <label class="inquiry-label">내용</label>
                        <textarea id="inquiryContent" class="inquiry-textarea" placeholder="문의 내용을 입력해주세요" rows="5"></textarea>
                    </div>
                    <button type="button" id="submitInquiryBtn" class="inquiry-submit-btn">
                        <span>문의하기</span>
                    </button>
                </div>
            </div>
        </main>

        <!-- 하단 네비게이션 (기록 화면에서는 숨김) -->
        <nav class="bottom-nav" style="display: none;">
            <div class="nav-content">
                <button class="nav-item" data-view="home" onclick="showScreen('home')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 12L5 10M5 10L12 3L19 10M5 10V18C5 18.552 5.448 19 6 19H9M19 10L21 12M19 10V18C19 18.552 18.552 19 18 19H15M9 19C9.552 19 10 18.552 10 18V14C10 13.448 10.448 13 11 13H13C13.552 13 14 13.448 14 14V18C14 18.552 14.448 19 15 19M9 19H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">홈</span>
                </button>
                <button class="nav-item" data-view="map" onclick="showScreen('map')">
                    <svg width="23" height="20" viewBox="0 0 23 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 20L3.553 17.276C3.214 17.107 3 16.76 3 16.382V5.618C3 5.24 3.214 4.893 3.553 4.724L9 2M9 20L15 17M9 20V2M15 17L20.447 19.276C20.786 19.445 21 19.792 21 20.17V7.618C21 7.24 20.786 6.893 20.447 6.724L15 4M15 17V4M15 4L9 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">지도</span>
                </button>
                <button class="nav-item active" data-view="trend" onclick="showScreen('trend')">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 7H20M20 7V14M20 7L13 14L9 10L1 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="nav-label">트렌드</span>
                </button>
            </div>
        </nav>
    </section>

    <script>
        // ============================================
        // 📊 데이터 정의
        // ============================================
        
        const restaurants = {
            '중식': [
                { name: '황제짬뽕', distance: '도보 10분', menus: ['짜장면 6500', '짜장곱배기 7500', '매운 짜장 7500', '짬뽕 8000', '짬뽕곱배기 9000', '짬뽕밥 9000', '황제짬뽕 11000', '황제짬뽕밥 11500', '황제해물크림짬뽕 11500', '탕수육 (중) 18000', '탕수육 (대) 29000', '매운탕수육 (중) 19000', '매운탕수육 (대) 30000', '직접 입력...'] },
                { name: '탕화쿵푸마라탕 내손점', distance: '도보 20분', menus: ['마라탕 소1인분 10000', '마라탕 중1~2인분 15000', '마라탕 대2~3인분 25000', '마라샹궈 18000', '꿔바로우 12000', '직접 입력...'] },
                { name: '향라원마라탕&훠궈 의왕', distance: '도보 20분', menus: ['JMT셀프 마라탕 1~2인분 15000', 'JMT셀프 마라샹궈 기본 600g 18000', '1인세트 18000', '볶음밥 1인분 8000', '꿔바로우 대 16000', '꿔바로우 소 10000', 'JMT셀프 마라샹궈 3~4인 38000', 'JMT셀프 마라샹궈 2~3인 28000', '모리미차 3000', '빙홍차 3000', '원기삼림제로 3000', '빙탕설리 3000', 'JMT셀프 마라탕 2~3인 20000', '차파이 3000', '사이다 2000', '환타 오렌지 2000', '환타 파인 2000', '코카콜라 제로 2000', '코카콜라 2000', '환바 2000', 'JMT 기본구성 마라탕 3인분 26000', 'JMT 기본구성 마라탕 2인분 18000', 'JMT 기본구성 마라탕 1인분 13000', '직접 입력...'] },
                { name: '천향짬뽕', distance: '도보 20분', menus: ['짜장면 7000', '천향해물짬뽕 9000', '삼선짬뽕 15000', '통오징어짬뽕 12000', '해물간짜장 10000', '해물고추짜장면 11000', '해물쟁반짜장 2인 22000', '통오징어해물우동 12000', '차돌짬뽕 13000', '해물야채볶음밥 9000', '잡채밥 10000', '고추잡채밥 12000', '어향가지밥 12000', '유산슬밥 15000', '잡탕밥 16000', '냉짬뽕 여름계절메뉴 14000', '중국냉면 여름계절메뉴 14000', '양장피 35000', '고추잡채꽃빵 35000', '유산슬 35000', '통전복 팔보채 40000', '해물누룽지탕 38000', '어향동고 35000', '깐풍동고 35000', '삼선짬뽕탕 25000', '등심 탕수육 24000', '등심 사천탕수육 26000', '중새우 망고 10pcs 35000', '중새우 깐쇼 10pcs 35000', '깐풍기 30000', '유린기 30000', '직접 입력...'] },
                { name: '동보성 의왕', distance: '도보 20분', menus: ['짜장면 6000', '매운짜장 7000', '짬뽕 7000', '간짜장 7000', '우동 7000', '유니짜장 7500', '삼선짜장 8000', '삼선짬뽕 9000', '쟁반짜장 7500', '군만두 6500', '찐만두 6500', '볶음밥 7000', '짬뽕밥 7000', '육개장 7500', '새우볶음밥 8000', '삼선볶음밥 8000', '잡채밥 8000', '고추잡채밥 8000', '양송이덮밥 8000', '유산슬밥 14000', '잡탕밥 14000', '해삼탕밥 15000', '잡채 18000', '탕수육(소) 16000', '탕수육(중) 22000', '라조기 25000', '난자완스 25000', '양장피 25000', '고추잡채 25000', '깐풍기 25000', '라조육 25000', '팔보채 28000', '깐쇼새우 28000', '삼선누룽지탕 25000', '유산슬 30000', '해삼탕 48000', '전가복 48000', '매운술국 14000', '직접 입력...'] },
                { name: '마라공방 의왕내손점', distance: '도보 25분', menus: ['마라탕 100g 2000', '마라샹궈 100g 3300', '꿔바로우 소 13000', '꿔바로우 대 19000', '계란볶음밥 7000', '멘보샤 6000', '꽃빵튀김 7000', '미니전 2500', '직접 입력...'] }
            ],
            '일식': [
                { name: '저스트카츠 의왕점', distance: '도보 5~10분', menus: ['저스트 등심정식 10900', '저스트 통치즈정식 12500', '저스트 안심정식 12500', '등심세트 17900', '직접 입력...'] },
                { name: '멘구락부 의왕', distance: '도보 10분', menus: ['쇼유 라멘 11000', '시오 라멘 11000', '멸치 비빔 라멘 11500', '쇼유 파이탄 11000', '시오 파이탄 11000', '아부라 소바 11500', '농후니보시 11500', '카레 아부라 소바 12500', '카라이 라멘 11000', '매운멸치 비빔 라멘 12500', '직접 입력...'] },
                { name: '스시상 의왕', distance: '도보 10~15분', menus: ['광어 초밥 22000', '연어 초밥 22000', '광연 반반 22000', '후토마키 20000', '모둠지라시스시 18000', '장어 지라시스시 22000', '생선 초밥 18000', '오늘의 초밥 13000', '모둠 초밥 18000', '특 초밥 25000', '초밥 런치 12000', '후토 런치 14000', '회덮밥 10000', '특회덮밥 12000', '연어 회덮밥 13000', '광어 회덮밥 16000', '서더리 곤이탕 8000', '알밥 8000', '사케동 13000', '우동 6000', '직접 입력...'] },
                { name: "윤's카츠", distance: '도보 15분', menus: ['등심 카츠 11000', '생선 카츠 12000', '안심 카츠 13000', '치즈 카츠 13000', '반반 카츠 12000', '치즈 롤카프 13000', '고구마 치즈롤카츠 14000', '날치알 치즈롤카츠 14000', '눈꽃치즈 철판 카츠 14000', '유부 우동 8000', '냉모밀 9000', '알밥 9500', '직접 입력...'] },
                { name: '싱싱생선 의왕', distance: '도보 15~20분', menus: ['평일 점심 세트 A 11000', '평일 점심 세트 B 14500', '평일 점심 세트 C 14500', '모둠 초밥 13000', '오늘의 초밥 17000', '특초밥 21000', '스페셜 14000', '후토마끼 20000', '특회덮밥 12000', '사케동 13500', '우나기동 21000', '직접 입력...'] },
                { name: '유부야 의왕점', distance: '도보 20분', menus: ['양파소스 연어 유부초밥 3200', '생연어 유부초밥 3200', '계란 유부초밥 2300', '우삼격 유부초밥 3200', '소불고기 유부초밥 2800', '치즈불닭 유부초밥 2800', '크래미 유부초밥 2300', '불오징어 유부초밥 2800', '제육 유부초밥 2800', '베이컨 김치 유부초밥 2800', '스팸 유부초밥 2800', '날치알 유부초밥 2800', '옥수수콘 유부초밥 2300', '참치마요 유부초밥 2300', '타코와사비 유부초밥 2800', '크림새우 유부초밥 2800', '칠리새우 유부초밥 2800', '육회 유부초밥 3200', '로제크림새우 유부초밥 2800', '장어 유부초밥 3200', '명란마요 유부초밥 3200', '연어장 유부초밥 3200', '새우장 유부초밥 3200', '양념새우장 유부초밥 3200', '직접 입력...'] }
            ],
            '양식': [
                { name: '이삭토스트 의왕계원예술대점', distance: '도보 5~10분', menus: ['I.아메리카노 2900', 'I.메가리카노 3400', '스페셜 토스트 3500', '스크램블 토스트 3200', 'I.디카페인 아메리카노 3400', '감자 스페셜 4400', '그릴드 불갈비 세트 7900', '감자 스페셜 4800', '그릴드 불갈비 5000', '햄스페셜 토스트 세트 6200', '햄스페셜 토스트 3500', '햄치즈 토스트 3300', '햄치즈 포테이토 세트 7300', '베이컨 베스트 세트 7200', '프렌치 햄치즈 3800', '리얼 팜 2800', '햄치즈 포테이토 4400', '베이컨 포테이토 피자 세트 8300', '베이컨 베스트 4300', '딥치즈 베이컨 세트 7200', '베이컨 포테이토 피자 5400', '딥치즈 베이컨 4600', '딥치즈 베이컨 포테이토 세트 8200', '딥치즈 베이컨 포테이토 5300', '애플 크림 브리오슈 세트 6600', '리얼 양념치킨 세트 7300', 'H.아메리카노 2900', '스크램블 베이컨 세트 7700', '스크램블 햄치즈 세트 6800', '포테이토 팜 2100', '세트 음료(캔) 355ml 2000', '애플 크림 브리오슈 3700', '포테이토 팜(식스 팜) 2400', 'H.디카페인 아메리카노 3400', '소이 그란치킨 세트 8000', '리얼 양념치킨 5000', '이삭 팜 포테이토 팜 2800', '소이 그란치킨 5100', '아이스티 2800', '치즈볼 300', '콜라(캔) 355ml 2000', '프렌치 크림 브리오슈 세트 7600', '계란후라이 햄치즈 세트 6700', '사이다(캔) 355ml 2000', '프렌치 햄치즈 세트 6700', '계란후라이 스페셜 세트 7100', '계란후라이 햄치즈 4000', '제로 사이다(캔) 355ml 2000', '프렌치 햄치즈 3500', '계란후라이 스페셜 4200', '콘베이컨 에그마요 세트 7200', '프렌치 에그마요 3900', '프렌치 크림 브리오슈 4100', '프렌치 소스 200', '콘베이컨 에그마요 세트 7600', '콘베이컨 에그마요 4300', '포테이토 에그마요 4700', '콘슬로우 2900', '직접 입력...'] },
                { name: '프랭크버거 의왕내손점', distance: '도보 5~10분', menus: ['베이컨치즈버거 7400', '프랭크버거 5100', '쉬림프버거 5500', '프랭크버거 세트 8800', 'JG버거 9400', '100%한우갈릭버거세트 12600', '크리스피치킨버거 세트 11000', '치즈도넛버블버거 세트 12800', '핫치즈링(1개) 2900', '해쉬포테이토(1개) 2200', '치즈버거 6000', '아메리카노(HOT) 2200', '100%한우버거 8400', '100%한우갈릭버거 8900', '100한우버거세트 12100', 'K불고기버거 4700', '해쉬비프버거 세트 10400', '바삭어니언링 3900', '갈릭콘페퍼치킨 5300', '청양마요치킨 5300', '블랙소이갈릭치킨 5300', '허니간장치킨 5300', '매콤레드핫치킨 5300', '클래식양념치킨 5300', '바삭후라이드치킨 4900', '프랭크치킨팩 11300', '프랭크버거팩 12600', '치즈버거 세트 9700', '베이컨치즈버거 세트 11100', '더블비프치즈버거 세트 12900', '크리스피카츠버거 세트 9900', '해쉬비프버거 6700', '크리스피카츠버거 6200', '버팔로윙봉 순한맛(윙2개+봉2개) 5400', 'JG버거 세트 13100', '프렌치프라이 2200', '콘샐러드 2500', '코울슬로 2500', '더치즈볼(3개) 2700', '치즈스틱(3개) 2700', '스파이시치킨텐더(2개) 2700', '오징어링(5개) 3900', '치즈 프렌치프라이 3700', '통가슴살 후라이드(1개) 3700', 'K핫불고기버거 세트 8400', '자이언트 통닭다리(1개) 6300', 'K불고기버거 세트 8400', '바닐라 밀크쉐이크 4000', '아메리카노(ICE) 2200', '탄산음료 2200', '생수 500ml 1000', 'K핫불고기버거 4700', '크리스피치킨버거 6400', '쉬림프버거 세트 9200', '더블비프치즈버거 8600', '비프&쉬림프버거 8400', '청양마요쉬림프버거트 세트 9400', '청양마요쉬림프버거 5700', '치즈도넛비프버거 9100', '비프&쉬림프버거 세트 12100', '직접 입력...'] },
                { name: '일지오 페페', distance: '도보 10분', menus: ['고르곤졸라 피자 20000', '마르게리따 피자 20000', '알리오올리오 파스타 11000', '토마토해산물 파스타 13000', '까르보나라 파스타 14000', '새우로제 파스타 14000', '직접 입력...'] },
                { name: '샐러페 의왕', distance: '도보 10~12분', menus: ['구운 닭다리살 샐러드 파스타 10900', '(부채살)퍼펙트 샐러드 파스타 11900', '퍼펙트 샐러드 11900', '연어 아보카도 샐러드 11900', '버터지는 샐러드 13900', '퍼펙트 샐러페 포케 11900', '특급 연어 샐러페 포케 11900', '훈제오리 샐러페 포케 10900', '구운 닭다리살 포케 10900', '스페셜 치킨에그 샐러드 9900', '구운 닭다리살 샐러드 10900', '그린 아보카도 샐러드 10900', '새우 아보카도 샐러드 10900', '퍼펙트 샐러드 11900', '연어 아보카도 샐러드 11900', '그릴드 머쉬룸 샐러드 12900', '버터지는 샐러드 13900', '닭가슴살 샐러페 포케 10900', '구운 닭다리살 포케 10900', '훈제오리 샐러페 포케 10900', '퍼펙트 샐러페 포케 11900', '특급 연어 샐러페 포케 11900', '닭가슴살 샐러드 파스타 10900', '구운 닭다리살 샐러드 파스타 10900', '새우 샐러드 파스타 10900', '훈제오리 샐러드 파스타 10900', '(부채살)퍼펙트 샐러드 파스타 11900', '아메리카노 3000', '카페라떼 4000', '바닐라라떼 4500', '청귤에이드 4900', '자몽에이드 4900', '딸기라떼 4900', '나랑드사이다 1500', '제로콜라 2000', '직접 입력...'] },
                { name: '도마셰프', distance: '도보 15분', menus: ['오스트리아 수입 생맥주 에델바이스 9500', '네덜란드 수입 생맥주 하이네켄 8500', '스페인 수입 병맥주 이네딧 담 11000', '하와이안 골든에일 빅 웨이브 9000', '벨기에 에일맥주 호가든 6000', '체코 흑맥주 코젤다크 6500', '카스 병맥주 5000', '2인 빠에야 세트 59000', '2~3인 빠에야 세트 79000', '3~4인 빠에야 세트 87000', '2인 스테이크 세트 57000', '2~3인 스테이크 세트 85000', '3~4인 스테이크 세트 93000', '2인 비프 부르기뇽 세트 70000', '2인 비프 부르기뇽 단품 32000', '3~4인 비프 부르기뇽 세트 120000', '3~4인 비프 부르기뇽 단품 57000', '뿔뽀 16000', '감바스 17000', '꼴뚜구 25000', '토르티야 데 빠따따 18000', '미트볼 핀쵸스 18000', '미트볼 하몽 핀쵸스 15000', '깔라마리 레뇨 23000', '미트볼 그랑 그랑 19000', '지중해식 문어 샐러드 19000', '이베리코 하몽 샐러드 21000', '그릴버섯 리코타 치즈 20000', '갈비살 버섯 샐러드 35000', '알배추 직화구이 샐러드 7000', '알배추 피쉬 앤 칩스 25000', '깔라마리 23000', '뿔뽀 프리또 17000', '트러플 오일 생감자 프렌치 프라이 11000', '마르게리따 23000', '페퍼로니 25000', '고르곤 졸라 피자 23000', '트루플라 30000', '꾸아베자 39000', '알메하 19000', '문어 맑은 해산물 스튜 25000', 'Mariscos con Paella 마리스코 파에야 23000', 'Paella mixta 파에야 믹스타 27000', 'Abalone 아발론 27000', 'Calamar calamarada negra 깔라마리 네그라 25000', 'Fideua 피데우아 27000', 'Polpo 뽈뽀 25000', '바질페스토 연어 크림 파스타 19000', '순수 순살 크림 파스타 20000', '베이컨 머쉬룸 크림 파스타 15000', '갈릭치킨 로제 파스타 17000', '비프 화이트라구 파스타 18000', '엔쵸비 토마토 오일 파스타 19000', '해산물 파스타 (오일 or 크림 or 토마토) 21000', '조개 오일 파스타 19000', '미트볼 스파이스 토마토 파스타 18000', '쉬림프 로제 or 오일 파스타 17000', '명란 오일 or 크림 16000', '프리미엄 부채살 스테이크 37000', '연어구이 모짜렐라 35000', '크리스피 치킨 스테이크 23000', '포뜨 소갈비 스테이크 35000', '바베큐 폭립 1~2인분 500g 23000', '바베큐 폭립 3~4인분 900g 39000', '바베큐 등갈비 스튜 1~2인분 500g 23000', '바베큐 등갈비 스튜 3~4인분 900g 43000', '앨레베 시라 그르나슈 37000', '앨레베 까리냥 33000', '옐로우테일 쉬라즈 39000', '오크레스크 말벡 39000', '옐로우 테일 까베르네 소비뇽 39000', '알파카 까베르네 소비뇽 27000', '뀐 오베 멜베라 41000', '데루아 멘 비노 메를로 시라 27000', '트라피체 말벡 50000', '나인 라이브스 리저브 카스 49000', '띨람파 셀렉시옹 49000', '타파스 가르나차 33000', '자몽 에이드 4500', '레몬 에이드 4500', '청포도 에이드 4500', '오렌지 에이드 4500', '트리플 베리 에이드 4500', '스프라이트 2000', '콜라제로콜라 2000', '웰치스 포도 2000', '산펠레그리노 탄산수 250ml 2500', '착즙 오렌지 주스 3000', '착즙 사과 주스 3000', '직접 입력...'] },
                { name: '피자마루 의왕내손점', distance: '도보 20분', menus: ['스테이크 불갈비 피자 16900', '바이트 바베큐 치킨 피자 15900', '하와이안 쉬림프 피자 16900', '바이트 콤비네이션 피자 17900', '골드 포테이토 피자 17900', '골드 불고구마 피자 17900', '몬스터 불고기 피자 17900', '리얼 시카고 오리지널 피자 18900', '페퍼로니 치즈폭탄 피자 23500', '이탈리안 치즈 피자 9900', '페퍼로니 피자 10900', '바베큐 치킨 피자 10900', '고구마 치킨 피자 11500', '웨지감자 피자 11900', '콤비네이션 피자 12900', '트러플바 피자 12900', '포테이토 피자 12900', '불고구마 피자 12900', '불고기 피자 13900', '명란크림새우 피자 13900', '흑마늘 불고기 피자 13900', '아메리칸 몬다 피자 13900', '몬스터 이탈리안 치즈 피자 13900', '몬스터 페퍼로니 피자 14900', '몬스터 바베큐 치킨 피자 14900', '몬스터 고구마 치킨 피자 15900', '몬스터 웨지감자 피자 15900', '몬스터 콤비네이션 피자 16900', '몬스터 트러플바 피자 16900', '몬스터 포테이토 피자 16900', '몬스터 불고구마 피자 16900', '몬스터 불고기 피자 17900', '몬스터 명란크림새우 피자 17900', '몬스터 흑마늘 불고기 피자 17900', '몬스터 아메리칸 몬다 피자 17900', '골드 이탈리안 치즈 피자 14900', '골드 페퍼로니 피자 15900', '골드 바베큐 치킨 피자 15900', '골드 고구마 치킨 피자 16900', '골드 웨지감자 피자 16900', '골드 콤비네이션 피자 17900', '골드 트러플바 피자 17900', '골드 포테이토 피자 17900', '골드 불고구마 피자 17900', '골드 불고기 피자 18900', '골드 명란크림새우 피자 18900', '골드 흑마늘 불고기 피자 18900', '골드 아메리칸 몬다 피자 18900', '바이트 이탈리안 치즈 피자 14900', '바이트 페퍼로니 피자 15900', '바이트 바베큐 치킨 피자 15900', '바이트 고구마 치킨 피자 16900', '바이트 웨지감자 피자 16900', '바이트 콤비네이션 피자 17900', '바이트 트러플바 피자 17900', '바이트 포테이토 피자 17900', '바이트 불고구마 피자 17900', '바이트 불고기 피자 18900', '바이트 명란크림새우 피자 18900', '바이트 흑마늘 불고기 피자 18900', '바이트 아메리칸 몬다 피자 18900', '리얼 시카고 오리지널 피자 18900', '페퍼로니 치즈폭탄 피자 23500', '치즈 폭탄 피자 17900', '스테이크 불갈비 피자 16900', '하와이안 쉬림프 피자 16900', '크레이지 포테이토 피자 17900', '직접 입력...'] },
                { name: '롯데리아 롯데마트 의왕점', distance: '도보 20분', menus: ['리아 불고기 세트 7300', '리아 불고기 단품 5000', '리아 불고기 베이컨 세트 8300', '리아 불고기 베이컨 단품 6000', '리아 불고기 더블 세트 9600', '리아 불고기 더블 단품 7300', '리아 새우 세트 7300', '리아 새우 단품 5000', '리아 새우 베이컨 세트 8300', '리아 새우 베이컨 단품 6100', '리아 사각새우 더블 세트 8300', '리아 사각새우 더블 단품 6100', '오징어 얼라이브 버거 세트 8600', '오징어 얼라이브 버거 단품 6400', '한우 불고기 버거 세트 14900', '한우 불고기 버거 단품 13000', '더블 한우불고기버거 세트 14200', '더블 한우불고기버거 단품 12000', '한우 불고기 버거 세트 10900', '한우 불고기 버거 단품 9000', '더블 한우불고기버거 세트 10200', '더블 한우불고기버거 단품 8000', '모짜렐라 인 더 버거 베이컨 세트 10000', '모짜렐라 인 더 버거 베이컨 단품 8000', '모짜렐라 버거 세트 13800', '모짜렐라 버거 단품 11200', '전주비빔라이스버거 세트 9200', '전주비빔라이스버거 단품 7300', '더블 엑스투 버거 세트 9200', '더블 엑스투 버거 단품 7200', '핫 크리스피 치킨 버거 세트 8300', '핫 크리스피 치킨 버거 단품 6200', 'T-REX 버거 세트 7300', 'T-REX 버거 단품 5000', '미라클 버거 세트 7900', '미라클 버거 단품 5700', '클래식치즈버거 세트 7700', '클래식치즈버거 단품 5500', '치킨버거 세트 6700', '치킨버거 단품 4300', '데리버거 세트 6100', '데리버거 단품 3700', '한우 명품팩 18500', '한우 연인팩 16700', '오징어 얼라이브 버거 (불고기맛) 세트 8600', '오징어 얼라이브 버거 (불고기맛) 단품 6400', '오징어 얼라이브 버거 (데리야끼맛) 세트 8600', '오징어 얼라이브 버거 (데리야끼맛) 단품 6400', '오징어 얼라이브 버거 (짬뽕) 세트 8600', '오징어 얼라이브 버거 (짬뽕) 단품 6400', '직접 입력...'] }
            ],
            '한식': [
                { name: '이층식당 윤경', distance: '도보 5분', menus: ['일본식 가지덮밥 10000', '오징어 제육볶음 9500', '닭볶음탕 10000', '돈안심카츠 11000', '돈카츠면세트 16000', '수제육수우동 8000', '치즈가츠 12000', '돈등심카츠 10500', '비빔냉면 8500', '물냉면 8500', '부대찌개 9500', '김치짜글이 9000', '오징어볶음 9500', '차돌 순두부찌개 9500', '우거지 뼈해장국 10000', '직접 입력...'] },
                { name: '엑스라지 텍사스 치킨보울', distance: '도보 5~10분', menus: ['텍사스 바베큐 치킨 덮밥 8900', '텍사스 토스트 & 후라이드 치킨 21900', '텍사스 파히타 29900', '크림새우치킨 with 토마토 18900', '후라이드 간장 치킨 덮밥 12900', '후라이드 양념 치킨 덮밥 12900', '마요 데리야끼 치킨 덮밥 8900', '불닭 로제 데리야끼 치킨 덮밥 8900', '쏘 핫 치킨 9900', '쉬림프 푸팟퐁 커리 치킨 덮밥 9900', '숯불갈비 데리야끼 치킨 덮밥 8900', '코리안 바베큐 치킨 덮밥 8900', '직접 입력...'] },
                { name: '다온식당', distance: '도보 5~7분', menus: ['비빔밥 8000', '콩나물돼지불고기 9000', '돼지고기 김치찌개 9000', '삼겹살조림 11000', '다온밥상 10000', '새우장 덮밥 10000', '낙지 덮밥 10000', '뚝배기소불고기 11000', '직접 입력...'] },
                { name: '밥한술', distance: '도보 15분', menus: ['해물 순두부 정식 12000', '간장제육 덮밥 12000', '제육 정식 12000', '고등어 구이 정식 12000', '김치찌개 정식 12000', '들깨 해물순두부 정식 13000', '장어 덮밥 정식 16000', '갈치 구이 정식 13000', '갈치 조림 정식 16000', '고등어 조림 정식 15000', '직접 입력...'] },
                { name: '손큰할매순대국 의왕내손점', distance: '도보 15분', menus: ['얼큰 순대국 11000', '뼈해장국 11000', '얼큰 수육국밥 11000', '소내장탕 13000', '순대국 10000', '수육국밥 10000', '직접 입력...'] },
                { name: '원조옛날보리밥', distance: '도보 15분', menus: ['보리밥 10000', '제육볶음 21000', '도토리묵 11000', '감자전 11000', '직접 입력...'] },
                { name: '효자동 솥뚜껑 의왕내손점', distance: '도보 15분', menus: ['흑돼지 삼겹살 12000', '흑돼지 오겹살 13000', '꽃목살 12000', '미나리 육회 16500', '미나리 육회 비빔밥 11000', '직접 입력...'] },
                { name: '교촌치킨 내손갈뫼점', distance: '도보 15~20분', menus: ['후라이드 21000', '양념 22000', '반반 22000', '허니 옥수수 20000', '다담치밥세트 16500', '간장 19000', '레드 20000', '살살 후라이드 20000', '파채소이 살살 19000', '직접 입력...'] },
                { name: '처갓집양념치킨 내손갈뫼점', distance: '도보 15~20분', menus: ['슈프림 양념 24000', '허니 올리고당 야채 양념 23000', '후라이드 21000', '간장 25000', '슈프림 골드 25000', '슈프림 양념 블랙라벨 24000', '마라 양념 25000', '핫슈프림 양념 23000', '치즈 슈프림 양념 23000', '꼬꼬뱅 슈프림 양념 24000', '청양산 고추 23000', '매운불 양념 23000', '닭강정 25000', '반반 21000', '직접 입력...'] },
                { name: 'BBQ 계원대점', distance: '도보 15~20분', menus: ['뿜 25000', '황금올리브 23000', '황금올리브 양념 24500', '자메이카 소떡만나 24000', '자메이카 통다리 24000', '반반 24000', '황금올리브 블랙페퍼 24000', '크런치 버터 24000', '마라핫 28000', '땡쇼크 25000', '맵소디 24500', '빠리 24000', '황금올리브 매운양념 25000', '극한 왕갈비 23000', '핫베이크 윙 24000', '스모크 22000', '직접 입력...'] },
                { name: '자담치킨 의왕계원대학점', distance: '도보 20분', menus: ['치즈핑 23000', '맵쏘이킥 23000', '마튀니 23000', '맵슐랭 23000', '핫후라이드 22000', '허니팝 23000', '왓더핫 23000', '불패 23000', '파닭 23000', '치요링 23000', '크리미양파 23000', '간장 23000', '후라이드 21000', '양념 23000', '반반 23000', '직접 입력...'] },
                { name: '닭갈비한마당', distance: '도보 20분', menus: ['닭갈비 11000', '국물 닭갈비 11000', '닭 한마리 25000', '닭 볶음탕 25000', '삼계탕 11000', '닭칼국수 6000', '닭개장 7000', '닭곰탕 7000', '직접 입력...'] },
                { name: '송골전통집', distance: '도보 20분', menus: ['보리밥 10000', '오곡솥밥 13000', '두부부침 15000', '도토리묵 10000', '감자전 12000', '두부버섯전골 29000', '닭도리탕 55000', '제육볶음 21000', '직접 입력...'] },
                { name: '시골밥상 한식뷔페', distance: '도보 20분', menus: ['한식뷔페 8000', '직접 입력...'] },
                { name: '지리산 토속촌', distance: '도보 20분', menus: ['흑돼지 갈비 묵은지찜 35000', '생삼겹 김치찜 35000', '코다리 김치찜 35000', '묵은지 닭찜 40000', '묵은지 두부 보쌈 35000', '토종닭 김치찜 50000', '묵은지 홍어 삼합 40000', '홍어 묵은지 25000', '홍어전 25000', '간장 코다리 25000', '매운 마늘코다리 30000', '해물 갈치조림 30000', '흑돼지 불고기 20000', '고추장 불고기 22000', '묵은지 제육 30000', '더덕 제육 30000', '쭈꾸미볶음 35000', '낙지볶음 35000', '닭도리탕 30000', '묵은지 전골 25000', '고추장찌개 25000', '해물 순두부 18000', '알탕 25000', '대구지리 30000', '해물 동태탕 25000', '참치 김치찌개 20000', '직접 입력...'] }
            ],
            '학식당': [
                { name: '학식당', distance: '계원예술대학교', menus: ['사골떡만둣국 6500', '치킨마요덮밥 6500', '고추참치마요덮밥 6500', '분모자 매콤라볶이 6000', '로제 라볶이 6000', '뚝배기 불고기 6500', '육개장 6500', '부대찌개 6500', '제육볶음 6500', '유부우동 6500', '모듬라면 4900', '채소라면 4900', '미트소스 스파게티 6000', '까르보나라 스파게티 6000', '치즈돈까스 6500', '등심돈까스 6000', '직접 입력...'] }
            ],
            '디저트': [
                { name: '띵크어바웃커피', distance: '도보 5~10분', menus: ['아메리카노 3000', '헤이즐넛 아메리카노 3500', '카페 라떼 3500', '카푸치노 3500', '플랫화이트 3500', '콜드브루 4000', '바닐라 라떼 4000', '헤이즐넛 라떼 4000', '연유 라떼 4000', '카페모카 4500', '카라멜 마끼아또 4500', '초코라떼 4000', '오곡라떼 4500', '녹차라떼 4500', '밀크티 4500', '딸기 라떼 5000', '유기농티 4500', '담금차 4500', '아이스티 4000', '생과일쥬스 5500', '생과일에이드 6000', '요거트스무디 5000', '아포가토 5500', '소금빵 3700', '초코칩 브라우니 3500', '크로플 3000', '크로플세트 8000', '직접 입력...'] },
                { name: '빽다방 의왕계원예대점', distance: '도보 5~10분', menus: ['더블에스프레스 1500', '완전초코 핫 3500', '앗!메리카노 핫 1500', '앗!메리카노 아이스 2000', '원조커피 핫 2500', '원조커피 아이스 2000', '빽\'s라떼 핫 2500', '빽\'s라떼 아이스 3000', '달달연유라떼 핫 3500', '달달연유라떼 아이스 3500', '바닐라라떼 핫 3000', '바닐라라떼 아이스 3000', '카페모카 핫 3000', '카페모카 아이스 3500', '카라멜마키아또 핫 3000', '카라멜마키아또 아이스 3500', '민트초코 빽스치노 소프트 4000', '완전망고 3500', '몽땅쉐이크 딸기 4000', '몽땅쉐이크 바닐라 4000', '프로틴쉐이크 바나나 4000', '프로틴쉐이크 초콜릿 4000', '밀크쉐이크 3000', '딸기요거트스무디 4000', '플레인요거트스무디 3000', '노말한소프트 1500', '크리미슈 1500', '크리미단팥빵 1500', '콘마들렌 2500', '긴페스츄리 와플 2500', '사라다빵 2500', '완전초코 핫 3000', '완전초코 아이스 3500', '자몽티 3500', '녹차라떼 핫 3000', '녹차라떼 아이스 3500', '토피넛라떼 3000', '민트초코라떼 3000', '블랙펄라떼 3500', '블랙펄 밀크티 4000', '밀크티 핫 3000', '밀크티 아이스 3500', '청포도 플라워 3500', '아이스티 2500', '깔라만시에이드 3000', '미숫가루 2500', '달콤아이스티 2000', '깔라만시 3000', '민트초코 빽스치노 소프트 4000', '쿠키크런치 빽스치노 소프트 4000', '완전딸기 4000', '레몬티 3500', '몽땅쉐이크(라떼) 3500', '원조빽스치노 베이직 3500', '원조빽스치노 소프트 3500', '완전딸기 베이직 3500', '완전초코 베이직 3500', '완전딸기바나나 베이직 3500', '완전초코바나나 베이직 3500', '완전초코바나나 소프트 4000', '완전딸기바나나 소프트 4000', '완전초코 소프트 4000', '완전딸기 소프트 4000', '녹차 빽스치노 베이직 3500', '민트초코 빽스치노 베이직 3500', '쿠키크런치 빽스치노 베이직 3500', '녹차 빽스치노 소프트 4000', '피스타치오빽스치노 베이직 4500', '피스타치오빽스치노 소프트 5000', '직접 입력...'] },
                { name: '커피케어', distance: '도보 10~15분', menus: ['아메리카노[핸드드립] 5000', '콜드브루(더치커피) 5000', '더치라떼(차가운것만) 5000', '콜드브루(더치커피) 1병 11000', '콜드브루(더치커피) 2병 22000', '에스프레소 5000', '카페라떼 5000', '카페라떼 단거 5000', '카푸치노 5000', '플랫화이트 5000', '밀크티 5000', '블렌딩 티 5000', '직접 입력...'] },
                { name: '구월제과', distance: '도보 10~15분', menus: ['탕종단팥빵 2800', '소보루빵 2500', '완두앙금빵 2800', '단팥소보루 3000', '슈크림빵 3500', '거북이메론빵 3500', '맘모스 5500', '탕종모닝빵(6입) 3500', '초코모닝빵(6입) 4000', '통밀모닝빵(6입) 4000', '야채모닝빵 (6입) 4500', '쌀가루 소금빵 2800', '소보루소금빵 3500', '모카소금빵 3500', '초코소금빵 3500', '소금키(소금빵+쿠키) 4000', '가나슈크런치 4200', '초코쫀득빵 4200', '올리브치아바타 3500', '루꼴라치아바타 3500', '베이컨할라피뇨포카치아 4000', '플레인바게트 3500', '치즈바게트 4500', '마늘스틱(2입) 3000', '마늘바게트 4500', '명란바게트 4000', '피자바게트 4200', '우유식빵 4500', '유기농통밀식빵 5500', '치즈스틱 3800', '코코넛 4000', '에그타르트 3800', '초코칩쿠키 2500', '마카다미아크랜베리쿠키 2500', '얼그레이파운드(조각) 3500', '쫀득쿠키 오레오 4800', '쫀득쿠키 후르츠링 4800', '후르츠산도 4800', '생크림케이크 쁘띠 8500', '생크림케이크 홀 30000', '직접 입력...'] },
                { name: '보네르 의왕', distance: '도보 10~15분', menus: ['아메리카노 핫 2500', '아메리카노 아이스 3000', '카페라떼 핫 3000', '카페라떼 아이스 3500', '카라멜마끼야또 핫 3500', '카라멜마끼야또 아이스 4000', '카페모카 핫 3500', '카페모카 아이스 4000', '에그타르트 2000', '호두파이 2800', '육쪽마늘빵 4000', '크로와상 2300', '무화과깜빠뉴 5000', '시나몬러스크 3000', '치아바타 1500', '밤식빵 4000', '크림치즈베이글 2800', '햄치즈 모닝 3000', '모닝빵 3500', '생크림 버터크림 1500', '크림치즈머핀 3500', '초코머핀 2000', '크랜베리스콘 1500', '녹차타르트 2800', '바질스콘 1500', '밤만주 3500', '황남빵 3000', '크랜베리쿠키 5000', '쿠키선물세트 15000', '직접 입력...'] },
                { name: '남매카페', distance: '도보 15분', menus: ['아메리카노 4200', '카페라떼 4800', '바닐라라떼 5400', '카페모카 5600', '카라멜마끼야또 5600', '연유라떼 5600', '흑당라떼 5600', '초코라떼 5200', '[수제] 아이스티 5000', '[수제] 밀크티 5400', '[수제] 딸기라떼 5400', '녹차라떼 5200', '자색고구마라떼 5200', '오곡라떼 (미숫가루) 5200', '검은콩라떼 5400', '토마토 듬뿍쥬스 6200', '키위 듬뿍쥬스 6200', '바나나 듬뿍쥬스 6200', '수박 듬뿍쥬스 6200', '플레인요거트 스무디 6500', '망고요거트 스무디 6500', '블루베리요거트 스무디 6500', '커피밀크 쉐이크 6500', '딸기 쉐이크 6500', '쿠앤크 프라페 6700', '민트초코 프라페 6700', '녹차 프라페 6700', '유자 차 5000', '자몽 차 5000', '오과 차 5000', '대추 차 5000', '생강 차 5000', '청귤 차 5000', '[수제] 레몬차 5400', '호박식혜 5000', '수정과 5000', '레몬 에이드 5600', '자몽 에이드 5600', '키위 에이드 5600', '파인애플 에이드 5600', '패션후르츠 에이드 5600', '마카롱 2800', '휘낭시에 2700', '약과쿠키 3600', '크랜베리스콘 3800', '스모어쿠키 4500', '르뱅쿠키 4500', '치즈머핀 3700', '다크초코피칸머핀 4000', '플레인 베이글 4200', '블루베리크림치즈 베이글 4200', '모닝토스트 4200', '플레인 크로 4800', '달달 크로플 4800', '누텔라 크로플 4800', '크림치즈 크로플 5400', '오레오 크로플 5400', '아이스크림 크로플 5700', '크림단팥빵 3500', '대만햄치즈샌드위치 3500', '연유밀크모닝 5400', '허니브레드 6700', '케이크 60000~65000', '카모마일 차 (잎차) 4800', '페퍼민트 차 (잎차) 4800', '라벤더 차 (잎차) 4800', '히비스커스 차 (잎차) 4800', '루이보스 차 (잎차) 4800', '얼그레이 차 (잎차) 4800', '녹차 (잎차) 4800', '직접 입력...'] },
                { name: '카페만월경 의왕내손점', distance: '도보 15분', menus: ['아메리카노 1900', '카페라떼 2600', '연한 아메리카노 1700', '바닐라라떼 3200', '복숭아아메리카노 (아샷추) 3000', '카라멜 마끼아또 3300', '카페모카 3200', '헤이즐넛 아메리카노 2700', '헤이즐넛 카페라떼 3500', '고구마라떼 2900', '고래로쉐 3200', '딸기라떼 2900', '리얼팡팡 복숭아라떼 3200', '리얼초코라떼 3000', '복숭아 아이스티 1900', '딸기 에이드 2500', '레몬 에이드 2500', '복숭아 에이드 2500', '자몽 에이드 2500', '청포도 에이드 2500', '리얼 레몬티 2500', '리얼 복숭아티 2500', '리얼 자몽티 2500', '르뱅쿠키 2900', '마카롱 2100', '생크림스콘 2800', '티백 (레몬얼그레이) 1500', '티백 (오렌지자몽블랙) 1500', '햄치즈에그샌드위치 2500', '직접 입력...'] },
                { name: '요거프레소 의왕계원예대점', distance: '도보 15분', menus: ['아메리카노 (R) 2500', '아메리카노 (L) 3000', '카페라떼 (R) 3300', '카페라떼 (L) 3800', '카푸치노 (R) 3300', '카푸치노 (L) 3800', '바닐라 라떼 (R) 3800', '바닐라 라떼 (L) 4300', '솔티 모카치노 (R) 3500', '솔티 모카치노 (L) 4000', '카라멜 마끼아또 (R) 3500', '카라멜 마끼아또 (L) 4000', '민트 모카라떼 (R) 3800', '민트 모카라떼 (L) 4300', '카페모카 (R) 3800', '카페모카 (L) 4300', '카라멜 카페모카 (R) 3800', '카라멜 카페모카 (L) 4300', '화이트 카페모카 (R) 3800', '화이트 카페모카 (L) 4300', '초코 라떼 (R) 3500', '초코 라떼 (L) 4000', '그린티 라떼 (R) 3800', '그린티 라떼 (L) 4300', '블랙티 라떼 (R) 3800', '블랙티 라떼 (L) 4300', '고구마 라떼 (R) 3800', '고구마 라떼 (L) 4300', '블랙빈 라떼 (R) 3800', '블랙빈 라떼 (L) 4300', '아이스티 (레몬/복숭아) (L) 3300', '에이드 (레몬/유자/자몽/오렌지) (L) 3300', '생과일주스 (계절과일) (L) 4500', '에스프레소 솔로 2300', '에스프레소 마끼아또 2800', '에스프레소 콘 파냐 3000', '홍차 (잉글리쉬 블랙퍼스트) 3800', '홍차 (얼그레이 플라워) 3800', '허브티 (캐모마일) 3800', '허브티 (페퍼민트) 3800', '허브티 (베리베리마테) 3800', '루이보스 (레몬프레쉬) 3800', '루이보스 (초콜라타 넘버10) 3800', '그린티 3800', '후르츠티 (유자티) 3800', '후르츠티 (레몬티) 3800', '딸기 생크림 오믈렛 (18EA) 12500', '바나나 생크림 오믈렛 (18EA) 10500', '블루베리 생크림 오믈렛 (18EA) 10500', '딸기&치즈 스노우 빙수 11000', '더블 그린티 스노우 빙수 10800', '트리플 치즈 스노우 빙수 12000', '트리플 초코 스노우 빙수 10800', '콩고물 스노우 빙수 9500', '망고&치즈 스노우 빙수 11000', '딸기&바나나 스노우 빙수 11500', '직접 입력...'] },
                { name: '더벤티 의왕포일점', distance: '도보 15분', menus: ['(핫/아이스) 이천 쌀 라떼 2800', '(핫/아이스) 이천 쌀 흑임자 폼 라떼 3300', '이천 쌀 아인 슈페너 3300', '이천 쌀 말차 쉐이키 3500', '수박 주스 4300', '수박 라떼 3800', '수박 멜론 크러쉬 4300', '판단 피스타치오 카페라떼 3900', '판단 코코넛 카페라떼 3900', 'HOT 아메리카노 1500', 'ICE 아메리카노 2000', '카페라떼 3000', '오트 카페라떼 3800', '바닐라 딥라떼 3500', '헤이즐넛 딥라떼 3500', '카라멜 마끼아또 3500', '믹스커피 2500', '연유 라떼 3500', '카페모카 3500', '코코넛 라떼 3500', '아이스크림 라떼 3900', '콜드브루 3300', '콜드브루 라떼 3800', '크림 콜드브루 (바닐라) 4000', '크림 콜드브루 (헤이즐넛) 4000', '아인슈페너 3500', '말차 아인슈페너 3500', '딸기 라떼 3500', '딸기 연유 라떼 4300', '로얄 밀크티 3500', '코코프라페 (코코밀크) 3900', '코코프라페 (코코초코) 3900', '딸기 쿠키 프라페 4500', '코코넛 커피 프라페 4500', '말차 프라페 3900', '복숭아 아이스티 3000', '허니티 (유자) 3500', '허니티 (자몽) 3500', '허니티 (레몬) 3500', '블랜딩티 (자몽 허니 블랙티) 3500', '블랜딩티 (유자 애플티) 3500', '체리콕 3900', '크림 소다 3900', '메론 소다 3900', '에이드 (레몬) 3900', '에이드 (자몽) 3900', '에이드 (애플망고) 3900', '요거트 스무디 (플레인) 3900', '요거트 스무디 (딸기) 3900', '요거트 스무디 (블루베리) 3900', '요거트 스무디 (망고) 3900', '쉐이크 (밀크) 3900', '쉐이크 (초코) 3900', '쉐이크 (에스프레소) 3900', '크러쉬 (망고패션) 4200', '크러쉬 (자두피치) 4200', '프라페 (쿠키앤크림) 3900', '프라페 (자바칩) 3900', '프라페 (율무) 3900', '티 (애플 히비스커스) 2500', '티 (리치 캐모마일) 2500', '티 (청귤 얼그레이) 2500', '티 (트리플 민트) 2500', '미숫가루 3000', '말차라떼 3500', '초코라떼 3500', '멜팅초코 3900', '율무오트라떼 3900', '과채주스 (오렌지) 4300', '과채주스 (애플) 4300', '버블티 (흑설탕) 3900', '버블티 (타로) 3900', '직접 입력...'] },
                { name: '메가커피 계원예대점', distance: '도보 15분', menus: ['아메리카노 (HOT) 1700', '아메리카노 (ICE) 2000', '메가리카노 (946ml) 3300', '옛날커피 (HOT) 2400', '옛날커피 (ICE) 2400', '왕메가옛날커피 (946ml) 3400', '헤이즐넛 아메리카노 (HOT) 2700', '헤이즐넛 아메리카노 (ICE) 2700', '바닐라 아메리카노 (HOT) 2700', '바닐라 아메리카노 (ICE) 2700', '꿀 아메리카노 (HOT) 2700', '꿀 아메리카노 (ICE) 2700', '콜드 브루 (HOT) 3500', '콜드 브루 (ICE) 3500', '콜드 브루 라떼 (HOT) 4000', '콜드 브루 라떼 (ICE) 4000', '큐브라떼 4200', '카페라떼 (HOT) 2900', '카페라떼 (ICE) 2900', '카푸치노 (HOT) 2900', '카푸치노 (ICE) 2900', '왕메가카페라떼 (946ml) 4400', '바닐라라떼 (HOT) 3400', '바닐라라떼 (ICE) 3400', '헤이즐넛라떼 (HOT) 3400', '헤이즐넛라떼 (ICE) 3400', '라이트 바닐라 아몬드라떼 (HOT) 3900', '라이트 바닐라 아몬드라떼 (ICE) 3900', '연유라떼 (HOT) 3900', '연유라떼 (ICE) 3900', '카라멜마끼아또 (HOT) 3700', '카라멜마끼아또 (ICE) 3900', '카페모카 (HOT) 3700', '카페모카 (ICE) 3900', '할매커피 2100', '할매가미숫가루커피 2900', '왕할매커피 (946ml) 3200', '딸기라떼 3700', '왕메가초코 (946ml) 4400', '오레오초코 3900', '핫초코 / 아이스초코 (HOT) 3500', '핫초코 / 아이스초코 (ICE) 3500', '곡물라떼 (HOT) 3300', '곡물라떼 (ICE) 3300', '녹차라떼 (HOT) 3500', '녹차라떼 (ICE) 3500', '로얄밀크티 (HOT) 3700', '로얄밀크티 (ICE) 3700', '토피넛라떼 (HOT) 3800', '토피넛라떼 (ICE) 3800', '고구마라떼 (HOT) 3500', '고구마라떼 (ICE) 3500', '흑당라떼 3300', '흑당버블라떼 3700', '흑당밀크티라떼 3500', '흑당버블밀크티라떼 3800', '플레인 퐁크러쉬 3900', '바나나 퐁크러쉬 3900', '딸기 퐁크러쉬 3900', '초코 퐁크러쉬 3900', '쿠키 프라페 3900', '딸기쿠키 프라페 3900', '민트 프라페 3900', '녹차 프라페 3900', '리얼초코 프라페 3900', '커피 프라페 3900', '코코넛 커피 스무디 4800', '골든 펄 톡톡 스무디 3900', '골드망고 스무디 3900', '요거트 스무디 (플레인) 3900', '요거트 스무디 (망고) 3900', '요거트 스무디 (블루베리) 3900', '요거트 스무디 (딸기) 3900', '골드키위 4000', '피치자몽 4000', '딸기 4000', '딸기바나나 4000', '메가 에이드 (레몬+자몽+라임) 3900', '제로 부스트 에이드 3000', '제리 콜라 3300', '자몽 에이드 3500', '청포도 에이드 3500', '레몬 에이드 3500', '블루레몬 에이드 3500', '라임 모히또 3800', '허니자몽블랙티 (HOT) 3700', '허니자몽블랙티 (ICE) 3700', '사과유자차 (HOT) 3500', '사과유자차 (ICE) 3500', '왕메가 사과유자차 (946ml) 4400', '상큼리치티 (HOT) 3900', '상큼리치티 (ICE) 3900', '유자차 (HOT) 3300', '유자차 (ICE) 3300', '레몬차 (HOT) 3300', '레몬차 (ICE) 3300', '자몽차 (HOT) 3300', '자몽차 (ICE) 3300', '복숭아 아이스티 (HOT) 3000', '복숭아 아이스티 (ICE) 3000', '제로 복숭아 아이스티 3000', '왕메가 아이스티 (946ml) 3900', '녹차 (HOT) 2500', '녹차 (ICE) 2500', '얼그레이 (HOT) 2500', '얼그레이 (ICE) 2500', '캐모마일 (HOT) 2500', '캐모마일 (ICE) 2500', '페퍼민트 (HOT) 2500', '페퍼민트 (ICE) 2500', '직접 입력...'] }
            ]
        };

        const departments = [
            '공간연출과',
            '사진예술과',
            '순수미술과',
            '융합예술과',
            '광고\'브랜드디자인과',
            '시각디자인과',
            '게임미디어과',
            '디지털미디어디자인과',
            '애니메이션과',
            '영상디자인과',
            '리빙가구디자인과',
            '스마트로덕트디자인과',
            '플라워디자인과',
            '건축디자인과',
            '실내건축디자인과',
            '전시콘텐츠디자인과',
            '스페이스아트엔테크놀로지전공',
            '메타스페이스전공',
            'VR콘텐츠디자인전공'
        ];

        const keywords = [
            '양 많음', '양 적음', '빨리 나옴', '가성비 좋음', '조용함',
            '혼밥 가능', '불친절', '청결함', '재방문 의사 있음'
        ];

        // ============================================
        // 🎯 상태 관리 (State Management)
        // ============================================
        
        // 선택된 값 저장
        let selectedTime = '';
        let selectedMood = '';
        let selectedVisuals = [];
        let selectedKeywords = [];
        let currentSelectedCategory = null; // 현재 선택된 카테고리
        let ratingScores = {
            taste: 0,
            portion: 0,
            value: 0,
            service: 0
        };

        // Google Apps Script API URL (배포된 웹 앱 URL)
        const API_URL = 'https://script.google.com/macros/s/AKfycbyoX46ZvZqZv13PmeMII5ltxIEQp4uW78e_mUMjfbNEf8tMg_Dk2UZf4Y3NCm5ksFCyBg/exec';

        // ============================================
        // 🖥️ 화면 관리 (Screen Management)
        // ============================================
        
        // 화면 전환 함수 (React 스타일)
        function showScreen(screenId) {
            // 모든 화면 숨기기
            const screens = document.querySelectorAll('.screen');
            for (let i = 0; i < screens.length; i++) {
                screens[i].classList.remove('active');
            }
            
            // 선택한 화면 표시
            const targetScreen = document.getElementById(screenId + 'Screen');
            if (targetScreen) {
                targetScreen.classList.add('active');
            }
            
            // 모든 네비게이션 버튼의 active 클래스 제거
            const allNavItems = document.querySelectorAll('.nav-item');
            for (let i = 0; i < allNavItems.length; i++) {
                allNavItems[i].classList.remove('active');
            }
            
            // 현재 화면에 해당하는 네비게이션 버튼에 active 클래스 추가
            const activeNavItems = document.querySelectorAll(`.nav-item[data-view="${screenId}"]`);
            for (let i = 0; i < activeNavItems.length; i++) {
                activeNavItems[i].classList.add('active');
            }
            
            // 네비게이션 바 표시/숨김 제어 (홈, 지도, 트렌드 화면에서 표시)
            const allNavs = document.querySelectorAll('.bottom-nav');
            for (let i = 0; i < allNavs.length; i++) {
                if (screenId === 'home' || screenId === 'map' || screenId === 'trend') {
                    allNavs[i].classList.add('show');
                } else {
                    allNavs[i].classList.remove('show');
                }
            }
            
            // 화면별 데이터 로드
            if (screenId === 'trend') {
                // 트렌드 화면 진입 시 항상 최신 데이터 강제 로드
                if (!window.isLoadingTrendData) {
                    window.isLoadingTrendData = true;
                    // 강제 새로고침으로 최신 데이터 가져오기
                    loadTrendData(true).finally(() => {
                        window.isLoadingTrendData = false;
                    });
                }
                loadComments(); // 댓글 로드
            } else if (screenId === 'map') {
                loadMapData();
            }
        }

        // ============================================
        // 🎨 UI 초기화 및 이벤트 핸들러
        // ============================================
        
        // 인기 식당 탭 클릭 이벤트
        // 드롭다운 선택 시 파란색 제거 및 주황색 적용
        function removeBlueSelection() {
            const selects = document.querySelectorAll('.form-select');
            selects.forEach(select => {
                // change 이벤트로 선택된 옵션의 스타일 강제 적용
                select.addEventListener('change', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    if (selectedOption) {
                        // 모든 옵션의 selected 속성 제거
                        Array.from(this.options).forEach(opt => {
                            opt.removeAttribute('selected');
                        });
                        // 선택된 옵션에 selected 속성 추가
                        selectedOption.setAttribute('selected', 'selected');
                    }
                });
                
                // focus 이벤트로도 처리
                select.addEventListener('focus', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    if (selectedOption) {
                        selectedOption.style.backgroundColor = '#FD4B21';
                        selectedOption.style.color = '#FFFFFF';
                    }
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // 드롭다운 파란색 제거 함수 호출
            removeBlueSelection();
            
            // 인기 식당 탭 버튼 클릭 이벤트
            const tabButtons = document.querySelectorAll('.tab-btn[data-period]');
            tabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 모든 탭 버튼에서 active 제거
                    tabButtons.forEach(b => b.classList.remove('active'));
                    // 클릭한 버튼에 active 추가
                    this.classList.add('active');
                    
                    // 인기 식당 업데이트
                    const records = recordsCache || [];
                    updatePopularRestaurants(records);
                });
            });
            
            // 예시 데이터는 제거 - 실제 데이터 로드 후 표시
        });
        
        // 인기 식당 탭 클릭 이벤트 초기화
        function initPopularRestaurantTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn[data-period]');
            tabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 모든 탭 버튼에서 active 제거
                    tabButtons.forEach(b => b.classList.remove('active'));
                    // 클릭한 버튼에 active 추가
                    this.classList.add('active');
                    
                    // 인기 식당 업데이트
                    const records = recordsCache || [];
                    updatePopularRestaurants(records);
                });
            });
        }
        
        // 카테고리 버튼 클릭 이벤트
        document.addEventListener('DOMContentLoaded', function() {
            // 인기 식당 탭 이벤트 초기화
            initPopularRestaurantTabs();
            
            // 예시 데이터는 제거 - 실제 데이터 로드 후 표시
            
            // 카테고리 버튼 클릭 함수
            function handleCategoryClick(category) {
                currentSelectedCategory = category; // 카테고리 저장
                
                // 기록 화면으로 전환하고 카테고리 전달
                showScreen('record');
                // 화면 전환 후 약간의 지연을 두고 식당 목록 로드
                setTimeout(() => {
                    loadRestaurants(category);
                }, 100);
            }

            const categoryButtons = document.querySelectorAll('.category-btn');
            categoryButtons.forEach(btn => {
                const category = btn.getAttribute('data-category');
                
                // click 이벤트
                btn.addEventListener('click', function() {
                    handleCategoryClick(category);
                });
                
                // 모바일 터치 지원: touchstart 이벤트로 즉시 처리
                btn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    handleCategoryClick(category);
                }, { passive: false });
            });

            // 식당 선택 시 메뉴 로드 및 다음 단계 표시
            const restaurantSelect = document.getElementById('restaurantSelect');
            if (restaurantSelect) {
                // 선택된 옵션의 파란색 제거 및 주황색 적용
                restaurantSelect.addEventListener('change', function() {
                    // 모든 옵션의 스타일 초기화
                    Array.from(this.options).forEach(opt => {
                        opt.style.backgroundColor = '';
                        opt.style.color = '';
                    });
                    // 선택된 옵션에 주황색 적용
                    const selectedOption = this.options[this.selectedIndex];
                    if (selectedOption && selectedOption.value) {
                        selectedOption.style.backgroundColor = '#FD4B21';
                        selectedOption.style.color = '#FFFFFF';
                    }
                });
                
                restaurantSelect.addEventListener('change', function() {
                    if (this.value) {
                        loadMenus(this.value);
                        // 메뉴 섹션 표시
                        const menuSection = document.getElementById('menuSection');
                        if (menuSection) {
                            menuSection.style.display = 'block';
                            // 애니메이션을 위해 약간의 지연 후 클래스 추가
                            setTimeout(() => {
                                menuSection.classList.add('show');
                                menuSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            }, 10);
                        }
                    } else {
                        // 식당 선택 취소 시 메뉴 섹션 숨기기
                        const menuSection = document.getElementById('menuSection');
                        if (menuSection) {
                            menuSection.classList.remove('show');
                            setTimeout(() => {
                                menuSection.style.display = 'none';
                            }, 400);
                        }
                    }
                });
            }

            // 메뉴 선택 시 학과 섹션 표시
            const menuSelect = document.getElementById('menuSelect');
            if (menuSelect) {
                // 선택된 옵션의 파란색 제거 및 주황색 적용 (모든 이벤트에서)
                function applyOrangeStyle(select) {
                    Array.from(select.options).forEach(opt => {
                        opt.style.backgroundColor = '';
                        opt.style.color = '';
                    });
                    const selectedOption = select.options[select.selectedIndex];
                    if (selectedOption && selectedOption.value) {
                        selectedOption.style.backgroundColor = '#FD4B21';
                        selectedOption.style.color = '#FFFFFF';
                    }
                }
                
                // change 이벤트
                menuSelect.addEventListener('change', function() {
                    applyOrangeStyle(this);
                });
                
                // focus 이벤트
                menuSelect.addEventListener('focus', function() {
                    applyOrangeStyle(this);
                });
                
                // click 이벤트
                menuSelect.addEventListener('click', function() {
                    setTimeout(() => applyOrangeStyle(this), 10);
                });
                
                // blur 이벤트 (드롭다운이 닫힐 때)
                menuSelect.addEventListener('blur', function() {
                    setTimeout(() => applyOrangeStyle(this), 100);
                });
                
                menuSelect.addEventListener('change', function() {
                    // 직접 입력 옵션 처리
                    const customMenuInput = document.getElementById('customMenuInput');
                    const customMenuName = document.getElementById('customMenuName');
                    
                    if (this.value === '직접 입력...') {
                        // 직접 입력 필드 표시
                        if (customMenuInput) {
                            customMenuInput.style.display = 'block';
                            if (customMenuName) {
                                setTimeout(() => {
                                    customMenuName.focus();
                                }, 100);
                            }
                        }
                    } else {
                        // 직접 입력 필드 숨기기
                        if (customMenuInput) {
                            customMenuInput.style.display = 'none';
                        }
                        
                        // 학과 섹션 표시 (메뉴 선택 시)
                        if (this.value) {
                            const departmentSection = document.getElementById('departmentSection');
                            if (departmentSection) {
                                departmentSection.style.display = 'block';
                                setTimeout(() => {
                                    departmentSection.classList.add('show');
                                    departmentSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                                }, 10);
                            }
                        } else {
                            const departmentSection = document.getElementById('departmentSection');
                            if (departmentSection) {
                                departmentSection.classList.remove('show');
                                setTimeout(() => {
                                    departmentSection.style.display = 'none';
                                }, 400);
                            }
                        }
                    }
                });
            }
            
            // 메뉴 직접 입력 필드 이벤트 리스너 (전역으로 한 번만 등록)
            const customMenuInput = document.getElementById('customMenuInput');
            const customMenuName = document.getElementById('customMenuName');
            const submitCustomMenu = document.getElementById('submitCustomMenu');
            const cancelCustomMenu = document.getElementById('cancelCustomMenu');
            // menuSelect는 위에서 이미 선언됨
            
            // 직접 입력 확인 버튼
            if (submitCustomMenu && customMenuName && menuSelect) {
                // 기존 이벤트 리스너 제거를 위해 한 번만 등록
                if (!submitCustomMenu.hasAttribute('data-listener-attached')) {
                    submitCustomMenu.setAttribute('data-listener-attached', 'true');
                    
                    submitCustomMenu.addEventListener('click', function() {
                        const menuName = customMenuName.value.trim();
                        if (menuName) {
                            // "직접 입력..." 옵션 찾기
                            let directInputOption = null;
                            for (let i = 0; i < menuSelect.options.length; i++) {
                                if (menuSelect.options[i].value === '직접 입력...') {
                                    directInputOption = menuSelect.options[i];
                                    break;
                                }
                            }
                            
                            if (directInputOption) {
                                // 기존 "직접 입력..." 옵션을 직접 입력한 메뉴로 교체
                                directInputOption.value = menuName;
                                directInputOption.textContent = menuName;
                            } else {
                                // 옵션이 없으면 새로 추가
                                const newOption = document.createElement('option');
                                newOption.value = menuName;
                                newOption.textContent = menuName;
                                menuSelect.appendChild(newOption);
                            }
                            
                            // 메뉴 선택값 설정
                            menuSelect.value = menuName;
                            
                            // change 이벤트 강제 발생 (다른 리스너들이 인식하도록)
                            const changeEvent = new Event('change', { bubbles: true });
                            menuSelect.dispatchEvent(changeEvent);
                            
                            // 직접 입력 필드 숨기기 및 초기화
                            if (customMenuInput) {
                                customMenuInput.style.display = 'none';
                            }
                            customMenuName.value = '';
                            
                            // 학과 섹션 표시
                            const departmentSection = document.getElementById('departmentSection');
                            if (departmentSection) {
                                departmentSection.style.display = 'block';
                                setTimeout(() => {
                                    departmentSection.classList.add('show');
                                    departmentSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                                }, 10);
                            }
                        } else {
                            alert('메뉴 이름을 입력해주세요.');
                        }
                    });
                    
                    // Enter 키로도 확인 가능
                    customMenuName.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            submitCustomMenu.click();
                        }
                    });
                }
            }
            
            // 직접 입력 취소 버튼
            if (cancelCustomMenu && menuSelect) {
                if (!cancelCustomMenu.hasAttribute('data-listener-attached')) {
                    cancelCustomMenu.setAttribute('data-listener-attached', 'true');
                    
                    cancelCustomMenu.addEventListener('click', function() {
                        if (customMenuInput) {
                            customMenuInput.style.display = 'none';
                        }
                        if (customMenuName) {
                            customMenuName.value = '';
                        }
                        menuSelect.value = '';
                    });
                }
            }

            // 학과 선택 시 소요 시간 및 기분 섹션 표시
            const departmentSelect = document.getElementById('departmentSelect');
            if (departmentSelect) {
                // 선택된 옵션의 파란색 제거 및 주황색 적용
                departmentSelect.addEventListener('change', function() {
                    Array.from(this.options).forEach(opt => {
                        opt.style.backgroundColor = '';
                        opt.style.color = '';
                    });
                    const selectedOption = this.options[this.selectedIndex];
                    if (selectedOption && selectedOption.value) {
                        selectedOption.style.backgroundColor = '#FD4B21';
                        selectedOption.style.color = '#FFFFFF';
                    }
                });
                
                departmentSelect.addEventListener('change', function() {
                    if (this.value) {
                        const timeSection = document.getElementById('timeSection');
                        const moodSection = document.getElementById('moodSection');
                        if (timeSection) {
                            timeSection.style.display = 'block';
                            setTimeout(() => {
                                timeSection.classList.add('show');
                                timeSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            }, 10);
                        }
                        if (moodSection) {
                            moodSection.style.display = 'block';
                            setTimeout(() => {
                                moodSection.classList.add('show');
                            }, 10);
                        }
                    } else {
                        const timeSection = document.getElementById('timeSection');
                        const moodSection = document.getElementById('moodSection');
                        if (timeSection) {
                            timeSection.classList.remove('show');
                            setTimeout(() => {
                                timeSection.style.display = 'none';
                            }, 400);
                        }
                        if (moodSection) {
                            moodSection.classList.remove('show');
                            setTimeout(() => {
                                moodSection.style.display = 'none';
                            }, 400);
                        }
                    }
                });
            }

            // 식당 추가 요청 버튼
            const addRestaurantBtn = document.getElementById('addRestaurantBtn');
            const customRestaurantInput = document.getElementById('customRestaurantInput');
            const submitCustomBtn = document.getElementById('submitCustomRestaurant');
            const cancelCustomBtn = document.getElementById('cancelCustomRestaurant');
            const customRestaurantName = document.getElementById('customRestaurantName');

            if (addRestaurantBtn) {
                addRestaurantBtn.addEventListener('click', function() {
                    customRestaurantInput.style.display = 'block';
                    customRestaurantName.focus();
                });
            }

            if (submitCustomBtn) {
                submitCustomBtn.addEventListener('click', function() {
                    const restaurantName = customRestaurantName.value.trim();
                    if (restaurantName) {
                        // 사용자 입력 식당을 선택 목록에 추가
                        const option = document.createElement('option');
                        option.value = restaurantName;
                        option.textContent = restaurantName + ' (직접 입력)';
                        option.setAttribute('data-menus', JSON.stringify(['직접 입력...']));
                        option.setAttribute('data-custom', 'true');
                        restaurantSelect.appendChild(option);
                        restaurantSelect.value = restaurantName;
                        loadMenus(restaurantName);
                        
                        // 입력 필드 숨기기 및 초기화
                        customRestaurantInput.style.display = 'none';
                        customRestaurantName.value = '';
                        
                        // 메뉴 섹션 표시
                        const menuSection = document.getElementById('menuSection');
                        if (menuSection) {
                            menuSection.style.display = 'block';
                            setTimeout(() => {
                                menuSection.classList.add('show');
                                menuSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            }, 10);
                        }
                    } else {
                        alert('식당 이름을 입력해주세요.');
                    }
                });
            }

            if (cancelCustomBtn) {
                cancelCustomBtn.addEventListener('click', function() {
                    customRestaurantInput.style.display = 'none';
                    customRestaurantName.value = '';
                });
            }

            // 학과 목록 로드
            loadDepartments();
            
            // 키워드 로드
            loadKeywords();
            
            // 상세 평가 로드
            loadRatings();

            // 지도 화면 카테고리 필터 생성
            initMapFilters();

            // 햄버거 메뉴 토글
            const menuToggleBtn = document.getElementById('menuToggleBtn');
            const sortMenuContainer = document.getElementById('sortMenuContainer');
            const sortMenuDropdown = document.getElementById('sortMenuDropdown');
            
            if (menuToggleBtn && sortMenuContainer && sortMenuDropdown) {
                // 메뉴 토글 버튼 클릭
                menuToggleBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isVisible = sortMenuContainer.style.display === 'block';
                    sortMenuContainer.style.display = isVisible ? 'none' : 'block';
                });

                // 메뉴 외부 클릭 시 닫기
                document.addEventListener('click', function(e) {
                    if (!sortMenuContainer.contains(e.target) && !menuToggleBtn.contains(e.target)) {
                        sortMenuContainer.style.display = 'none';
                    }
                });

                // 정렬 옵션 클릭
                const sortMenuItems = sortMenuDropdown.querySelectorAll('.sort-menu-item');
                const currentSortText = document.getElementById('currentSortText');
                
                sortMenuItems.forEach(item => {
                    item.addEventListener('click', function() {
                        const sortType = this.getAttribute('data-sort');
                        currentSortType = sortType;
                        
                        // 활성화 상태 업데이트
                        sortMenuItems.forEach(i => i.classList.remove('active'));
                        this.classList.add('active');
                        
                        // 버튼 텍스트 업데이트
                        if (currentSortText) {
                            currentSortText.textContent = sortType === 'popular' ? '인기순' : '리뷰순';
                        }
                        
                        // 메뉴 닫기
                        if (sortMenuContainer) {
                            sortMenuContainer.style.display = 'none';
                        }
                        
                        // 현재 선택된 카테고리로 다시 렌더링 (실제 데이터 기반)
                        const activeFilter = document.querySelector('.map-filter-btn.active');
                        const selectedCategory = activeFilter ? activeFilter.getAttribute('data-filter') : '전체';
                        
                        // 데이터 로드 및 정렬 적용
                        loadRecords(false).then(records => {
                            renderCategoryRestaurantList(selectedCategory, records, false, currentSortType);
                        }).catch(err => {
                            console.error('데이터 로드 오류:', err);
                            const records = recordsCache || [];
                            renderCategoryRestaurantList(selectedCategory, records, false, currentSortType);
                        });
                    });
                });

                // 초기 활성화 상태 설정
                const initialActiveItem = sortMenuDropdown.querySelector(`[data-sort="${currentSortType}"]`);
                if (initialActiveItem) {
                    initialActiveItem.classList.add('active');
                }
            }

            // 지도 카드 닫기 버튼
            const closeCardBtn = document.getElementById('closeCardBtn');
            const restaurantCard = document.getElementById('restaurantCard');
            // 카드 닫기 함수
            function closeRestaurantCard() {
                const restaurantCard = document.getElementById('restaurantCard');
                if (restaurantCard) {
                    restaurantCard.classList.remove('show', 'full', 'peek');
                    restaurantCard.style.transform = 'translateX(-50%) translateY(100%)';
                    
                    // 배경 오버레이 숨기기
                    const overlay = document.getElementById('bottomSheetOverlay');
                    if (overlay) {
                        overlay.classList.remove('show');
                    }
                    
                    // 카테고리 리스트 다시 표시
                    const categoryList = document.getElementById('categoryRestaurantList');
                    if (categoryList) {
                        categoryList.style.display = 'block';
                    }
                    
                    // 리뷰창이 닫힐 때 마커들의 opacity 복원
                    document.querySelectorAll('.restaurant-marker').forEach(marker => {
                        marker.style.opacity = '';
                        marker.style.pointerEvents = '';
                        marker.classList.remove('active');
                    });
                }
            }

            if (closeCardBtn && restaurantCard) {
                closeCardBtn.addEventListener('click', closeRestaurantCard);
            }
            
            // 배경 오버레이 클릭 시 카드 닫기
            const overlay = document.getElementById('bottomSheetOverlay');
            if (overlay) {
                overlay.addEventListener('click', closeRestaurantCard);
            }
            
            // 카드 핸들 드래그 기능 (위로 올리면 리뷰 보이기)
            const cardHandle = document.querySelector('.card-handle');
            if (cardHandle && restaurantCard) {
                let isDragging = false;
                let startY = 0;
                let startTransform = 0;
                let hasDragged = false;
                
                // 카드 핸들 클릭 시 peek <-> full 전환 (네이버 지도 스타일)
                cardHandle.addEventListener('click', function(e) {
                    // 드래그가 발생하지 않은 경우만 클릭 처리
                    if (!hasDragged) {
                        if (restaurantCard.classList.contains('peek')) {
                            // peek -> full
                            restaurantCard.classList.remove('peek');
                            restaurantCard.classList.add('show', 'full');
                            restaurantCard.style.transform = 'translateX(-50%) translateY(0)';
                            
                            // 카테고리 리스트 숨기기
                            const categoryList = document.getElementById('categoryRestaurantList');
                            if (categoryList) {
                                categoryList.style.display = 'none';
                            }
                        } else if (restaurantCard.classList.contains('show')) {
                            // full -> peek
                            restaurantCard.classList.remove('show', 'full');
                            restaurantCard.classList.add('peek');
                            restaurantCard.style.transform = 'translateX(-50%) translateY(40%)';
                        }
                    }
                    hasDragged = false;
                });
                
                const handleStart = (clientY) => {
                    isDragging = true;
                    hasDragged = false;
                    startY = clientY;
                    const currentTransform = restaurantCard.style.transform;
                    if (currentTransform && currentTransform !== 'none') {
                        // translateX(-50%) translateY(...) 형식에서 translateY 값 추출
                        const match = currentTransform.match(/translateY\(([^)]+)\)/);
                        if (match) {
                            let value = match[1];
                            // calc() 값 처리
                            if (value.includes('calc')) {
                                if (value.includes('100% - 150px')) {
                                    // peek 상태 (구버전)
                                    startTransform = window.innerHeight - 150;
                                } else if (value.includes('100% - 50px')) {
                                    // 닫힌 상태
                                    startTransform = window.innerHeight - 50;
                                } else {
                                    startTransform = window.innerHeight * 0.4; // 60% 보이도록
                                }
                            } else if (value.includes('%')) {
                                // 퍼센트 값 처리 (40% = 화면의 60% 보임)
                                const percent = parseFloat(value.replace('%', ''));
                                startTransform = window.innerHeight * (percent / 100);
                            } else {
                                value = value.replace('px', '');
                                startTransform = parseFloat(value) || window.innerHeight * 0.4;
                            }
                        } else {
                            // 기본값: peek 상태 (화면의 60% 보이도록)
                            startTransform = window.innerHeight * 0.4;
                        }
                    } else {
                        // 기본값: peek 상태 (화면의 60% 보이도록)
                        startTransform = window.innerHeight * 0.4;
                    }
                    restaurantCard.style.transition = 'none';
                };
                
                const handleMove = (clientY) => {
                    if (!isDragging) return;
                    const deltaY = startY - clientY;
                    // 드래그가 발생했음을 표시 (5px 이상 움직임)
                    if (Math.abs(deltaY) > 5) {
                        hasDragged = true;
                    }
                    const newY = startTransform - deltaY;
                    const minY = 0; // full 상태
                    const maxY = window.innerHeight - 50; // 완전히 닫힌 상태
                    const clampedY = Math.max(minY, Math.min(maxY, newY));
                    restaurantCard.style.transform = `translateX(-50%) translateY(${clampedY}px)`;
                };
                
                const handleEnd = () => {
                    if (!isDragging) return;
                    isDragging = false;
                    restaurantCard.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                    
                    // translateX(-50%) translateY(...) 형식에서 translateY 값 추출
                    const transformMatch = restaurantCard.style.transform.match(/translateY\(([^)]+)\)/);
                    let currentY = 0;
                        if (transformMatch) {
                            const value = transformMatch[1];
                            if (value.includes('calc')) {
                                if (value.includes('100% - 150px')) {
                                    // peek 상태 (구버전)
                                    currentY = window.innerHeight - 150;
                                } else {
                                    currentY = window.innerHeight * 0.4; // 60% 보이도록
                                }
                            } else if (value.includes('%')) {
                                // 퍼센트 값 처리 (40% = 화면의 60% 보임)
                                const percent = parseFloat(value.replace('%', ''));
                                currentY = window.innerHeight * (percent / 100);
                            } else {
                                currentY = parseFloat(value.replace('px', '')) || 0;
                            }
                        }
                    
                    const cardHeight = restaurantCard.offsetHeight;
                    const peekY = window.innerHeight * 0.4; // peek 상태 Y 위치 (화면의 60% 보이도록)
                    const fullY = 0; // full 상태 Y 위치
                    const midPoint = (peekY + fullY) / 2; // 중간 지점
                    
                    // 네이버 지도 스타일: 스냅 포인트 결정
                    if (currentY < midPoint) {
                        
                        // 위로 올렸으면 full 상태
                        restaurantCard.classList.remove('peek');
                        restaurantCard.classList.add('show', 'full');
                        restaurantCard.style.transform = 'translateX(-50%) translateY(0)';
                        
                        // 배경 오버레이 표시
                        const overlay = document.getElementById('bottomSheetOverlay');
                        if (overlay) {
                            overlay.classList.add('show');
                        }
                        
                        // 카테고리 리스트 숨기기
                        const categoryList = document.getElementById('categoryRestaurantList');
                        if (categoryList) {
                            categoryList.style.display = 'none';
                        }
                        
                        // 리뷰창이 열릴 때 마커들의 opacity 낮추기
                        document.querySelectorAll('.restaurant-marker').forEach(marker => {
                            if (!marker.classList.contains('active')) {
                                marker.style.opacity = '0.3';
                                marker.style.pointerEvents = 'none';
                            } else {
                                marker.style.opacity = '0.6';
                            }
                        });
                    } else if (currentY < peekY + 50) {
                        // peek 상태로 스냅
                        restaurantCard.classList.remove('show', 'full');
                        restaurantCard.classList.add('peek');
                        restaurantCard.style.transform = 'translateX(-50%) translateY(40%)';
                    } else {
                        // 너무 아래로 내렸으면 닫기
                        closeRestaurantCard();
                    }
                };
                
                cardHandle.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    handleStart(e.clientY);
                });
                
                cardHandle.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    handleStart(e.touches[0].clientY);
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                    handleMove(e.clientY);
                });
                
                document.addEventListener('touchmove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                    handleMove(e.touches[0].clientY);
                });
                
                document.addEventListener('mouseup', () => {
                    handleEnd();
                });
                
                document.addEventListener('touchend', () => {
                    handleEnd();
                });
            }

            // 하단 네비게이션 지도 버튼
            document.querySelectorAll('[data-view="map"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    showScreen('map');
                });
            });

            // 트렌드 화면 탭 버튼
            const trendTabButtons = document.querySelectorAll('.tab-btn');
            trendTabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    trendTabButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const period = this.getAttribute('data-period');
                    // 탭에 따른 데이터 필터링 로직은 나중에 구현
                    console.log('기간 선택:', period);
                });
            });

            // 하단 네비게이션 트렌드 버튼
            document.querySelectorAll('[data-view="trend"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    showScreen('trend');
                    // showScreen 내부에서 이미 loadTrendData가 호출되므로 중복 호출 제거
                });
            });
            
            // 한줄 댓글 제출 버튼
            const submitCommentBtn = document.getElementById('submitCommentBtn');
            const commentInput = document.getElementById('commentInput');
            if (submitCommentBtn && commentInput) {
                submitCommentBtn.addEventListener('click', function() {
                    const text = commentInput.value;
                    if (text && text.trim()) {
                        addComment(text);
                        commentInput.value = '';
                    }
                });
                
                commentInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        const text = commentInput.value;
                        if (text && text.trim()) {
                            addComment(text);
                            commentInput.value = '';
                        }
                    }
                });
            }
            
            // 문의함 제출 버튼
            const submitInquiryBtn = document.getElementById('submitInquiryBtn');
            const inquiryTitle = document.getElementById('inquiryTitle');
            const inquiryContent = document.getElementById('inquiryContent');
            if (submitInquiryBtn && inquiryTitle && inquiryContent) {
                submitInquiryBtn.addEventListener('click', function() {
                    submitInquiry(inquiryTitle.value, inquiryContent.value);
                });
            }

            // 기록 완료 버튼 클릭 함수
            async function handleSubmitRecord(e) {
                if (e) {
                    e.preventDefault(); // 기본 동작 방지
                }
                
                // 이미 제출 중이면 중복 제출 방지
                if (isSubmitting) {
                    showToast('이미 기록하였습니다.', 'error');
                    return;
                }
                
                console.log('기록 완료 버튼 클릭됨');
                
                const submitBtn = document.getElementById('submitBtn');
                if (!submitBtn) {
                    console.error('submitBtn을 찾을 수 없습니다.');
                    return;
                }
                
                // 제출 시작
                isSubmitting = true;
                submitBtn.disabled = true;
                submitBtn.style.opacity = '0.6';
                submitBtn.style.cursor = 'not-allowed';
                
                // 필수 필드 검증
                const restaurant = document.getElementById('restaurantSelect').value;
                const menuSelect = document.getElementById('menuSelect');
                const menu = menuSelect ? menuSelect.value : '';
                const department = document.getElementById('departmentSelect').value;

                console.log('폼 제출 검증:', { restaurant, menu, department });
                
                if (!restaurant || !menu || !department) {
                    let errorMsg = '필수 항목을 모두 입력해주세요.';
                    if (!restaurant) errorMsg = '식당을 선택해주세요.';
                    else if (!menu) errorMsg = '메뉴를 입력해주세요.';
                    else if (!department) errorMsg = '학과를 선택해주세요.';
                    // 검증 실패 시 플래그 해제 및 버튼 재활성화
                    isSubmitting = false;
                    submitBtn.disabled = false;
                    submitBtn.style.opacity = '1';
                    submitBtn.style.cursor = 'pointer';
                    showToast(errorMsg, 'error');
                    return;
                }

                if (!selectedMood) {
                    // 검증 실패 시 플래그 해제 및 버튼 재활성화
                    isSubmitting = false;
                    submitBtn.disabled = false;
                    submitBtn.style.opacity = '1';
                    submitBtn.style.cursor = 'pointer';
                    showToast('기분을 선택해주세요.', 'error');
                    return;
                }

                if (ratingScores.taste === 0 || ratingScores.portion === 0 || 
                    ratingScores.value === 0 || ratingScores.service === 0) {
                    // 검증 실패 시 플래그 해제 및 버튼 재활성화
                    isSubmitting = false;
                    submitBtn.disabled = false;
                    submitBtn.style.opacity = '1';
                    submitBtn.style.cursor = 'pointer';
                    showToast('상세 평가를 모두 입력해주세요.', 'error');
                    return;
                }

                // 현재 선택된 카테고리 가져오기
                const currentCategory = currentSelectedCategory || '미지정';
                console.log('선택된 카테고리:', currentCategory);

                // 데이터 수집 (Google Apps Script가 기대하는 필드명으로 매핑)
                const formData = {
                    Timestamp: new Date().toISOString(),
                    Restaurant: restaurant || '',
                    Menu: menu || '',
                    Department: department || '',
                    Time: selectedTime || '',
                    Mood: selectedMood || '',
                    TasteRating: ratingScores.taste || 0,
                    PortionRating: ratingScores.portion || 0,
                    ValueRating: ratingScores.value || 0,
                    ServiceRating: ratingScores.service || 0,
                    Visuals: selectedVisuals.join(', ') || '',
                    Keywords: selectedKeywords.join(', ') || ''
                };

                console.log('제출할 데이터:', formData);
                console.log('선택된 값들:', {
                    restaurant: restaurant,
                    menu: menu,
                    department: department,
                    mood: selectedMood,
                    ratingScores: ratingScores,
                    keywords: selectedKeywords
                });
                console.log('API URL:', API_URL);

                try {
                    // API URL이 설정되지 않았으면 경고
                    if (API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                        // API URL 미설정 시 플래그 해제 및 버튼 재활성화
                        isSubmitting = false;
                        submitBtn.disabled = false;
                        submitBtn.style.opacity = '1';
                        submitBtn.style.cursor = 'pointer';
                        showToast('Google Apps Script API URL을 설정해주세요.', 'error');
                        console.log('제출할 데이터:', formData);
                        return;
                    }

                    // POST 요청
                    console.log('API 요청 시작...');
                    console.log('API URL:', API_URL);
                    console.log('전송할 데이터:', JSON.stringify(formData));
                    
                    try {
                        // Google Apps Script는 URL-encoded 형식을 선호
                        const formDataEncoded = new URLSearchParams();
                        Object.keys(formData).forEach(key => {
                            const value = formData[key];
                            if (value !== null && value !== undefined) {
                                formDataEncoded.append(key, String(value));
                            }
                        });
                        
                        console.log('전송할 데이터:', formData);
                        console.log('전송할 데이터 (URL-encoded):', formDataEncoded.toString());
                        
                        // 먼저 일반 POST 요청 시도 (CORS 허용 시)
                        let response;
                        try {
                            response = await fetch(API_URL, {
                                method: 'POST',
                                headers: { 
                                    'Content-Type': 'application/x-www-form-urlencoded' 
                                },
                                body: formDataEncoded.toString()
                            });
                            
                            console.log('응답 상태:', response.status);
                            console.log('응답 OK:', response.ok);
                            
                            if (response.ok) {
                                const result = await response.json();
                                console.log('응답 받음:', result);
                                showToast('식사가 기록되었습니다! 🎉', 'success');
                                
                                // 캐시는 유지 (자동 새로고침 안 함)
                                // recordsCache = null;
                                // recordsCacheTime = 0;
                                
                                // 트렌드나 식당 목록 자동 업데이트 제거
                                // 사용자가 직접 화면을 새로고침하거나 다시 방문할 때만 업데이트됨
                                
                                // 폼 초기화
                                resetForm();
                                
                                // 홈 화면으로 이동
                                setTimeout(() => {
                                    isSubmitting = false;
                                    submitBtn.disabled = false;
                                    submitBtn.style.opacity = '1';
                                    submitBtn.style.cursor = 'pointer';
                                    showScreen('home');
                                }, 500);
                            } else {
                                // 제출 실패 시 플래그 해제 및 버튼 재활성화
                                isSubmitting = false;
                                submitBtn.disabled = false;
                                submitBtn.style.opacity = '1';
                                submitBtn.style.cursor = 'pointer';
                                throw new Error(`응답 상태: ${response.status}`);
                            }
                        } catch (fetchError) {
                            // CORS 오류인 경우 no-cors 모드로 재시도
                            console.warn('일반 POST 실패, no-cors 모드로 재시도:', fetchError);
                            
                            await fetch(API_URL, {
                                method: 'POST',
                                mode: 'no-cors',
                                headers: { 
                                    'Content-Type': 'application/x-www-form-urlencoded' 
                                },
                                body: formDataEncoded.toString()
                            });
                            
                            console.log('데이터 전송 완료 (no-cors 모드)');
                            showToast('식사가 기록되었습니다! 🎉', 'success');
                            
                            // 캐시는 유지 (자동 새로고침 안 함)
                            // recordsCache = null;
                            // recordsCacheTime = 0;
                            
                            // 트렌드나 식당 목록 자동 업데이트 제거
                            // 사용자가 직접 화면을 새로고침하거나 다시 방문할 때만 업데이트됨
                            
                            // 폼 초기화
                            resetForm();
                            
                            // 홈 화면으로 이동
                            setTimeout(() => {
                                isSubmitting = false;
                                submitBtn.disabled = false;
                                submitBtn.style.opacity = '1';
                                submitBtn.style.cursor = 'pointer';
                                showScreen('home');
                            }, 500);
                        }
                        
                    } catch (error) {
                        console.error('전체 오류:', error);
                        console.error('오류 상세:', error.message);
                        // 제출 실패 시 플래그 해제 및 버튼 재활성화
                        isSubmitting = false;
                        submitBtn.disabled = false;
                        submitBtn.style.opacity = '1';
                        submitBtn.style.cursor = 'pointer';
                        showToast('기록 저장 중 오류가 발생했습니다. 콘솔을 확인해주세요.', 'error');
                    }
                } catch (error) {
                    console.error('전체 오류:', error);
                    // 제출 실패 시 플래그 해제 및 버튼 재활성화
                    isSubmitting = false;
                    submitBtn.disabled = false;
                    submitBtn.style.opacity = '1';
                    submitBtn.style.cursor = 'pointer';
                    showToast('기록 저장 중 오류가 발생했습니다.', 'error');
                }
            }

            // 기록 완료 버튼 클릭 이벤트 (데스크톱 및 모바일 모두 지원)
            const submitBtn = document.getElementById('submitBtn');
            let isSubmitting = false; // 제출 중 플래그
            if (submitBtn) {
                // click 이벤트
                submitBtn.addEventListener('click', handleSubmitRecord);
                
                // 모바일 터치 지원: touchstart 이벤트로 즉시 처리
                submitBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    handleSubmitRecord(e);
                }, { passive: false });
            } else {
                console.error('submitBtn을 찾을 수 없습니다.');
            }
        });

        // ============================================
        // 🔧 유틸리티 함수 (Utility Functions)
        // ============================================
        
        // 현재 선택된 필터 저장
        let currentMapFilter = '전체';

        // 지도 필터 버튼 초기화
        function initMapFilters() {
            const filterButtons = document.getElementById('mapFilterButtons');
            if (!filterButtons) return;

            // 카테고리별 이미지 URL (흰색 배경이 아닌 곳에서 사용)
            const categoryImages = {
                '전체': 'https://i.imgur.com/wSlLQq5.png',
                '중식': 'https://i.imgur.com/nBhdMsd.png',
                '일식': 'https://i.imgur.com/rPZBG7O.png',
                '한식': 'https://i.imgur.com/TjyBMCu.png',
                '양식': 'https://i.imgur.com/7pvlpUZ.png',
                '디저트': 'https://i.imgur.com/iFPbVCw.png',
                '학식당': 'https://i.imgur.com/Le9ZcDf.png'
            };
            
            // 카테고리별 이모지 (흰색 배경인 곳에서 사용)
            const categoryEmojis = {
                '전체': '🍽️',
                '중식': '🥟',
                '일식': '🍣',
                '한식': '🍚',
                '양식': '🍝',
                '디저트': '🍰',
                '학식당': '🍽️'
            };
            
            // 이미지 HTML 생성 함수
            function getCategoryImageHTML(category, className = 'category-image') {
                const imageUrl = categoryImages[category] || categoryImages['전체'];
                return `<img src="${imageUrl}" alt="${category}" class="${className}" style="width: 100%; height: 100%; object-fit: contain;">`;
            }

            // 카테고리 순서
            const categories = ['전체', '중식', '일식', '한식', '양식', '디저트', '학식당'];

            filterButtons.innerHTML = '';

            categories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'map-filter-btn';
                btn.setAttribute('data-filter', category);
                if (category === '전체') {
                    btn.classList.add('active');
                }

                btn.innerHTML = `
                    <span class="filter-emoji">${getCategoryImageHTML(category, 'filter-category-image')}</span>
                    <span class="filter-text">${category}</span>
                    <span class="filter-badge">0</span>
                `;

                btn.addEventListener('click', function() {
                    // 모든 버튼에서 active 제거
                    document.querySelectorAll('.map-filter-btn').forEach(b => b.classList.remove('active'));
                    // 클릭한 버튼에 active 추가
                    this.classList.add('active');
                    
                    // 클릭한 버튼이 보이도록 자동 스크롤
                    const filterButtons = document.getElementById('mapFilterButtons');
                    if (filterButtons) {
                        const containerRect = filterButtons.getBoundingClientRect();
                        const buttonRect = this.getBoundingClientRect();
                        const scrollLeft = filterButtons.scrollLeft;
                        const buttonLeft = buttonRect.left - containerRect.left + scrollLeft;
                        const buttonWidth = buttonRect.width;
                        const containerWidth = containerRect.width;
                        
                        // 버튼이 화면 중앙에 오도록 스크롤
                        const targetScroll = buttonLeft - (containerWidth / 2) + (buttonWidth / 2);
                        
                        filterButtons.scrollTo({
                            left: targetScroll,
                            behavior: 'smooth'
                        });
                    }
                    
                    // 필터링 실행
                    filterMapRestaurants(category);
                });

                filterButtons.appendChild(btn);
            });

            // 초기 필터 적용
            filterMapRestaurants('전체');
        }

        // 지도 식당 필터링
        function filterMapRestaurants(category) {
            currentMapFilter = category;
            
            // 모든 마커 가져오기
            const allMarkers = document.querySelectorAll('.restaurant-marker');
            
            // 카테고리별 식당 개수 계산 (실제 식당 데이터 사용)
            const categoryCounts = {};
            let totalCount = 0;
            Object.keys(restaurants).forEach(cat => {
                const count = restaurants[cat] ? restaurants[cat].length : 0;
                categoryCounts[cat] = count;
                totalCount += count;
            });
            
            // 전체 개수
            categoryCounts['전체'] = totalCount;

            // 배지 업데이트
            document.querySelectorAll('.map-filter-btn').forEach(btn => {
                const filter = btn.getAttribute('data-filter');
                const badge = btn.querySelector('.filter-badge');
                if (badge) {
                    const count = categoryCounts[filter] || 0;
                    badge.textContent = count;
                }
            });

            // 마커 필터링 (표시/숨김)
            allMarkers.forEach(marker => {
                const markerCategory = marker.getAttribute('data-category');
                if (category === '전체' || markerCategory === category) {
                    marker.style.display = 'flex';
                } else {
                    marker.style.display = 'none';
                }
            });
            
            // 식당 리스트 업데이트
            updateRestaurantList(category);
            
            // 카테고리별 식당 리스트도 필터링하여 업데이트 (트렌드 데이터 포함)
            // 최신 데이터를 가져와서 정렬 적용
            loadRecords(false).then(records => {
                renderCategoryRestaurantList(category, records, false, currentSortType);
            }).catch(err => {
                console.error('데이터 로드 오류:', err);
                const records = recordsCache || [];
                renderCategoryRestaurantList(category, records, false, currentSortType);
            });
            
            console.log('필터링:', category);
        }

        // 카테고리별 식당 리스트 생성 (필터 적용) - 웹 최적화
        let restaurantStatsCache = null; // 통계 캐시
        let renderedCategories = new Set(); // 이미 렌더링된 카테고리 추적
        
        // 현재 정렬 방식 저장 (전역 변수)
        let currentSortType = 'popular'; // 'popular' 또는 'review'

        function renderCategoryRestaurantList(selectedCategory = '전체', records = [], lazyLoad = false, sortType = 'popular') {
            const container = document.getElementById('categoryRestaurantList');
            if (!container) return;
            
            // 첫 로드가 아니고 lazyLoad가 false면 전체 초기화
            if (!lazyLoad) {
                container.innerHTML = '';
                renderedCategories.clear();
                // 정렬 변경 시 통계 캐시도 초기화하여 최신 데이터 반영
                restaurantStatsCache = null;
            }
            
            // 트렌드 데이터에서 식당별 통계 계산 (캐시 사용)
            if (!restaurantStatsCache || !lazyLoad) {
                restaurantStatsCache = {};
                if (records && records.length > 0) {
                    records.forEach(r => {
                        const restaurant = getFieldValue(r, 'Restaurant') || getFieldValue(r, 'restaurant');
                        if (restaurant && restaurant.trim()) {
                            if (!restaurantStatsCache[restaurant]) {
                                restaurantStatsCache[restaurant] = {
                                    count: 0,
                                    totalRating: 0,
                                    ratings: []
                                };
                            }
                            restaurantStatsCache[restaurant].count++;
                            const tasteRating = getFieldValue(r, 'TasteRating') || getFieldValue(r, 'tasteRating') || getFieldValue(r, 'Taste Rating');
                            const rating = parseFloat(tasteRating) || 0;
                            if (rating > 0) {
                                restaurantStatsCache[restaurant].totalRating += rating;
                                restaurantStatsCache[restaurant].ratings.push(rating);
                            }
                        }
                    });
                }
            }
            
            const restaurantStats = restaurantStatsCache;
            
            // 카테고리별 이모지
            const categoryEmojis = {
                '중식': '🥟',
                '일식': '🍣',
                '한식': '🍚',
                '양식': '🍝',
                '디저트': '🍰',
                '학식당': '🍽️'
            };
            
            // 카테고리 순서 정의 (전체 제외)
            const categoryOrder = ['중식', '일식', '한식', '양식', '디저트', '학식당'];
            
            // 필터링된 카테고리 목록
            const categoriesToShow = selectedCategory === '전체' 
                ? categoryOrder 
                : [selectedCategory];
            
            // 각 카테고리별로 섹션 생성 (지연 로딩 지원)
            let shouldLazyLoad = false;
            categoriesToShow.forEach((category, categoryIndex) => {
                // 이미 렌더링된 카테고리는 스킵
                if (renderedCategories.has(category)) {
                    return;
                }
                
                // 웹 환경에서 처음에는 첫 2개 카테고리만 로드
                if (selectedCategory === '전체' && !lazyLoad && categoryIndex >= 2) {
                    shouldLazyLoad = true;
                    return;
                }
                
                let categoryRestaurants = restaurants[category] || [];
                if (categoryRestaurants.length === 0) return;
                
                // 정렬 적용
                categoryRestaurants = [...categoryRestaurants].sort((a, b) => {
                    const statsA = restaurantStats[a.name] || { count: 0, ratings: [], totalRating: 0 };
                    const statsB = restaurantStats[b.name] || { count: 0, ratings: [], totalRating: 0 };
                    
                    const avgRatingA = statsA.ratings.length > 0 ? statsA.totalRating / statsA.ratings.length : 0;
                    const avgRatingB = statsB.ratings.length > 0 ? statsB.totalRating / statsB.ratings.length : 0;
                    
                    if (sortType === 'popular') {
                        // 인기순: 평점이 높은 순, 같으면 리뷰 수가 많은 순
                        if (avgRatingB !== avgRatingA) {
                            return avgRatingB - avgRatingA;
                        }
                        return statsB.count - statsA.count;
                    } else if (sortType === 'review') {
                        // 리뷰순: 리뷰 수가 많은 순, 같으면 평점이 높은 순
                        if (statsB.count !== statsA.count) {
                            return statsB.count - statsA.count;
                        }
                        return avgRatingB - avgRatingA;
                    }
                    return 0;
                });
                
                renderedCategories.add(category);
                
                // 섹션 생성
                const section = document.createElement('div');
                section.className = 'category-section';
                
                // 헤더
                const header = document.createElement('div');
                header.className = 'category-section-header';
                header.innerHTML = `
                    <h2 class="category-section-title">
                        ${category} <span class="category-section-count">${categoryRestaurants.length}개</span>
                    </h2>
                `;
                
                // 식당 리스트
                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'category-restaurant-items';
                
                categoryRestaurants.forEach(restaurant => {
                    // 트렌드 데이터에서 해당 식당 통계 가져오기
                    const stats = restaurantStats[restaurant.name] || null;
                    const reviewCount = stats ? stats.count : 0;
                    const avgRating = stats && stats.ratings.length > 0 
                        ? (stats.totalRating / stats.ratings.length).toFixed(1)
                        : null;
                    
                    const item = document.createElement('div');
                    item.className = 'restaurant-list-item';
                    item.setAttribute('data-restaurant', restaurant.name);
                    item.setAttribute('data-category', category);
                    
                    // 트렌드 데이터가 있으면 표시
                    const trendInfo = reviewCount > 0 
                        ? `<p class="restaurant-list-trend">⭐ ${avgRating || '0.0'} · 리뷰 ${reviewCount}개</p>`
                        : '';
                    
                    item.innerHTML = `
                        <div class="restaurant-list-item-content">
                            <div class="restaurant-list-item-left">
                                <div class="restaurant-list-emoji">${categoryEmojis[category] || '🍽️'}</div>
                                <div class="restaurant-list-info">
                                    <h3 class="restaurant-list-name">${restaurant.name}</h3>
                                    <p class="restaurant-list-distance">📍 ${restaurant.distance}</p>
                                    ${trendInfo}
                                </div>
                            </div>
                            <div class="restaurant-list-arrow">→</div>
                        </div>
                    `;
                    
                    // 클릭 이벤트
                    item.addEventListener('click', function() {
                        const restaurantCard = document.getElementById('restaurantCard');
                        if (restaurantCard) {
                            // 캐시된 데이터를 즉시 사용 (로딩 없이)
                            const records = recordsCache || [];
                            // 필드명 유연하게 매칭
                            const reviews = records.filter(r => {
                                const restaurantName = getFieldValue(r, 'Restaurant') || getFieldValue(r, 'restaurant');
                                return restaurantName === restaurant.name;
                            });
                            updateRestaurantCard(restaurant.name, reviews, restaurant);
                            // 네이버 지도 스타일: 처음에는 peek 상태로 표시 (화면의 60% 보이도록)
                            restaurantCard.classList.add('peek');
                            restaurantCard.style.transform = 'translateX(-50%) translateY(40%)';
                            
                            // 배경 오버레이 표시 (약하게)
                            const overlay = document.getElementById('bottomSheetOverlay');
                            if (overlay) {
                                overlay.classList.add('show');
                            }
                            
                            // 카테고리 리스트 숨기기 (중복 방지)
                            const categoryList = document.getElementById('categoryRestaurantList');
                            if (categoryList) {
                                categoryList.style.display = 'none';
                            }
                            
                            // 리뷰창이 열릴 때 마커들의 opacity 낮추기
                            document.querySelectorAll('.restaurant-marker').forEach(marker => {
                                if (marker.getAttribute('data-restaurant') !== restaurant.name) {
                                    marker.style.opacity = '0.3';
                                    marker.style.pointerEvents = 'none';
                                } else {
                                    marker.classList.add('active');
                                    marker.style.opacity = '0.6';
                                }
                            });
                        }
                    });
                    
                    itemsContainer.appendChild(item);
                });
                
                section.appendChild(header);
                section.appendChild(itemsContainer);
                container.appendChild(section);
            });
            
            // 지연 로딩 설정 (마지막 섹션에 Observer 추가)
            if (shouldLazyLoad && !lazyLoad) {
                const lastSection = container.querySelector('.category-section:last-child');
                if (lastSection) {
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                // 다음 카테고리들 로드
                                renderCategoryRestaurantList('전체', records, true, currentSortType);
                                observer.disconnect();
                            }
                        });
                    }, { rootMargin: '300px' });
                    
                    observer.observe(lastSection);
                } else {
                    // 섹션이 없으면 바로 로드
                    setTimeout(() => {
                        renderCategoryRestaurantList('전체', records, true);
                    }, 100);
                }
            }
        }

        // 식당 리스트 업데이트
        function updateRestaurantList(category) {
            const listContent = document.getElementById('restaurantListContent');
            const listTitle = document.getElementById('listTitle');
            const listCount = document.getElementById('listCount');
            
            if (!listContent) return;
            
            // 모든 식당 수집
            const allRestaurants = [];
            Object.keys(restaurants).forEach(cat => {
                restaurants[cat].forEach(restaurant => {
                    allRestaurants.push({
                        ...restaurant,
                        category: cat
                    });
                });
            });
            
            // 필터링
            const filteredRestaurants = category === '전체' 
                ? allRestaurants 
                : allRestaurants.filter(r => r.category === category);
            
            // 제목 및 개수 업데이트
            if (listTitle) {
                listTitle.textContent = category === '전체' ? '주변 식당' : category;
            }
            if (listCount) {
                listCount.textContent = `(${filteredRestaurants.length}개)`;
            }
            
            // 리스트 내용 업데이트
            listContent.innerHTML = '';
            
            filteredRestaurants.forEach(restaurant => {
                const item = document.createElement('div');
                item.className = 'restaurant-list-item';
                item.setAttribute('data-restaurant', restaurant.name);
                
                // 카테고리별 이모지
                const categoryEmojis = {
                    '중식': '🥟',
                    '일식': '🍣',
                    '한식': '🍚',
                    '양식': '🍝',
                    '디저트': '🍰',
                    '학식당': '🍽️'
                };
                
                item.innerHTML = `
                    <div class="restaurant-list-item-content">
                        <div class="restaurant-list-item-left">
                            <div class="restaurant-list-emoji">${categoryEmojis[restaurant.category] || '🍽️'}</div>
                            <div class="restaurant-list-info">
                                <h3 class="restaurant-list-name">${restaurant.name}</h3>
                                <p class="restaurant-list-distance">📍 ${restaurant.distance}</p>
                            </div>
                        </div>
                        <div class="restaurant-list-arrow">→</div>
                    </div>
                `;
                
                // 클릭 이벤트
                item.addEventListener('click', function() {
                    const restaurantCard = document.getElementById('restaurantCard');
                    if (restaurantCard) {
                        // 캐시된 데이터를 즉시 사용 (로딩 없이)
                        const records = recordsCache || [];
                        const reviews = records.filter(r => r.Restaurant === restaurant.name);
                        updateRestaurantCard(restaurant.name, reviews, restaurant);
                        // 네이버 지도 스타일: 처음에는 peek 상태로 표시 (화면의 60% 보이도록)
                        restaurantCard.classList.add('peek');
                        restaurantCard.style.transform = 'translateX(-50%) translateY(40%)';
                        
                        // 배경 오버레이 표시 (약하게)
                        const overlay = document.getElementById('bottomSheetOverlay');
                        if (overlay) {
                            overlay.classList.add('show');
                        }
                        
                        // 카테고리 리스트 숨기기 (중복 방지)
                        const categoryList = document.getElementById('categoryRestaurantList');
                        if (categoryList) {
                            categoryList.style.display = 'none';
                        }
                        
                        // 리뷰창이 열릴 때 마커들의 opacity 낮추기
                        document.querySelectorAll('.restaurant-marker').forEach(marker => {
                            if (marker.getAttribute('data-restaurant') !== restaurant.name) {
                                marker.style.opacity = '0.3';
                                marker.style.pointerEvents = 'none';
                            } else {
                                marker.classList.add('active');
                                marker.style.opacity = '0.6';
                            }
                        });
                    }
                });
                
                listContent.appendChild(item);
            });
        }

        // 식당 목록 로드
        function loadRestaurants(category) {
            const select = document.getElementById('restaurantSelect');
            if (!select) return;
            
            select.innerHTML = '<option value="">식당을 선택하세요</option>';
            const categoryRestaurants = restaurants[category] || [];
            
            categoryRestaurants.forEach(restaurant => {
                const option = document.createElement('option');
                option.value = restaurant.name;
                option.textContent = `${restaurant.name} (${restaurant.distance})`;
                option.setAttribute('data-menus', JSON.stringify(restaurant.menus));
                select.appendChild(option);
            });
            
            select.disabled = false;
        }

        // 메뉴 목록 로드
        function loadMenus(restaurantName) {
            const select = document.getElementById('menuSelect');
            if (!select) {
                console.error('menuSelect를 찾을 수 없습니다.');
                return;
            }
            
            const restaurantOption = document.querySelector(`#restaurantSelect option[value="${restaurantName}"]`);
            if (!restaurantOption) {
                console.error('식당 옵션을 찾을 수 없습니다:', restaurantName);
                return;
            }
            
            const menus = JSON.parse(restaurantOption.getAttribute('data-menus') || '[]');
            console.log('메뉴 로드:', restaurantName, '메뉴 개수:', menus.length);
            
            select.innerHTML = '<option value="">메뉴를 선택하세요</option>';
            
            if (menus.length === 0) {
                console.warn('메뉴가 없습니다:', restaurantName);
            }
            
            menus.forEach(menu => {
                const option = document.createElement('option');
                option.value = menu;
                option.textContent = menu;
                if (menu === '직접 입력...') {
                    option.setAttribute('data-custom-menu', 'true');
                }
                select.appendChild(option);
            });
            
            // 메뉴 선택 활성화
            select.disabled = false;
            select.style.pointerEvents = 'auto';
            select.style.opacity = '1';
            
            // 메뉴 선택 활성화 확인
            console.log('메뉴 선택 활성화 완료:', {
                disabled: select.disabled,
                menuCount: select.options.length,
                pointerEvents: select.style.pointerEvents,
                opacity: select.style.opacity
            });
            
            // 직접 입력 옵션 처리는 전역 이벤트 리스너에서 처리 (중복 등록 방지)
        }

        // 학과 목록 로드
        function loadDepartments() {
            const select = document.getElementById('departmentSelect');
            if (!select) {
                console.warn('departmentSelect를 찾을 수 없습니다.');
                return;
            }
            
            // 기존 옵션 제거 (기본 옵션 제외)
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // departments 배열 확인
            if (!departments || departments.length === 0) {
                console.error('departments 배열이 비어있거나 정의되지 않았습니다.');
                return;
            }
            
            console.log('학과 목록 로드:', departments.length, '개');
            
            // 학과 목록 추가
            departments.forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                select.appendChild(option);
            });
            
            console.log('학과 목록 로드 완료');
        }

        // 키워드 로드
        function loadKeywords() {
            const container = document.getElementById('keywordContainer');
            if (!container) return;
            
            // 기존 키워드 제거 (중복 방지)
            container.innerHTML = '';
            
            keywords.forEach(keyword => {
                const badge = document.createElement('button');
                badge.className = 'keyword-badge';
                badge.textContent = keyword;
                badge.setAttribute('data-keyword', keyword);
                // 이벤트 리스너는 전역 클릭 이벤트에서 처리하므로 여기서는 추가하지 않음
                container.appendChild(badge);
            });
        }

        // 상세 평가 로드
        function loadRatings() {
            const container = document.getElementById('ratingContainer');
            if (!container) return;
            
            const ratingCategories = [
                { emoji: '🍜', label: '맛', id: 'taste' },
                { emoji: '🍽️', label: '양', id: 'portion' },
                { emoji: '💰', label: '가성비', id: 'value' },
                { emoji: '😊', label: '서비스/분위기', id: 'service' }
            ];
            
            ratingCategories.forEach(category => {
                const ratingDiv = document.createElement('div');
                ratingDiv.className = 'rating-item';
                ratingDiv.innerHTML = `
                    <div class="rating-label">
                        <span>${category.emoji} ${category.label}</span>
                        <span class="rating-score" id="${category.id}Score">-</span>
                    </div>
                    <div class="rating-stars" id="${category.id}Stars">
                        ${[1,2,3,4,5].map(i => `<button class="star-btn" data-rating="${i}" data-category="${category.id}" aria-label="${i}점">☆</button>`).join('')}
                    </div>
                `;
                container.appendChild(ratingDiv);
            });
            
            // 별점 클릭 이벤트
            container.querySelectorAll('.star-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const rating = parseInt(this.getAttribute('data-rating'));
                    const category = this.getAttribute('data-category');
                    updateRating(category, rating);
                });
            });
        }

        // 별점 업데이트
        function updateRating(category, rating) {
            ratingScores[category] = rating; // ratingScores 업데이트
            const scoreEl = document.getElementById(category + 'Score');
            if (scoreEl) scoreEl.textContent = rating + '점';
            
            const stars = document.querySelectorAll(`#${category}Stars .star-btn`);
            stars.forEach((star, index) => {
                const starRating = parseInt(star.getAttribute('data-rating'));
                if (starRating <= rating) {
                    star.classList.add('active');
                    star.innerHTML = '⭐'; // 채워진 별
                } else {
                    star.classList.remove('active');
                    star.innerHTML = '☆'; // 빈 별
                }
            });
            
            // 모든 평가가 완료되면 다음 섹션 표시
            if (ratingScores.taste > 0 && ratingScores.portion > 0 && 
                ratingScores.value > 0 && ratingScores.service > 0) {
                const visualSection = document.getElementById('visualSection');
                const keywordSection = document.getElementById('keywordSection');
                if (visualSection) {
                    visualSection.style.display = 'block';
                    setTimeout(() => {
                        visualSection.classList.add('show');
                        visualSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 10);
                }
                if (keywordSection) {
                    keywordSection.style.display = 'block';
                    setTimeout(() => {
                        keywordSection.classList.add('show');
                    }, 10);
                    // 키워드 섹션이 표시될 때 키워드 로드 (컨테이너가 존재하는지 확인)
                    const keywordContainer = document.getElementById('keywordContainer');
                    if (keywordContainer && keywordContainer.children.length === 0) {
                        loadKeywords();
                    }
                }
            }
        }

        // ============================================
        // 🖱️ 사용자 인터랙션 핸들러
        // ============================================
        
        // 소요 시간 버튼 클릭
        document.addEventListener('click', function(e) {
            if (e.target.closest('.time-btn')) {
                const btn = e.target.closest('.time-btn');
                document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedTime = btn.getAttribute('data-time');
            }

            // 기분 버튼 클릭 시 상세 평가 섹션 표시
            if (e.target.closest('.mood-btn')) {
                const btn = e.target.closest('.mood-btn');
                document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedMood = btn.getAttribute('data-mood');
                
                // 상세 평가 섹션 표시
                const ratingSection = document.getElementById('ratingSection');
                if (ratingSection) {
                    ratingSection.style.display = 'block';
                    setTimeout(() => {
                        ratingSection.classList.add('show');
                        ratingSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 10);
                    
                }
            }

            // 시각 평가 버튼 클릭
            if (e.target.closest('.visual-btn')) {
                const btn = e.target.closest('.visual-btn');
                btn.classList.toggle('active');
                const visual = btn.textContent.trim();
                if (btn.classList.contains('active')) {
                    if (!selectedVisuals.includes(visual)) {
                        selectedVisuals.push(visual);
                    }
                } else {
                    selectedVisuals = selectedVisuals.filter(v => v !== visual);
                }
            }
        });

        // ============================================
        // 📸 사진 업로드 기능
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // 페이지 로드 시 데이터 미리 로드 (백그라운드, 로딩 표시 없이)
            preloadData();
            
        });

        // ============================================
        // 📝 폼 관리 함수 (Form Management)
        // ============================================
        
        // 폼 초기화
        function resetForm() {
            document.getElementById('restaurantSelect').value = '';
            document.getElementById('menuSelect').value = '';
            document.getElementById('menuSelect').disabled = true;
            document.getElementById('departmentSelect').value = '';
            selectedTime = '';
            selectedMood = '';
            selectedVisuals = [];
            selectedKeywords = [];
            ratingScores = { taste: 0, portion: 0, value: 0, service: 0 };

            document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.visual-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.keyword-badge').forEach(b => b.classList.remove('active'));
            
            // 기타 키워드 입력 필드 초기화
            const customKeywordInput = document.getElementById('customKeywordInput');
            const addKeywordBtn = document.getElementById('addKeywordBtn');
            const customKeyword = document.getElementById('customKeyword');
            if (customKeywordInput) customKeywordInput.style.display = 'none';
            if (addKeywordBtn) addKeywordBtn.style.display = 'flex';
            if (customKeyword) customKeyword.value = '';
            
            // 기타 키워드 추가된 배지 제거 (1회성 초기화)
            const keywordContainer = document.getElementById('keywordContainer');
            if (keywordContainer) {
                const customBadges = keywordContainer.querySelectorAll('[data-custom="true"]');
                customBadges.forEach(badge => badge.remove());
            }
            
            // 기타 키워드 추가 플래그 초기화
            customKeywordAdded = false;
            
            // 별점 초기화
            ['taste', 'portion', 'value', 'service'].forEach(category => {
                const scoreEl = document.getElementById(category + 'Score');
                if (scoreEl) scoreEl.textContent = '-';
                const stars = document.querySelectorAll(`#${category}Stars .star-btn`);
                stars.forEach(star => {
                    star.classList.remove('active');
                    star.innerHTML = '☆';
                });
            });
        }

        // 키워드 선택
        document.addEventListener('click', function(e) {
            if (e.target.closest('.keyword-badge')) {
                const badge = e.target.closest('.keyword-badge');
                badge.classList.toggle('active');
                const keyword = badge.getAttribute('data-keyword') || badge.textContent.trim();
                
                if (badge.classList.contains('active')) {
                    if (!selectedKeywords.includes(keyword)) {
                        selectedKeywords.push(keyword);
                    }
                } else {
                    selectedKeywords = selectedKeywords.filter(k => k !== keyword);
                }
                
                console.log('선택된 키워드:', selectedKeywords);
            }
        });
        
        // 기타 키워드 추가 기능 (1회성)
        let customKeywordAdded = false; // 전역 변수로 선언
        
        document.addEventListener('DOMContentLoaded', function() {
            const addKeywordBtn = document.getElementById('addKeywordBtn');
            const customKeywordInput = document.getElementById('customKeywordInput');
            const customKeyword = document.getElementById('customKeyword');
            const submitCustomKeyword = document.getElementById('submitCustomKeyword');
            const cancelCustomKeyword = document.getElementById('cancelCustomKeyword');
            const keywordContainer = document.getElementById('keywordContainer');
            
            if (addKeywordBtn && customKeywordInput) {
                // 기타 키워드 추가 버튼 클릭
                addKeywordBtn.addEventListener('click', function() {
                    addKeywordBtn.style.display = 'none';
                    customKeywordInput.style.display = 'flex';
                    if (customKeyword) customKeyword.focus();
                });
                
                // 취소 버튼 클릭
                if (cancelCustomKeyword) {
                    cancelCustomKeyword.addEventListener('click', function() {
                        addKeywordBtn.style.display = 'flex';
                        customKeywordInput.style.display = 'none';
                        if (customKeyword) customKeyword.value = '';
                    });
                }
                
                // 추가 버튼 클릭 또는 Enter 키
                if (submitCustomKeyword && customKeyword) {
                    submitCustomKeyword.addEventListener('click', function() {
                        addCustomKeyword();
                    });
                    
                    customKeyword.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            addCustomKeyword();
                        }
                    });
                }
            }
            
            function addCustomKeyword() {
                if (!customKeyword || !keywordContainer) return;
                
                // 이미 기타 키워드를 추가했으면 추가 불가
                if (customKeywordAdded) {
                    alert('기타 키워드는 한 번만 추가할 수 있습니다.');
                    return;
                }
                
                const keyword = customKeyword.value.trim();
                if (keyword && keyword.length > 0) {
                    // 중복 체크
                    if (selectedKeywords.includes(keyword)) {
                        alert('이미 추가된 키워드입니다.');
                        return;
                    }
                    
                    // 키워드 배지 생성
                    const badge = document.createElement('div');
                    badge.className = 'keyword-badge active';
                    badge.setAttribute('data-keyword', keyword);
                    badge.setAttribute('data-custom', 'true'); // 기타 키워드 표시
                    badge.textContent = keyword;
                    
                    // 클릭 이벤트 추가
                    badge.addEventListener('click', function() {
                        badge.classList.toggle('active');
                        if (badge.classList.contains('active')) {
                            if (!selectedKeywords.includes(keyword)) {
                                selectedKeywords.push(keyword);
                            }
                        } else {
                            selectedKeywords = selectedKeywords.filter(k => k !== keyword);
                        }
                        console.log('선택된 키워드:', selectedKeywords);
                    });
                    
                    // 컨테이너에 추가
                    keywordContainer.appendChild(badge);
                    
                    // selectedKeywords에 추가
                    selectedKeywords.push(keyword);
                    
                    // 기타 키워드 추가 플래그 설정
                    customKeywordAdded = true;
                    
                    // 입력 필드 초기화 및 숨기기
                    customKeyword.value = '';
                    addKeywordBtn.style.display = 'flex';
                    customKeywordInput.style.display = 'none';
                    
                    console.log('선택된 키워드:', selectedKeywords);
                }
            }
        });

        // 데이터 조회 함수 (트렌드, 지도 화면용)
        // ============================================
        // 📡 API 통신 함수 (API Communication)
        // ============================================
        
        // 데이터 캐싱
        let recordsCache = null;
        let recordsCacheTime = 0;
        const CACHE_DURATION = 30000; // 30초 캐시

        async function loadRecords(forceRefresh = false) {
            if (API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                console.log('API URL이 설정되지 않았습니다.');
                return [];
            }

            // 캐시 확인 (강제 새로고침이 아닌 경우만)
            const now = Date.now();
            if (!forceRefresh && recordsCache && (now - recordsCacheTime) < CACHE_DURATION) {
                console.log('캐시된 데이터 사용:', recordsCache.length, '개');
                return recordsCache;
            }

            try {
                console.log('API에서 데이터 가져오는 중...', API_URL);
                console.log('forceRefresh:', forceRefresh);
                
                // 구글 Apps Script는 GET 요청으로 데이터 가져오기
                // 여러 방법 시도
                let response = null;
                let lastError = null;
                
                // 방법 1: action=get 파라미터 사용
                try {
                    console.log('시도 1: action=get 파라미터 사용');
                    response = await fetch(API_URL + '?action=get', {
                        method: 'GET',
                        mode: 'cors'
                    });
                if (response.ok) {
                        console.log('방법 1 성공');
                    }
                } catch (e) {
                    console.log('방법 1 실패:', e);
                    lastError = e;
                }
                
                // 방법 2: 일반 GET 요청
                if (!response || !response.ok) {
                    try {
                        console.log('시도 2: 일반 GET 요청');
                        response = await fetch(API_URL, {
                            method: 'GET',
                            mode: 'cors'
                        });
                        if (response.ok) {
                            console.log('방법 2 성공');
                        }
                    } catch (e) {
                        console.log('방법 2 실패:', e);
                        lastError = e;
                    }
                }
                
                // 방법 3: no-cors 모드 (응답 읽기 불가하지만 시도)
                if (!response || !response.ok) {
                    try {
                        console.log('시도 3: no-cors 모드');
                        response = await fetch(API_URL + '?action=get', {
                            method: 'GET',
                            mode: 'no-cors'
                        });
                        console.log('방법 3 시도 완료 (응답 확인 불가)');
                    } catch (e) {
                        console.log('방법 3 실패:', e);
                        lastError = e;
                    }
                }
                
                if (!response || !response.ok) {
                    throw new Error('모든 GET 요청 방법 실패. 마지막 오류: ' + (lastError ? lastError.message : '알 수 없음'));
                }
                
                console.log('응답 상태:', response.status, response.statusText);
                console.log('응답 헤더:', Object.fromEntries(response.headers.entries()));
                
                // 응답 본문 읽기
                const responseText = await response.text();
                console.log('응답 본문 (처음 500자):', responseText.substring(0, 500));
                
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (e) {
                    console.error('JSON 파싱 실패. 응답:', responseText);
                    throw new Error('JSON 파싱 실패: ' + e.message);
                }
                
                console.log('받은 데이터 타입:', typeof data, Array.isArray(data) ? '배열' : '객체');
                console.log('받은 데이터 샘플:', data);
                
                // 데이터가 배열이 아니면 배열로 변환
                let records = [];
                if (Array.isArray(data)) {
                    records = data;
                } else if (data.records && Array.isArray(data.records)) {
                    records = data.records;
                } else if (data.data && Array.isArray(data.data)) {
                    records = data.data;
                } else if (data.values && Array.isArray(data.values)) {
                    // 구글 시트의 values 형식
                    const headers = data.values[0] || [];
                    records = data.values.slice(1).map(row => {
                        const obj = {};
                        headers.forEach((header, index) => {
                            obj[header] = row[index] || '';
                        });
                        return obj;
                    });
                } else if (typeof data === 'object') {
                    // 객체의 값이 배열인 경우
                    const keys = Object.keys(data);
                    if (keys.length > 0 && Array.isArray(data[keys[0]])) {
                        records = data[keys[0]];
                } else {
                        // 단일 객체를 배열로 변환
                        records = [data];
                    }
                }
                
                console.log('처리된 레코드 수:', records.length);
                if (records.length > 0) {
                    console.log('첫 번째 레코드 필드명:', Object.keys(records[0]));
                    console.log('첫 번째 레코드 전체:', records[0]);
                }
                
                recordsCache = records;
                recordsCacheTime = now;
                return records;
            } catch (error) {
                console.error('데이터 조회 오류:', error);
                console.error('오류 상세:', error.message, error.stack);
                // 캐시된 데이터가 있으면 반환
                if (recordsCache) {
                    console.log('오류 발생, 캐시된 데이터 사용:', recordsCache.length, '개');
                    return recordsCache;
                }
                return [];
            }
        }

        // 필드명 정규화 함수 (대소문자, 공백 무시)
        function getFieldValue(record, fieldName) {
            // 정확한 필드명 먼저 시도
            if (record[fieldName] !== undefined) {
                return record[fieldName];
            }
            // 대소문자 무시하여 찾기
            const lowerFieldName = fieldName.toLowerCase();
            for (const key in record) {
                if (key.toLowerCase() === lowerFieldName) {
                    return record[key];
                }
            }
            return null;
        }

        // 트렌드 화면 데이터 로드
        async function loadTrendData(forceRefresh = false) {
            console.log('트렌드 데이터 로드 시작... (forceRefresh:', forceRefresh, ')');
            
            // 강제 새로고침이면 캐시 초기화
            if (forceRefresh) {
                console.log('강제 새로고침 - 캐시 초기화 및 최신 데이터 가져오기');
                recordsCache = null;
                recordsCacheTime = 0;
            }
            
            // 항상 최신 데이터 가져오기 (강제 새로고침)
            const records = await loadRecords(forceRefresh);
            
            console.log('로드된 레코드 수:', records.length);
            if (records.length > 0) {
                console.log('첫 번째 레코드 샘플:', records[0]);
                console.log('레코드 필드명:', Object.keys(records[0]));
            }
            
            // 데이터가 없을 때만 예시 표시 (하지만 먼저 API에서 데이터를 확인)
            if (records.length === 0) {
                console.log('로드된 데이터가 없습니다. 구글시트에 데이터가 있는지 확인하세요.');
                // 예시 데이터 대신 빈 상태 메시지 표시
                const popularContainer = document.getElementById('popularRestaurantsContent');
                if (popularContainer) {
                    popularContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">아직 기록이 없습니다.</div>';
                }
                const rankingContainer = document.getElementById('monthlyRankingList');
                if (rankingContainer) {
                    rankingContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">아직 기록이 없습니다.</div>';
                }
                const visualRatingContainer = document.getElementById('visualRatingList');
                if (visualRatingContainer) {
                    visualRatingContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">아직 기록이 없습니다.</div>';
                }
                const recentContainer = document.querySelector('.recent-records');
                if (recentContainer) {
                    recentContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">아직 기록이 없습니다.</div>';
                }
                return;
            }

            // 오늘 기록 수 업데이트
            const today = new Date().toDateString();
            const todayRecords = records.filter(r => {
                const timestamp = getFieldValue(r, 'Timestamp') || getFieldValue(r, 'timestamp');
                if (!timestamp) return false;
                try {
                    const recordDate = new Date(timestamp).toDateString();
                return recordDate === today;
                } catch (e) {
                    console.warn('날짜 파싱 오류:', timestamp, e);
                    return false;
                }
            });
            console.log('오늘 기록 수:', todayRecords.length);
            
            const todayCountEl = document.querySelector('.stat-value');
            if (todayCountEl) {
                todayCountEl.textContent = todayRecords.length + '건';
            }

            // 평균 평점 계산
            let totalRating = 0;
            let ratingCount = 0;
            records.forEach(r => {
                const tasteRating = getFieldValue(r, 'TasteRating') || getFieldValue(r, 'tasteRating') || getFieldValue(r, 'Taste Rating');
                const rating = parseFloat(tasteRating) || 0;
                if (rating > 0) {
                    totalRating += rating;
                    ratingCount++;
                }
            });
            const avgRating = ratingCount > 0 ? totalRating / ratingCount : 0;
            console.log('평균 평점:', avgRating);
            
            const avgRatingEl = document.querySelector('.stat-rating span');
            if (avgRatingEl) {
                avgRatingEl.textContent = avgRating.toFixed(1);
            }

            // 인기 식당 계산
            const restaurantCounts = {};
            todayRecords.forEach(r => {
                const restaurant = getFieldValue(r, 'Restaurant') || getFieldValue(r, 'restaurant');
                if (restaurant) {
                    restaurantCounts[restaurant] = (restaurantCounts[restaurant] || 0) + 1;
                }
            });

            // 시각평가 업데이트
            updateVisualRatings(records);

            // 최근 기록 표시 (시간순 정렬 후 최근 3개)
            const sortedRecords = [...records].sort((a, b) => {
                const timeA = getFieldValue(a, 'Timestamp') || getFieldValue(a, 'timestamp') || '';
                const timeB = getFieldValue(b, 'Timestamp') || getFieldValue(b, 'timestamp') || '';
                if (!timeA || !timeB) return 0;
                return new Date(timeB) - new Date(timeA); // 최신순
            });
            updateRecentRecords(sortedRecords.slice(0, 3));
            
            // 인기 식당 탭 초기화 (데이터 로드 후)
            initPopularRestaurantTabs();
            
            // 인기 식당 업데이트
            console.log('인기 식당 업데이트 시작...');
            updatePopularRestaurants(records);
            
            // 이달의 식당 랭킹 업데이트
            console.log('이달의 식당 랭킹 업데이트 시작...');
            updateMonthlyRanking(records);
            
            console.log('트렌드 데이터 로드 완료');
        }
        
        // 시각평가 업데이트 (통합 분석)
        function updateVisualRatings(records) {
            const container = document.getElementById('visualRatingList');
            if (!container) return;
            
            if (!records || records.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">아직 기록이 없습니다.</div>';
                return;
            }
            
            // 카테고리별 이모지
            const categoryEmojis = {
                '중식': '🥟',
                '일식': '🍣',
                '한식': '🍚',
                '양식': '🍝',
                '디저트': '🍰',
                '학식당': '🍽️'
            };
            
            // 시각평가 이모지
            const visualRatingEmojis = {
                '깔끔함': '✨',
                '화려함': '🎨',
                '심플함': '🎯',
                '트렌디함': '🔥',
                '클래식함': '📚',
                '독특함': '💫',
                '아늑함': '🏠',
                '모던함': '⚡',
                '자연스러움': '🌿',
                '세련됨': '💎',
                '편안함': '😌',
                '활기참': '🎉'
            };
            
            // 통합 통계: 학과-카테고리 조합별로 시각평가 수집
            const departmentCategoryData = {}; // { "학과명/카테고리": { "시각평가": count } }
            
            records.forEach(r => {
                // 카테고리 정보 (Google Sheets의 Category 필드 우선 사용)
                let category = getFieldValue(r, 'Category') || 
                               getFieldValue(r, 'category') || 
                               getFieldValue(r, '카테고리') ||
                               getFieldValue(r, 'Menu Category') ||
                               getFieldValue(r, 'menuCategory') ||
                               getFieldValue(r, '메뉴 카테고리') ||
                               null;
                
                // Category 필드가 없으면 식당 이름으로 카테고리 찾기 (백업 방법)
                if (!category) {
                    const restaurantName = getFieldValue(r, 'Restaurant') || getFieldValue(r, 'restaurant') || '';
                    if (restaurantName) {
                        for (const cat in restaurants) {
                            const found = restaurants[cat].find(rest => rest.name === restaurantName);
                            if (found) {
                                category = cat;
                                console.log(`식당 "${restaurantName}"을(를) 카테고리 "${category}"로 매핑`);
                                break;
                            }
                        }
                    }
                }
                
                // 학과 정보
                const department = getFieldValue(r, 'Department') || getFieldValue(r, 'department') || '';
                
                // 학과와 카테고리가 모두 있어야 조합 데이터 수집
                if (!department || !category) {
                    return; // 둘 중 하나라도 없으면 스킵
                }
                
                // 조합 키 생성: "학과명/카테고리"
                const comboKey = `${department}/${category}`;
                
                // 시각평가 정보
                let visualRating = getFieldValue(r, 'VisualRating') || 
                                   getFieldValue(r, 'visualRating') || 
                                   getFieldValue(r, '시각평가') || 
                                   getFieldValue(r, 'Visual Rating') ||
                                   getFieldValue(r, '시각 평가') ||
                                   null;
                
                // 필드명을 찾지 못한 경우, 모든 필드를 검색
                if (!visualRating) {
                    for (const key in r) {
                        const lowerKey = key.toLowerCase();
                        if (lowerKey.includes('visual') || lowerKey.includes('시각')) {
                            visualRating = r[key];
                            break;
                        }
                    }
                }
                
                if (visualRating) {
                    const ratingList = String(visualRating).split(',').map(r => r.trim()).filter(r => r);
                    
                    // 조합별 데이터 초기화
                    if (!departmentCategoryData[comboKey]) {
                        departmentCategoryData[comboKey] = {};
                    }
                    
                    ratingList.forEach(rating => {
                        if (rating) {
                            // 조합별 시각평가 카운트
                            departmentCategoryData[comboKey][rating] = 
                                (departmentCategoryData[comboKey][rating] || 0) + 1;
                        }
                    });
                }
            });
            
            console.log('학과-카테고리 조합별 시각평가 통계:', departmentCategoryData);
            
            // 학과별로 그룹화
            const departmentGroups = {}; // { "학과명": { "카테고리": { "시각평가": count } } }
            
            Object.keys(departmentCategoryData).forEach(comboKey => {
                const [department, category] = comboKey.split('/');
                if (!departmentGroups[department]) {
                    departmentGroups[department] = {};
                }
                departmentGroups[department][category] = departmentCategoryData[comboKey];
            });
            
            // 학과별 카드 생성
            const graphCards = [];
            
            Object.keys(departmentGroups).forEach(department => {
                const categories = departmentGroups[department];
                let totalCount = 0;
                const categorySections = [];
                
                // 각 카테고리별로 상위 3개 시각평가 추출
                Object.keys(categories).forEach(category => {
                    const ratings = categories[category];
                    
                    // 시각평가를 카운트 순으로 정렬하고 상위 3개만 선택
                    const topRatings = Object.keys(ratings)
                        .map(rating => ({
                            text: rating,
                            count: ratings[rating],
                            emoji: visualRatingEmojis[rating] || '⭐'
                }))
                .sort((a, b) => b.count - a.count)
                        .slice(0, 3); // 상위 3개만
                    
                    if (topRatings.length === 0) return;
                    
                    const catEmoji = categoryEmojis[category] || '🍽️';
                    const maxCount = topRatings[0].count;
                    const categoryTotal = topRatings.reduce((sum, r) => sum + r.count, 0);
                    totalCount += categoryTotal;
                    
                    // 카테고리 섹션 생성
                    categorySections.push({
                        category: category,
                        emoji: catEmoji,
                        content: topRatings.map((rating, index) => {
                            const rank = index + 1;
                            const rankBadge = rank === 1 ? '🥇' : rank === 2 ? '🥈' : '🥉';
                            const barWidth = (rating.count / maxCount) * 100;
                            return `
                                <div class="graph-multi-bar-item" style="animation-delay: ${index * 0.1}s;">
                                    <div class="graph-multi-bar-label">
                                        <span class="graph-rank-badge">${rankBadge}</span>
                                        <span class="graph-multi-bar-emoji">${rating.emoji}</span>
                                        <span class="graph-multi-bar-name">${rating.text}</span>
                                        <span class="graph-multi-bar-count">${rating.count}</span>
                                    </div>
                                    <div class="graph-multi-bar-wrapper">
                                        <div class="graph-multi-bar" style="width: ${barWidth}%"></div>
                                    </div>
                                </div>
                            `;
                        }).join('')
                    });
                });
                
                if (categorySections.length === 0) return;
                
                // 학과별 카드 생성 (여러 카테고리 포함)
                graphCards.push({
                    title: `🎓 ${department}`,
                    type: 'department',
                    totalCount: totalCount,
                    content: categorySections.map(section => `
                        <div class="category-section">
                            <div class="category-section-title">${section.emoji} ${section.category}</div>
                            <div class="category-section-content">${section.content}</div>
                        </div>
                    `).join('')
                });
            });
            
            // 학과별로 정렬 (데이터가 많은 순)
            graphCards.sort((a, b) => b.totalCount - a.totalCount);
            
            if (graphCards.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">시각평가 데이터가 없습니다.</div>';
                return;
            }
            
            // 스와이프 가능한 컨테이너 생성
            container.innerHTML = `
                <div class="visual-rating-swipe-container" id="visualRatingSwipeContainer">
                    <div class="visual-rating-swipe-wrapper" id="visualRatingSwipeWrapper">
                        ${graphCards.map((card, index) => `
                            <div class="visual-rating-swipe-card" data-index="${index}">
                                <div class="graph-card-title">${card.title}</div>
                                <div class="graph-card-content">${card.content}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="visual-rating-pagination" id="visualRatingPagination">
                        ${graphCards.map((_, index) => `
                            <div class="visual-rating-dot ${index === 0 ? 'active' : ''}" data-index="${index}"></div>
                        `).join('')}
                    </div>
                </div>
                `;
            
            // 스와이프 기능 초기화 (터치 + 마우스 지원)
            setTimeout(() => {
                initVisualRatingSwipe();
            }, 100);
        }
        
        // 예시 인기 키워드 표시 (데이터가 없을 때)
        // 한줄 댓글 기능
        // 기존 테스트 데이터 초기화
        localStorage.removeItem('comments');
        localStorage.removeItem('myCommentIds');
        
        let comments = JSON.parse(localStorage.getItem('comments') || '[]');
        let myCommentIds = JSON.parse(localStorage.getItem('myCommentIds') || '[]'); // 내가 작성한 댓글 ID 목록
        
        // 고유 ID 생성 함수
        function generateCommentId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        function loadComments() {
            const commentList = document.getElementById('commentList');
            if (!commentList) return;
            
            if (comments.length === 0) {
                commentList.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">아직 댓글이 없습니다.</div>';
                commentList.scrollTop = 0;
                return;
            }
            
            commentList.innerHTML = comments.map((comment, index) => {
                const timeAgo = getTimeAgo(new Date(comment.timestamp));
                const isMyComment = myCommentIds.includes(comment.id);
                return `
                    <div class="comment-item" data-comment-id="${comment.id}">
                        ${comment.isEditing ? `
                            <input type="text" class="comment-edit-input" value="${comment.text}" maxlength="100" data-comment-id="${comment.id}">
                            <div class="comment-edit-actions">
                                <button class="comment-save-btn" data-comment-id="${comment.id}">저장</button>
                                <button class="comment-cancel-btn" data-comment-id="${comment.id}">취소</button>
                            </div>
                        ` : `
                            <div class="comment-text">${comment.text}</div>
                            <div class="comment-footer">
                                <span>익명</span>
                                <span>${timeAgo}</span>
                            </div>
                            ${isMyComment ? `
                                <div class="comment-actions">
                                    <button class="comment-action-btn" onclick="editComment('${comment.id}')">수정</button>
                                    <button class="comment-action-btn" onclick="deleteComment('${comment.id}')">삭제</button>
                                </div>
                            ` : ''}
                        `}
                    </div>
                `;
            }).join('');
            
            // 수정 모드에서 저장/취소 버튼 이벤트 리스너 추가
            document.querySelectorAll('.comment-save-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const commentId = this.getAttribute('data-comment-id');
                    const editInput = document.querySelector(`.comment-edit-input[data-comment-id="${commentId}"]`);
                    if (editInput && editInput.value.trim()) {
                        saveComment(commentId, editInput.value.trim());
                    }
                });
            });
            
            document.querySelectorAll('.comment-cancel-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const commentId = this.getAttribute('data-comment-id');
                    cancelEditComment(commentId);
                });
            });
            
            // 수정 입력 필드에서 Enter 키로 저장
            document.querySelectorAll('.comment-edit-input').forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const commentId = this.getAttribute('data-comment-id');
                        if (this.value.trim()) {
                            saveComment(commentId, this.value.trim());
                        }
                    }
                });
            });
            
            // 최신 댓글이 위에 있으므로 맨 위로 스크롤
            commentList.scrollTop = 0;
        }
        
        function addComment(text) {
            if (!text || !text.trim()) return;
            
            const commentId = generateCommentId();
            const comment = {
                id: commentId,
                text: text.trim(),
                timestamp: new Date().toISOString(),
                isEditing: false
            };
            
            comments.unshift(comment); // 최신 댓글이 위에 오도록
            myCommentIds.push(commentId); // 내 댓글 ID 목록에 추가
            
            if (comments.length > 50) {
                // 오래된 댓글 제거 시 내 댓글 ID 목록에서도 제거
                const removedComments = comments.slice(50);
                removedComments.forEach(removed => {
                    const index = myCommentIds.indexOf(removed.id);
                    if (index > -1) {
                        myCommentIds.splice(index, 1);
                    }
                });
                comments = comments.slice(0, 50); // 최대 50개만 유지
            }
            
            localStorage.setItem('comments', JSON.stringify(comments));
            localStorage.setItem('myCommentIds', JSON.stringify(myCommentIds));
            loadComments();
            
            // 댓글 추가 후 맨 위로 스크롤
            const commentList = document.getElementById('commentList');
            if (commentList) {
                commentList.scrollTop = 0;
            }
        }
        
        function editComment(commentId) {
            const comment = comments.find(c => c.id === commentId);
            if (comment) {
                comment.isEditing = true;
                localStorage.setItem('comments', JSON.stringify(comments));
                loadComments();
                
                // 수정 입력 필드에 포커스
                setTimeout(() => {
                    const editInput = document.querySelector(`.comment-edit-input[data-comment-id="${commentId}"]`);
                    if (editInput) {
                        editInput.focus();
                        editInput.select();
                    }
                }, 100);
            }
        }
        
        function saveComment(commentId, newText) {
            const comment = comments.find(c => c.id === commentId);
            if (comment && newText.trim()) {
                comment.text = newText.trim();
                comment.isEditing = false;
                localStorage.setItem('comments', JSON.stringify(comments));
                loadComments();
            }
        }
        
        function cancelEditComment(commentId) {
            const comment = comments.find(c => c.id === commentId);
            if (comment) {
                comment.isEditing = false;
                localStorage.setItem('comments', JSON.stringify(comments));
                loadComments();
            }
        }
        
        function deleteComment(commentId) {
            if (confirm('정말 이 댓글을 삭제하시겠습니까?')) {
                comments = comments.filter(c => c.id !== commentId);
                myCommentIds = myCommentIds.filter(id => id !== commentId);
                localStorage.setItem('comments', JSON.stringify(comments));
                localStorage.setItem('myCommentIds', JSON.stringify(myCommentIds));
                loadComments();
            }
        }
        
        // 전역 함수로 등록 (onclick에서 사용하기 위해)
        window.editComment = editComment;
        window.deleteComment = deleteComment;
        
        // 문의함 기능
        async function submitInquiry(title, content) {
            console.log('submitInquiry 호출됨:', { title, content });
            
            if (!title || !title.trim() || !content || !content.trim()) {
                showToast('제목과 내용을 모두 입력해주세요.', 'error');
                return;
            }
            
            const inquiryData = {
                type: 'inquiry', // 문의하기 타입 구분
                Timestamp: new Date().toISOString(),
                Title: title.trim(),
                Content: content.trim()
            };
            
            console.log('문의하기 데이터:', inquiryData);
            console.log('API URL:', API_URL);
            
            // API URL 확인
            if (!API_URL || API_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                console.error('API URL이 설정되지 않았습니다.');
                showToast('API URL이 설정되지 않았습니다. 관리자에게 문의해주세요.', 'error');
                return;
            }
            
            try {
                // Google Apps Script로 전송
                const formDataEncoded = new URLSearchParams();
                Object.keys(inquiryData).forEach(key => {
                    const value = inquiryData[key];
                    if (value !== null && value !== undefined) {
                        formDataEncoded.append(key, String(value));
                    }
                });
                
                console.log('전송할 데이터 (URL-encoded):', formDataEncoded.toString());
                
                let response;
                try {
                    console.log('POST 요청 시작...');
                    response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/x-www-form-urlencoded' 
                        },
                        body: formDataEncoded.toString()
                    });
                    
                    console.log('응답 상태:', response.status);
                    console.log('응답 OK:', response.ok);
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('문의하기 응답:', result);
                        showToast('문의가 접수되었습니다. 감사합니다! 🎉', 'success');
                        
                        // 폼 초기화
                        document.getElementById('inquiryTitle').value = '';
                        document.getElementById('inquiryContent').value = '';
                    } else {
                        const errorText = await response.text();
                        console.error('응답 오류:', response.status, errorText);
                        throw new Error(`응답 상태: ${response.status}, ${errorText}`);
                    }
                } catch (fetchError) {
                    // CORS 오류인 경우 no-cors 모드로 재시도
                    console.warn('일반 POST 실패, no-cors 모드로 재시도:', fetchError);
                    console.log('no-cors 모드로 전송 시도...');
                    
                    try {
                        await fetch(API_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 
                                'Content-Type': 'application/x-www-form-urlencoded' 
                            },
                            body: formDataEncoded.toString()
                        });
                        
                        console.log('문의하기 데이터 전송 완료 (no-cors 모드)');
                        showToast('문의가 접수되었습니다. 감사합니다! 🎉', 'success');
                        
                        // 폼 초기화
                        document.getElementById('inquiryTitle').value = '';
                        document.getElementById('inquiryContent').value = '';
                    } catch (noCorsError) {
                        console.error('no-cors 모드 전송 실패:', noCorsError);
                        throw noCorsError;
                    }
                }
            } catch (error) {
                console.error('문의하기 전송 오류:', error);
                console.error('오류 상세:', error.message);
                showToast('문의 접수 중 오류가 발생했습니다. 콘솔을 확인해주세요.', 'error');
            }
        }

        function showExampleKeywords() {
            const container = document.getElementById('popularKeywordsList');
            if (!container) return;
            
            const exampleKeywords = [
                { text: '가성비 좋음', count: 156 },
                { text: '양 많음', count: 143 },
                { text: '빨리 나옴', count: 128 },
                { text: '혼밥 가능', count: 112 },
                { text: '단골될 듯', count: 98 },
                { text: '매움', count: 87 }
            ];
            
            container.innerHTML = exampleKeywords.map(keyword => {
                return `
                    <div class="keyword-item">
                        <span class="keyword-text">${keyword.text}</span>
                        <span class="keyword-count">(${keyword.count})</span>
                    </div>
                `;
            }).join('');
        }
        
        // 인기 식당 탭 클릭 이벤트 초기화
        function initPopularRestaurantTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn[data-period]');
            tabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 모든 탭 버튼에서 active 제거
                    tabButtons.forEach(b => b.classList.remove('active'));
                    // 클릭한 버튼에 active 추가
                    this.classList.add('active');
                    
                    // 인기 식당 업데이트
                    const records = recordsCache || [];
                    updatePopularRestaurants(records);
                });
            });
        }
        
        // 인기 식당 계산 및 표시
        function updatePopularRestaurants(records) {
            console.log('updatePopularRestaurants 호출됨, 레코드 수:', records ? records.length : 0);
            
            if (!records || records.length === 0) {
                console.log('데이터가 없습니다.');
                // 예시 데이터 대신 빈 상태 메시지 표시
                const container = document.getElementById('popularRestaurantsContent');
                if (container) {
                    container.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">아직 기록이 없습니다.</div>';
                }
                return;
            }
            
            // 현재 선택된 기간 확인
            const activeTab = document.querySelector('.tab-btn.active');
            const period = activeTab ? activeTab.getAttribute('data-period') : 'today';
            console.log('선택된 기간:', period);
            
            // 기간별 데이터 필터링
            const now = new Date();
            let filteredRecords = [];
            
            if (period === 'today') {
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                filteredRecords = records.filter(r => {
                    const timestamp = getFieldValue(r, 'Timestamp') || getFieldValue(r, 'timestamp');
                    if (!timestamp) return false;
                    try {
                        const recordDate = new Date(timestamp);
                    return recordDate >= today;
                    } catch (e) {
                        console.warn('날짜 파싱 오류:', timestamp, e);
                        return false;
                    }
                });
            } else if (period === 'week') {
                const weekAgo = new Date(now);
                weekAgo.setDate(weekAgo.getDate() - 7);
                filteredRecords = records.filter(r => {
                    const timestamp = getFieldValue(r, 'Timestamp') || getFieldValue(r, 'timestamp');
                    if (!timestamp) return false;
                    try {
                        const recordDate = new Date(timestamp);
                    return recordDate >= weekAgo;
                    } catch (e) {
                        console.warn('날짜 파싱 오류:', timestamp, e);
                        return false;
                    }
                });
            } else if (period === 'month') {
                const monthAgo = new Date(now);
                monthAgo.setMonth(monthAgo.getMonth() - 1);
                filteredRecords = records.filter(r => {
                    const timestamp = getFieldValue(r, 'Timestamp') || getFieldValue(r, 'timestamp');
                    if (!timestamp) return false;
                    try {
                        const recordDate = new Date(timestamp);
                    return recordDate >= monthAgo;
                    } catch (e) {
                        console.warn('날짜 파싱 오류:', timestamp, e);
                        return false;
                    }
                });
            }
            
            console.log('필터링된 레코드 수:', filteredRecords.length);
            
            if (filteredRecords.length === 0) {
                console.log('필터링된 레코드가 없습니다. 전체 레코드 사용');
                // 필터링된 레코드가 없으면 전체 레코드 사용
                filteredRecords = records;
            }
            
            // 식당별 통계 계산
            const restaurantStats = {};
            filteredRecords.forEach(r => {
                const restaurant = getFieldValue(r, 'Restaurant') || getFieldValue(r, 'restaurant');
                if (restaurant && restaurant.trim()) {
                    if (!restaurantStats[restaurant]) {
                        restaurantStats[restaurant] = {
                            count: 0,
                            totalRating: 0,
                            ratings: []
                        };
                    }
                    restaurantStats[restaurant].count++;
                    const tasteRating = getFieldValue(r, 'TasteRating') || getFieldValue(r, 'tasteRating') || getFieldValue(r, 'Taste Rating');
                    const rating = parseFloat(tasteRating) || 0;
                    if (rating > 0) {
                        restaurantStats[restaurant].totalRating += rating;
                        restaurantStats[restaurant].ratings.push(rating);
                    }
                }
            });
            
            console.log('식당별 통계:', Object.keys(restaurantStats).length, '개');
            if (Object.keys(restaurantStats).length > 0) {
                console.log('식당별 통계 상세:', restaurantStats);
            }
            
            // 평균 평점 계산 및 정렬
            const restaurantList = Object.keys(restaurantStats).map(name => {
                const stats = restaurantStats[name];
                const avgRating = stats.ratings.length > 0 
                    ? (stats.totalRating / stats.ratings.length).toFixed(1)
                    : '0.0';
                return {
                    name: name,
                    count: stats.count,
                    avgRating: parseFloat(avgRating)
                };
            }).sort((a, b) => {
                // 리뷰 수가 같으면 평점으로 정렬, 다르면 리뷰 수로 정렬
                if (b.count === a.count) {
                    return b.avgRating - a.avgRating;
                }
                return b.count - a.count;
            }).slice(0, 3); // 상위 3개만
            
            console.log('인기 식당 목록:', restaurantList);
            
            // HTML 업데이트
            const container = document.getElementById('popularRestaurantsContent');
            if (!container) {
                console.error('popularRestaurantsContent 컨테이너를 찾을 수 없습니다!');
                // 잠시 후 다시 시도
                setTimeout(() => {
                    const retryContainer = document.getElementById('popularRestaurantsContent');
                    if (retryContainer && restaurantList.length > 0) {
                        updatePopularRestaurantsHTML(retryContainer, restaurantList);
                    }
                }, 100);
                return;
            }
            
            if (restaurantList.length === 0) {
                console.log('인기 식당이 없습니다.');
                // 예시 데이터 대신 빈 상태 메시지 표시
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">아직 기록이 없습니다.</div>';
                return;
            }
            
            updatePopularRestaurantsHTML(container, restaurantList);
        }
        
        // 인기 식당 HTML 업데이트 헬퍼 함수
        function updatePopularRestaurantsHTML(container, restaurantList) {
            const rankBadges = ['gold', 'silver', 'bronze'];
            const emojis = ['🏮', '🌶️', '🔥', '🍽️', '🍜', '🍱'];
            
            container.innerHTML = restaurantList.map((restaurant, index) => {
                const rankBadge = rankBadges[index] || 'bronze';
                const emoji = emojis[index % emojis.length];
                
                return `
                    <div class="popular-restaurant-item">
                        <div class="rank-badge ${rankBadge}">${index + 1}</div>
                        <div class="restaurant-emoji-small">${emoji}</div>
                        <div class="restaurant-info-small">
                            <div class="restaurant-name-small">${restaurant.name}</div>
                            <div class="restaurant-count">${restaurant.count}건</div>
                        </div>
                        <div class="restaurant-rating-small">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 1L10 6L16 6L11 9L13 14L8 11L3 14L5 9L0 6L6 6L8 1Z" fill="#FF6B4A"/>
                            </svg>
                            <span>${restaurant.avgRating.toFixed(1)}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            console.log('인기 식당 HTML 업데이트 완료:', restaurantList.length, '개');
        }
        
        // 예시 인기 식당 표시 (데이터가 없을 때)
        function showExamplePopularRestaurants() {
            const container = document.getElementById('popularRestaurantsContent');
            if (!container) return;
            
            const exampleRestaurants = [
                { name: '황제짬뽕', count: 23, rating: 4.8, emoji: '🏮', badge: 'gold' },
                { name: '저스트카츠 의왕점', count: 18, rating: 4.7, emoji: '🌶️', badge: 'silver' },
                { name: '프랭크버거 의왕내손점', count: 15, rating: 4.7, emoji: '🔥', badge: 'bronze' }
            ];
            
            container.innerHTML = exampleRestaurants.map((restaurant, index) => {
                return `
                    <div class="popular-restaurant-item">
                        <div class="rank-badge ${restaurant.badge}">${index + 1}</div>
                        <div class="restaurant-emoji-small">${restaurant.emoji}</div>
                        <div class="restaurant-info-small">
                            <div class="restaurant-name-small">${restaurant.name}</div>
                            <div class="restaurant-count">${restaurant.count}건</div>
                        </div>
                        <div class="restaurant-rating-small">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 1L10 6L16 6L11 9L13 14L8 11L3 14L5 9L0 6L6 6L8 1Z" fill="#FF6B4A"/>
                            </svg>
                            <span>${restaurant.rating}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // 이달의 식당 랭킹 업데이트
        function updateMonthlyRanking(records) {
            console.log('updateMonthlyRanking 호출됨, 레코드 수:', records ? records.length : 0);
            
            if (!records || records.length === 0) {
                console.log('데이터가 없습니다.');
                // 예시 데이터 대신 빈 상태 메시지 표시
                const container = document.getElementById('monthlyRankingList');
                if (container) {
                    container.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">아직 기록이 없습니다.</div>';
                }
                return;
            }
            
            // 이번 달 데이터 필터링
            const now = new Date();
            const monthAgo = new Date(now);
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            
            const monthlyRecords = records.filter(r => {
                const timestamp = getFieldValue(r, 'Timestamp') || getFieldValue(r, 'timestamp');
                if (!timestamp) return false;
                try {
                    const recordDate = new Date(timestamp);
                return recordDate >= monthAgo;
                } catch (e) {
                    console.warn('날짜 파싱 오류:', timestamp, e);
                    return false;
                }
            });
            
            console.log('이번 달 레코드 수:', monthlyRecords.length);
            
            // 이번 달 레코드가 없으면 전체 레코드 사용
            const recordsToUse = monthlyRecords.length > 0 ? monthlyRecords : records;
            console.log('사용할 레코드 수:', recordsToUse.length);
            
            // 식당별 통계 계산
            const restaurantStats = {};
            recordsToUse.forEach(r => {
                const restaurant = getFieldValue(r, 'Restaurant') || getFieldValue(r, 'restaurant');
                if (restaurant && restaurant.trim()) {
                    if (!restaurantStats[restaurant]) {
                        restaurantStats[restaurant] = {
                            count: 0,
                            totalRating: 0,
                            ratings: [],
                            menus: {},
                            distance: null
                        };
                    }
                    restaurantStats[restaurant].count++;
                    const tasteRating = getFieldValue(r, 'TasteRating') || getFieldValue(r, 'tasteRating') || getFieldValue(r, 'Taste Rating');
                    const rating = parseFloat(tasteRating) || 0;
                    if (rating > 0) {
                        restaurantStats[restaurant].totalRating += rating;
                        restaurantStats[restaurant].ratings.push(rating);
                    }
                    
                    // 메뉴 통계
                    const menu = getFieldValue(r, 'Menu') || getFieldValue(r, 'menu');
                    if (menu) {
                        restaurantStats[restaurant].menus[menu] = (restaurantStats[restaurant].menus[menu] || 0) + 1;
                    }
                    
                    // 거리 정보 (식당 데이터에서 찾기)
                    if (!restaurantStats[restaurant].distance) {
                        for (const category in restaurants) {
                            const found = restaurants[category].find(rest => rest.name === restaurant);
                            if (found) {
                                restaurantStats[restaurant].distance = found.distance;
                                break;
                            }
                        }
                    }
                }
            });
            
            console.log('이달의 식당 통계:', Object.keys(restaurantStats).length, '개');
            if (Object.keys(restaurantStats).length > 0) {
                console.log('이달의 식당 통계 상세:', restaurantStats);
            }
            
            // 평균 평점 계산 및 정렬
            const restaurantList = Object.keys(restaurantStats).map(name => {
                const stats = restaurantStats[name];
                const avgRating = stats.ratings.length > 0 
                    ? (stats.totalRating / stats.ratings.length).toFixed(1)
                    : '0.0';
                
                // 베스트 메뉴 찾기
                const bestMenuRaw = Object.keys(stats.menus).reduce((a, b) => 
                    stats.menus[a] > stats.menus[b] ? a : b, Object.keys(stats.menus)[0]
                ) || '메뉴 없음';
                
                // 메뉴 이름에서 가격 제거 (일관성 유지)
                // "마라탕 10000" 또는 "마라탕 10000원" 같은 형식에서 메뉴 이름만 추출
                let bestMenu = bestMenuRaw;
                if (bestMenu && bestMenu !== '메뉴 없음') {
                    // 가격 패턴 제거 (숫자로 끝나는 경우)
                    bestMenu = bestMenu.replace(/\s+\d{1,}(?:~\d+)?\s*원?$/, '').trim();
                    // "메뉴: " 같은 접두사 제거
                    bestMenu = bestMenu.replace(/^메뉴\s*:\s*/i, '').trim();
                    // 빈 문자열이면 원본 사용
                    if (!bestMenu) {
                        bestMenu = bestMenuRaw;
                    }
                }
                
                return {
                    name: name,
                    count: stats.count,
                    avgRating: parseFloat(avgRating),
                    bestMenu: bestMenu,
                    distance: stats.distance || '정보 없음'
                };
            }).sort((a, b) => {
                // 별점순으로 정렬 (평점이 같으면 리뷰 수로 정렬)
                if (b.avgRating === a.avgRating) {
                    return b.count - a.count;
                }
                return b.avgRating - a.avgRating;
            }).slice(0, 10); // 상위 10개
            
            console.log('이달의 식당 랭킹 목록:', restaurantList.length, '개');
            if (restaurantList.length > 0) {
                console.log('이달의 식당 랭킹 상세:', restaurantList);
            }
            
            // HTML 업데이트
            const wrapper = document.getElementById('rankingSwipeWrapper');
            if (!wrapper) {
                console.error('rankingSwipeWrapper 컨테이너를 찾을 수 없습니다!');
                // 잠시 후 다시 시도
                setTimeout(() => {
                    const retryWrapper = document.getElementById('rankingSwipeWrapper');
                    if (retryWrapper && restaurantList.length > 0) {
                        updateMonthlyRankingHTML(retryWrapper, restaurantList);
                    }
                }, 100);
                return;
            }
            
            if (restaurantList.length === 0) {
                console.log('이달의 식당이 없습니다.');
                // 예시 데이터 대신 빈 상태 메시지 표시
                wrapper.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">아직 기록이 없습니다.</div>';
                return;
            }
            
            updateMonthlyRankingHTML(wrapper, restaurantList);
        }
        
        // 이달의 식당 랭킹 HTML 업데이트 헬퍼 함수
        function updateMonthlyRankingHTML(container, restaurantList) {
            
            const rankBadges = ['gold', 'silver', 'bronze'];
            const emojis = ['🏮', '🌶️', '🔥', '🍽️', '🍜', '🍱', '🥟', '🍣', '🍚', '🍝'];
            
            // 각 식당을 카드로 만들어서 스와이프 가능하게
            container.innerHTML = restaurantList.map((restaurant, index) => {
                const rankBadge = rankBadges[index] || 'bronze';
                const emoji = emojis[index % emojis.length];
                const isFeatured = index === 0;
                
                return `
                    <div class="ranking-swipe-card">
                    <div class="ranking-item ${isFeatured ? 'featured' : ''}">
                        <div class="ranking-header">
                            <div class="rank-number ${rankBadge}">${index + 1}</div>
                            ${index === 0 ? '<div class="rank-change up"><svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M6 0L7.5 4.5L12 4.5L8.5 7.5L10 12L6 9L2 12L3.5 7.5L0 4.5L4.5 4.5L6 0Z" fill="#22C55E"/></svg>12%</div>' : ''}
                        </div>
                        <div class="ranking-restaurant">
                            <div class="restaurant-emoji-large">${emoji}</div>
                            <div class="ranking-info">
                                <div class="ranking-name">${restaurant.name}</div>
                                <div class="ranking-distance-badge">${restaurant.distance}</div>
                            </div>
                        </div>
                        <div class="ranking-details">
                            <div class="detail-item">
                                <span>평점</span>
                                <span class="detail-value">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M8 1L10 6L16 6L11 9L13 14L8 11L3 14L5 9L0 6L6 6L8 1Z" fill="#FF6B4A"/>
                                    </svg>
                                    ${restaurant.avgRating.toFixed(1)}
                                </span>
                            </div>
                            <div class="detail-item">
                                <span>리뷰 수</span>
                                <span class="detail-value">${restaurant.count}개</span>
                            </div>
                            <div class="detail-item">
                                <span>베스트 메뉴</span>
                                <span class="detail-value highlight">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M8 0L10 4L14 4L11 7L12 12L8 9L4 12L5 7L2 4L6 4L8 0Z" fill="#F59E0B"/>
                                    </svg>
                                    ${restaurant.bestMenu}
                                </span>
                            </div>
                        </div>
                        ${isFeatured ? `
                        <div class="ranking-badge-special">
                            <span>🎉</span>
                            <span>이달의 최고 인기 식당!</span>
                        </div>
                        ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            // 페이지네이션 도트 업데이트
            updateRankingPagination(restaurantList.length);
            
            // 스와이프 기능 초기화
            setTimeout(() => {
                initRankingSwipe();
            }, 100);
            
            console.log('이달의 식당 랭킹 HTML 업데이트 완료');
        }
        
        // 페이지네이션 도트 업데이트
        function updateRankingPagination(totalItems) {
            const pagination = document.getElementById('rankingPagination');
            if (!pagination) return;
            
            pagination.innerHTML = '';
            // 최대 10개의 도트만 표시
            const dotCount = Math.min(totalItems, 10);
            for (let i = 0; i < dotCount; i++) {
                const dot = document.createElement('div');
                dot.className = `ranking-dot ${i === 0 ? 'active' : ''}`;
                dot.setAttribute('data-index', i);
                pagination.appendChild(dot);
            }
        }
        
        // 이달의 식당 랭킹 스와이프 기능 초기화 (터치 + 마우스 + 클릭 지원)
        function initRankingSwipe() {
            const container = document.getElementById('rankingSwipeContainer');
            const wrapper = document.getElementById('rankingSwipeWrapper');
            
            if (!container || !wrapper) return;
            
            let currentIndex = 0;
            const cards = wrapper.querySelectorAll('.ranking-swipe-card');
            const totalCards = cards.length;
            
            if (totalCards === 0) return;
            
            // 도트 선택 (동적으로 업데이트될 수 있으므로 함수 내에서 선택)
            const getDots = () => document.querySelectorAll('#rankingPagination .ranking-dot');
            let dots = getDots();
            
            // 현재 인덱스에 맞게 위치 설정
            const updatePosition = () => {
                const translateX = -currentIndex * 100;
                wrapper.style.transform = `translateX(${translateX}%)`;
                
                // 도트 업데이트 (매번 다시 선택)
                dots = getDots();
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === currentIndex);
                });
            };
            
            // 다음 카드로 이동
            const goToNext = () => {
                if (currentIndex < totalCards - 1) {
                    currentIndex++;
                    updatePosition();
                }
            };
            
            // 이전 카드로 이동
            const goToPrev = () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    updatePosition();
                }
            };
            
            // 특정 인덱스로 이동
            const goToIndex = (index) => {
                if (index >= 0 && index < totalCards) {
                    currentIndex = index;
                    updatePosition();
                }
            };
            
            // 도트 클릭 이벤트 (이벤트 위임 사용)
            const pagination = document.getElementById('rankingPagination');
            if (pagination) {
                pagination.addEventListener('click', (e) => {
                    const dot = e.target.closest('.ranking-dot');
                    if (dot) {
                        const index = parseInt(dot.getAttribute('data-index'));
                        if (!isNaN(index)) {
                            goToIndex(index);
                        }
                    }
                });
            }
            
            // 스와이프 변수
            let startX = 0;
            let startY = 0;
            let isDragging = false;
            let startTranslateX = 0;
            let clickStartTime = 0;
            let clickStartX = 0;
            
            // 터치/마우스 시작
            const handleStart = (clientX, clientY) => {
                isDragging = true;
                startX = clientX;
                startY = clientY;
                startTranslateX = -currentIndex * 100;
                clickStartTime = Date.now();
                clickStartX = clientX;
                wrapper.style.transition = 'none';
            };
            
            // 터치/마우스 이동
            const handleMove = (clientX, clientY) => {
                if (!isDragging) return;
                
                const deltaX = clientX - startX;
                const deltaY = Math.abs(clientY - startY);
                
                // 수평 스와이프만 처리 (수직 스와이프는 무시)
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    const newTranslateX = startTranslateX + (deltaX / container.offsetWidth) * 100;
                    wrapper.style.transform = `translateX(${newTranslateX}%)`;
                }
            };
            
            // 터치/마우스 종료
            const handleEnd = (clientX) => {
                if (!isDragging) return;
                isDragging = false;
                wrapper.style.transition = 'transform 0.3s ease-out';
                
                const deltaX = clientX - startX;
                const deltaTime = Date.now() - clickStartTime;
                const deltaClickX = Math.abs(clientX - clickStartX);
                const threshold = container.offsetWidth * 0.2; // 20% 이상 움직이면 스와이프
                
                // 클릭 감지 (짧은 시간 + 작은 이동 거리)
                if (deltaTime < 300 && deltaClickX < 10) {
                    // 클릭 위치에 따라 다음/이전으로 이동
                    const clickX = clientX - container.getBoundingClientRect().left;
                    const containerWidth = container.offsetWidth;
                    
                    if (clickX < containerWidth * 0.3 && currentIndex > 0) {
                        // 왼쪽 영역 클릭 -> 이전
                        goToPrev();
                    } else if (clickX > containerWidth * 0.7 && currentIndex < totalCards - 1) {
                        // 오른쪽 영역 클릭 -> 다음
                        goToNext();
                    } else {
                        updatePosition();
                    }
                } else if (Math.abs(deltaX) > threshold) {
                    // 드래그 스와이프
                    if (deltaX > 0 && currentIndex > 0) {
                        goToPrev();
                    } else if (deltaX < 0 && currentIndex < totalCards - 1) {
                        goToNext();
                    } else {
                        updatePosition();
                    }
                } else {
                    updatePosition();
                }
            };
            
            // 터치 이벤트 (모바일)
            container.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                handleStart(touch.clientX, touch.clientY);
            }, { passive: false });
            
            container.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                handleMove(touch.clientX, touch.clientY);
            }, { passive: false });
            
            container.addEventListener('touchend', (e) => {
                e.preventDefault();
                const touch = e.changedTouches[0];
                handleEnd(touch.clientX);
            }, { passive: false });
            
            // 마우스 이벤트 (웹)
            container.addEventListener('mousedown', (e) => {
                e.preventDefault();
                handleStart(e.clientX, e.clientY);
            });
            
            container.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    handleMove(e.clientX, e.clientY);
                }
            });
            
            container.addEventListener('mouseup', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    handleEnd(e.clientX);
                }
            });
            
            container.addEventListener('mouseleave', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    handleEnd(e.clientX);
                }
            });
            
            // 초기 위치 설정
            updatePosition();
        }
        
        // 예시 이달의 식당 랭킹 표시 (데이터가 없을 때)
        function showExampleMonthlyRanking() {
            const container = document.getElementById('monthlyRankingList');
            if (!container) return;
            
            const exampleRestaurants = [
                { name: '황제짬뽕', count: 342, rating: 4.7, bestMenu: '황제짬뽕', distance: '도보 10분', emoji: '🥟', badge: 'gold' },
                { name: '멘구락부 의왕', count: 245, rating: 4.5, bestMenu: '쇼유라멘', distance: '도보 10분', emoji: '🍜', badge: 'bronze' },
                { name: '저스트카츠 의왕점', count: 298, rating: 4.6, bestMenu: '등심카츠 정식', distance: '도보 5~10분', emoji: '🍜', badge: 'silver' },
                { name: '프랭크버거 의왕내손점', count: 267, rating: 4.6, bestMenu: '프랭크버거', distance: '도보 5~10분', emoji: '🔥', badge: 'bronze' },
                { name: '멘구락부 의왕', count: 245, rating: 4.5, bestMenu: '쇼유라멘', distance: '도보 10분', emoji: '🍜', badge: 'bronze' },
                { name: '일지오 페페', count: 223, rating: 4.5, bestMenu: '까르보나라 파스타', distance: '도보 10분', emoji: '🍝', badge: 'bronze' }
            ];
            
            container.innerHTML = exampleRestaurants.map((restaurant, index) => {
                const isFeatured = index === 0;
                
                return `
                    <div class="ranking-item ${isFeatured ? 'featured' : ''}">
                        <div class="ranking-header">
                            <div class="rank-number ${restaurant.badge}">${index + 1}</div>
                            ${isFeatured ? '<div class="rank-change up">↗ 최고</div>' : ''}
                        </div>
                        <div class="ranking-restaurant">
                            <div class="restaurant-emoji-large">${restaurant.emoji}</div>
                            <div class="ranking-info">
                                <div class="ranking-name">${restaurant.name}</div>
                                <div class="ranking-distance-badge">${restaurant.distance}</div>
                            </div>
                        </div>
                        <div class="ranking-details">
                            <div class="detail-item">
                                <span>평점</span>
                                <span class="detail-value">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M8 1L10 6L16 6L11 9L13 14L8 11L3 14L5 9L0 6L6 6L8 1Z" fill="#FF6B4A"/>
                                    </svg>
                                    ${restaurant.rating}
                                </span>
                            </div>
                            <div class="detail-item">
                                <span>리뷰 수</span>
                                <span class="detail-value">${restaurant.count}개</span>
                            </div>
                            <div class="detail-item">
                                <span>베스트 메뉴</span>
                                <span class="detail-value highlight">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M8 0L10 4L14 4L11 7L12 12L8 9L4 12L5 7L2 4L6 4L8 0Z" fill="#F59E0B"/>
                                    </svg>
                                    ${restaurant.bestMenu}
                                </span>
                            </div>
                        </div>
                        ${isFeatured ? `
                        <div class="ranking-badge-special">
                            <span>🎉</span>
                            <span>이달의 최고 인기 식당!</span>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            // 페이지네이션 도트 업데이트 (최대 5개)
            updateRankingPagination(Math.min(exampleRestaurants.length, 5));
        }
        
        // 인기 식당 탭 클릭 이벤트 초기화
        function initPopularRestaurantTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn[data-period]');
            tabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 모든 탭 버튼에서 active 제거
                    tabButtons.forEach(b => b.classList.remove('active'));
                    // 클릭한 버튼에 active 추가
                    this.classList.add('active');
                    
                    // 인기 식당 업데이트
                    const records = recordsCache || [];
                    updatePopularRestaurants(records);
                });
            });
        }

        // 최근 기록 업데이트
        function updateRecentRecords(records) {
            const container = document.querySelector('.recent-records');
            if (!container) return;

            container.innerHTML = '';
            
            if (!records || records.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(0, 0, 0, 0.4); font-size: 14px;">아직 기록이 없습니다.</div>';
                return;
            }
            
            records.forEach(record => {
                const recordItem = document.createElement('div');
                recordItem.className = 'record-item';
                
                const moodEmojis = {
                    '행복': '😊',
                    '만족함': '😋',
                    '보통': '😐',
                    '별로': '😔',
                    '나른함': '🤤',
                    '화남': '😤'
                };

                const tasteRating = getFieldValue(record, 'TasteRating') || getFieldValue(record, 'tasteRating') || getFieldValue(record, 'Taste Rating') || 0;
                const stars = '⭐'.repeat(Math.round(parseFloat(tasteRating) || 0));
                const keywords = getFieldValue(record, 'Keywords') || getFieldValue(record, 'keywords') || '';
                const keywordList = keywords ? String(keywords).split(',').map(k => k.trim()).filter(k => k) : [];
                const timestamp = getFieldValue(record, 'Timestamp') || getFieldValue(record, 'timestamp');
                // 타임스탬프 파싱 (다양한 형식 지원)
                let recordDate = null;
                if (timestamp) {
                    try {
                        recordDate = new Date(timestamp);
                        if (isNaN(recordDate.getTime())) {
                            // 날짜 파싱 실패 시 다른 형식 시도
                            recordDate = null;
                        }
                    } catch (e) {
                        console.warn('날짜 파싱 오류:', timestamp, e);
                    }
                }
                const timeAgo = recordDate ? getTimeAgo(recordDate) : '시간 정보 없음';
                
                // 메뉴 이름에서 가격 제거 (일관성 유지)
                let menuName = getFieldValue(record, 'Menu') || getFieldValue(record, 'menu') || '';
                if (menuName) {
                    // 가격 패턴 제거
                    menuName = menuName.replace(/\s+\d{1,}(?:~\d+)?\s*원?$/, '').trim();
                    // "메뉴: " 같은 접두사 제거
                    menuName = menuName.replace(/^메뉴\s*:\s*/i, '').trim();
                }
                
                const restaurant = getFieldValue(record, 'Restaurant') || getFieldValue(record, 'restaurant') || '';
                const mood = getFieldValue(record, 'Mood') || getFieldValue(record, 'mood') || '';
                const department = getFieldValue(record, 'Department') || getFieldValue(record, 'department') || '';

                recordItem.innerHTML = `
                    <div class="record-header">
                        <div class="record-left">
                            <div class="record-emoji">${moodEmojis[mood] || '😊'}</div>
                            <div class="record-info">
                                <div class="record-menu">${menuName || '메뉴 정보 없음'}</div>
                                <div class="record-restaurant">
                                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M6 1L7 6L12 6L8 9L9 14L6 11L3 14L4 9L0 6L5 6L6 1Z" fill="#FD4B21"/>
                                    </svg>
                                    <span>${restaurant || '식당 정보 없음'}</span>
                                </div>
                            </div>
                        </div>
                        <div class="record-stars">${stars}</div>
                    </div>
                    ${keywords ? `<div class="record-content">${keywords}</div>` : ''}
                    ${keywordList.length > 0 ? `
                    <div class="record-keywords">
                        ${keywordList.map(k => `<span class="keyword-badge-small">${k}</span>`).join('')}
                    </div>
                    ` : ''}
                    <div class="record-footer">
                        <span class="record-author">익명${department ? ' · ' + department : ''}</span>
                        <span class="record-time">${timeAgo}</span>
                    </div>
                `;
                container.appendChild(recordItem);
            });
            
            // 최신 기록이 위에 있으므로 맨 위로 스크롤
            container.scrollTop = 0;
        }

        // 시간 경과 계산
        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return '방금 전';
            if (minutes < 60) return minutes + '분 전';
            if (hours < 24) return hours + '시간 전';
            return days + '일 전';
        }

        // 지도 화면 데이터 로드
        async function loadMapData() {
            // 트렌드 데이터를 먼저 로드 (없으면 빈 배열)
            let records = recordsCache || [];
            if (records.length === 0 && !window.isLoadingRecords) {
                records = await loadRecords(false);
            }
            
            // 카테고리별 식당 리스트 생성 (트렌드 데이터 포함)
            renderCategoryRestaurantList('전체', records, false, currentSortType);
        }
        
        // 페이지 로드 시 데이터 미리 로드 (백그라운드, 로딩 표시 없이)
        // 시각평가 스와이프 기능 초기화 (터치 + 마우스 + 클릭 지원)
        function initVisualRatingSwipe() {
            const container = document.getElementById('visualRatingSwipeContainer');
            const wrapper = document.getElementById('visualRatingSwipeWrapper');
            const dots = document.querySelectorAll('.visual-rating-dot');
            
            if (!container || !wrapper) return;
            
            let currentIndex = 0;
            const cards = wrapper.querySelectorAll('.visual-rating-swipe-card');
            const totalCards = cards.length;
            
            if (totalCards === 0) return;
            
            // 현재 인덱스에 맞게 위치 설정
            const updatePosition = () => {
                const translateX = -currentIndex * 100;
                wrapper.style.transform = `translateX(${translateX}%)`;
                
                // 도트 업데이트
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === currentIndex);
                });
            };
            
            // 다음 카드로 이동
            const goToNext = () => {
                if (currentIndex < totalCards - 1) {
                    currentIndex++;
                    updatePosition();
                }
            };
            
            // 이전 카드로 이동
            const goToPrev = () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    updatePosition();
                }
            };
            
            // 특정 인덱스로 이동
            const goToIndex = (index) => {
                if (index >= 0 && index < totalCards) {
                    currentIndex = index;
                    updatePosition();
                }
            };
            
            // 도트 클릭 이벤트
            dots.forEach((dot, index) => {
                dot.addEventListener('click', () => {
                    goToIndex(index);
                });
            });
            
            // 스와이프 변수
            let startX = 0;
            let startY = 0;
            let isDragging = false;
            let startTranslateX = 0;
            let clickStartTime = 0;
            let clickStartX = 0;
            
            // 터치/마우스 시작
            const handleStart = (clientX, clientY) => {
                isDragging = true;
                startX = clientX;
                startY = clientY;
                startTranslateX = -currentIndex * 100;
                clickStartTime = Date.now();
                clickStartX = clientX;
                wrapper.style.transition = 'none';
            };
            
            // 터치/마우스 이동
            const handleMove = (clientX, clientY) => {
                if (!isDragging) return;
                
                const deltaX = clientX - startX;
                const deltaY = Math.abs(clientY - startY);
                
                // 수평 스와이프만 처리 (수직 스와이프는 무시)
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    const newTranslateX = startTranslateX + (deltaX / container.offsetWidth) * 100;
                    wrapper.style.transform = `translateX(${newTranslateX}%)`;
                }
            };
            
            // 터치/마우스 종료
            const handleEnd = (clientX) => {
                if (!isDragging) return;
                isDragging = false;
                wrapper.style.transition = 'transform 0.3s ease-out';
                
                const deltaX = clientX - startX;
                const deltaTime = Date.now() - clickStartTime;
                const deltaClickX = Math.abs(clientX - clickStartX);
                const threshold = container.offsetWidth * 0.2; // 20% 이상 움직이면 스와이프
                
                // 클릭 감지 (짧은 시간 + 작은 이동 거리)
                if (deltaTime < 300 && deltaClickX < 10) {
                    // 클릭 위치에 따라 다음/이전으로 이동
                    const clickX = clientX - container.getBoundingClientRect().left;
                    const containerWidth = container.offsetWidth;
                    
                    if (clickX < containerWidth * 0.3 && currentIndex > 0) {
                        // 왼쪽 영역 클릭 -> 이전
                        goToPrev();
                    } else if (clickX > containerWidth * 0.7 && currentIndex < totalCards - 1) {
                        // 오른쪽 영역 클릭 -> 다음
                        goToNext();
                    } else {
                        updatePosition();
                    }
                } else if (Math.abs(deltaX) > threshold) {
                    // 드래그 스와이프
                    if (deltaX > 0 && currentIndex > 0) {
                        goToPrev();
                    } else if (deltaX < 0 && currentIndex < totalCards - 1) {
                        goToNext();
                    } else {
                        updatePosition();
                    }
                } else {
                    updatePosition();
                }
            };
            
            // 터치 이벤트 (모바일)
            container.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                handleStart(touch.clientX, touch.clientY);
            }, { passive: false });
            
            container.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                handleMove(touch.clientX, touch.clientY);
            }, { passive: false });
            
            container.addEventListener('touchend', (e) => {
                e.preventDefault();
                const touch = e.changedTouches[0];
                handleEnd(touch.clientX);
            }, { passive: false });
            
            // 마우스 이벤트 (웹)
            container.addEventListener('mousedown', (e) => {
                e.preventDefault();
                handleStart(e.clientX, e.clientY);
            });
            
            container.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    handleMove(e.clientX, e.clientY);
                }
            });
            
            container.addEventListener('mouseup', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    handleEnd(e.clientX);
                }
            });
            
            container.addEventListener('mouseleave', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    handleEnd(e.clientX);
                }
            });
            
            // 초기 위치 설정
            updatePosition();
        }
        
        function preloadData() {
            // 이미 로드 중이거나 캐시가 있으면 중복 호출 방지
            if (recordsCache) {
                console.log('캐시된 데이터 사용:', recordsCache.length, '개');
                return;
            }
            
            // 데이터 로드 중 플래그
            if (window.isLoadingRecords) {
                console.log('이미 데이터 로드 중...');
                return;
            }
            
            window.isLoadingRecords = true;
            loadRecords(true).then(records => {
                window.isLoadingRecords = false;
                console.log('페이지 로드 시 데이터 미리 로드 완료:', records.length, '개');
                // 트렌드 화면이 현재 표시 중이면 데이터 업데이트
                const trendScreen = document.getElementById('trendScreen');
                if (trendScreen && trendScreen.classList.contains('active')) {
                    loadTrendData(false); // 이미 로드된 데이터 사용
                }
            }).catch(err => {
                window.isLoadingRecords = false;
                console.error('데이터 로드 오류:', err);
            });
        }

        // 지도에 식당 마커 표시 (비활성화됨)
        function displayRestaurantMarkers(restaurantReviews) {
            const mapBackground = document.getElementById('mapBackground');
            if (!mapBackground) return;

            // 기존 마커 제거 (학교 마커 제외)
            const existingMarkers = mapBackground.querySelectorAll('.restaurant-marker');
            existingMarkers.forEach(marker => marker.remove());
            
            // 마커 표시 기능 비활성화 - 함수 종료
            return;

            // 모든 카테고리의 식당 수집
            const allRestaurants = [];
            Object.keys(restaurants).forEach(category => {
                restaurants[category].forEach(restaurant => {
                    allRestaurants.push({
                        ...restaurant,
                        category: category
                    });
                });
            });
            
            // 식당 마커 생성 및 배치 (모든 마커 생성)
            // 거리 순서대로 원형 레이어로 배치
            const markerPositions = [];
            const minDistance = 12; // 마커 간 최소 거리 (%)
            
            // 거리별로 그룹화
            const distanceGroups = {};
            allRestaurants.forEach(restaurant => {
                const distance = parseInt(restaurant.distance.match(/\d+/)?.[0] || '15');
                if (!distanceGroups[distance]) {
                    distanceGroups[distance] = [];
                }
                distanceGroups[distance].push(restaurant);
            });
            
            // 거리 순서대로 정렬 (5분, 8분, 10분, 12분...)
            const sortedDistances = Object.keys(distanceGroups).sort((a, b) => parseInt(a) - parseInt(b));
            
            // 각 거리 레이어별로 마커 배치
            sortedDistances.forEach((distanceStr, layerIndex) => {
                const distance = parseInt(distanceStr);
                const group = distanceGroups[distanceStr];
                const groupSize = group.length;
                
                // 거리에 따라 반지름 결정 (5분=25%, 10분=30%, 15분=35%, 20분=40%, 25분=45%)
                const baseRadius = Math.min(25 + (distance - 5) * 1.2, 45);
                
                // 각 레이어마다 약간의 회전 오프셋 (겹침 방지)
                const layerRotation = layerIndex * 0.3;
                
                // 그룹 내 마커들을 균등하게 원형 배치
                group.forEach((restaurant, groupIndex) => {
                    // 그룹 내에서 균등한 각도 분배
                    const angleStep = (2 * Math.PI) / groupSize;
                    const angle = (groupIndex * angleStep) + layerRotation;
                    
                    // 위치 계산
                    let left = 50 + (baseRadius * Math.cos(angle));
                    let top = 50 + (baseRadius * Math.sin(angle));
                    
                    // 기존 마커와의 최소 거리 보장 (최적화: 최대 10번만 시도)
                    let attempts = 0;
                    while (attempts < 10) {
                        let tooClose = false;
                        const checkCount = Math.min(markerPositions.length, 10); // 최근 10개만 체크
                        for (let i = Math.max(0, markerPositions.length - checkCount); i < markerPositions.length; i++) {
                            const existingPos = markerPositions[i];
                            const dx = left - existingPos.left;
                            const dy = top - existingPos.top;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                            if (dist < minDistance) {
                                tooClose = true;
                                // 충돌 시 반지름을 약간 늘려서 배치
                                const currentRadius = Math.sqrt((left - 50) ** 2 + (top - 50) ** 2);
                                const newRadius = currentRadius + (minDistance - dist) + 2;
                                const currentAngle = Math.atan2(top - 50, left - 50);
                                left = 50 + (newRadius * Math.cos(currentAngle));
                                top = 50 + (newRadius * Math.sin(currentAngle));
                                break;
                            }
                        }
                        if (!tooClose) break;
                        attempts++;
                    }
                    
                    // 경계 체크 (지도 영역 내에 유지: 10%~90%)
                    left = Math.max(10, Math.min(90, left));
                    top = Math.max(10, Math.min(90, top));
                    
                    markerPositions.push({ left, top, restaurant });
                });
            });
            
            // 카테고리별 이모지 (한 번만 정의)
            const categoryEmojis = {
                '중식': '🥟',
                '일식': '🍣',
                '한식': '🍚',
                '양식': '🍝',
                '디저트': '🍰',
                '학식당': '🍽️'
            };

            // DocumentFragment 사용하여 DOM 조작 최소화
            const fragment = document.createDocumentFragment();
            
            // 마커 생성 및 배치
            for (let i = 0; i < markerPositions.length; i++) {
                const pos = markerPositions[i];
                const marker = document.createElement('div');
                marker.className = 'restaurant-marker';
                marker.setAttribute('data-restaurant', pos.restaurant.name);
                marker.setAttribute('data-category', pos.restaurant.category);
                marker.textContent = categoryEmojis[pos.restaurant.category] || '🍽️';
                marker.style.left = pos.left + '%';
                marker.style.top = pos.top + '%';
                
                // 마커 클릭 이벤트 (이벤트 위임 대신 개별 등록)
                marker.addEventListener('click', function() {
                    // 모든 마커의 active 클래스 제거
                    const allMarkers = mapBackground.querySelectorAll('.restaurant-marker');
                    for (let j = 0; j < allMarkers.length; j++) {
                        allMarkers[j].classList.remove('active');
                    }
                    
                    // 클릭한 마커에 active 클래스 추가
                    this.classList.add('active');
                    
                    // 해당 식당의 리뷰 가져오기
                    const reviews = restaurantReviews[pos.restaurant.name] || [];
                    
                    // 식당 카드 업데이트 및 표시
                    updateRestaurantCard(pos.restaurant.name, reviews, pos.restaurant);
                    
                    // 카드 표시
                    const restaurantCard = document.getElementById('restaurantCard');
                    if (restaurantCard) {
                        restaurantCard.classList.add('show', 'full');
                        restaurantCard.style.transform = 'translateX(-50%) translateY(0)';
                        
                        // 배경 오버레이 표시
                        const overlay = document.getElementById('bottomSheetOverlay');
                        if (overlay) {
                            overlay.classList.add('show');
                        }
                        
                        // 카테고리 리스트 숨기기 (중복 방지)
                        const categoryList = document.getElementById('categoryRestaurantList');
                        if (categoryList) {
                            categoryList.style.display = 'none';
                        }
                        
                        // 리뷰창이 열릴 때 마커들의 opacity 낮추기
                        for (let j = 0; j < allMarkers.length; j++) {
                            const m = allMarkers[j];
                            if (m.getAttribute('data-restaurant') !== pos.restaurant.name) {
                                m.style.opacity = '0.3';
                                m.style.pointerEvents = 'none';
                            } else {
                                m.style.opacity = '0.6';
                            }
                        }
                    }
                });
                
                fragment.appendChild(marker);
            }
            
            // 한 번에 DOM에 추가
            mapBackground.appendChild(fragment);
            
            // 현재 필터 적용
            filterMapRestaurants(currentMapFilter);
        }

        // 식당 카드 업데이트
        function updateRestaurantCard(restaurantName, reviews, restaurantInfo = null) {
            const restaurantCard = document.getElementById('restaurantCard');
            if (!restaurantCard) return;

            // 식당 정보 업데이트
            const restaurantNameEl = restaurantCard.querySelector('.restaurant-name');
            if (restaurantNameEl) {
                restaurantNameEl.textContent = restaurantName;
            }

            // 식당 이모지 업데이트
            const restaurantEmojiEl = restaurantCard.querySelector('.restaurant-emoji');
            if (restaurantEmojiEl && restaurantInfo) {
                const categoryEmojis = {
                    '중식': '🥟',
                    '일식': '🍣',
                    '한식': '🍚',
                    '양식': '🍝',
                    '디저트': '🍰',
                    '학식당': '🍽️'
                };
                restaurantEmojiEl.textContent = categoryEmojis[restaurantInfo.category] || '🍽️';
            }

            // 거리 정보 업데이트
            const distanceBadge = restaurantCard.querySelector('.distance-badge');
            if (distanceBadge && restaurantInfo) {
                distanceBadge.textContent = restaurantInfo.distance;
            }

            // 메뉴 정보 업데이트
            const menuSection = restaurantCard.querySelector('#cardMenuSection');
            const menuList = restaurantCard.querySelector('#menuList');
            const menuSectionHeader = restaurantCard.querySelector('#menuSectionHeader');
            if (menuSection && menuList && restaurantInfo && restaurantInfo.menus) {
                menuList.innerHTML = '';
                // '직접 입력...' 제외하고 메뉴 표시
                const displayMenus = restaurantInfo.menus.filter(menu => menu !== '직접 입력...');
                if (displayMenus.length > 0) {
                    // 메뉴 개수 표시
                    const menuCount = displayMenus.length;
                    const headerText = menuSectionHeader.querySelector('span:first-child');
                    if (headerText) {
                        headerText.textContent = `🍽️ 메뉴 (${menuCount}개)`;
                    }
                    
                    displayMenus.forEach(menu => {
                        // 메뉴 이름에서 가격 추출
                        // 형식: "메뉴명 가격" 또는 "메뉴명 가격원" 또는 "메뉴명 가격~가격원"
                        const priceMatch = menu.match(/(\d{1,}(?:~\d+)?)\s*원?$/);
                        let menuName = menu;
                        let priceText = '가격 정보 준비 중';
                        
                        if (priceMatch) {
                            // 가격이 있는 경우
                            const price = priceMatch[1];
                            // 범위 가격 처리 (예: 60000~65000)
                            if (price.includes('~')) {
                                priceText = price.replace('~', '~') + '원';
                            } else {
                                priceText = price + '원';
                            }
                            // 메뉴 이름에서 가격 부분 제거 (숫자와 "원" 제거)
                            menuName = menu.replace(/\s+\d{1,}(?:~\d+)?\s*원?$/, '').trim();
                        }
                        
                        const menuItem = document.createElement('div');
                        menuItem.className = 'menu-item';
                        menuItem.innerHTML = `
                            <span class="menu-name">${menuName}</span>
                            <span class="menu-price">${priceText}</span>
                        `;
                        menuList.appendChild(menuItem);
                    });
                    
                    // 드롭다운 토글 이벤트 추가
                    if (menuSectionHeader) {
                        menuSectionHeader.onclick = function() {
                            menuList.classList.toggle('expanded');
                            menuSectionHeader.classList.toggle('expanded');
                        };
                    }
                    
                    // 초기 상태: 접혀있음
                    menuList.classList.remove('expanded');
                    menuSectionHeader.classList.remove('expanded');
                    
                    menuSection.style.display = 'block';
                } else {
                    menuSection.style.display = 'none';
                }
            } else if (menuSection) {
                menuSection.style.display = 'none';
            }

            // 평균 평점 계산
            let avgRating = 0;
            if (reviews.length > 0) {
                avgRating = reviews.reduce((sum, r) => {
                    const taste = parseFloat(r.TasteRating) || 0;
                    const portion = parseFloat(r.PortionRating) || 0;
                    const value = parseFloat(r.ValueRating) || 0;
                    const service = parseFloat(r.ServiceRating) || 0;
                    return sum + (taste + portion + value + service) / 4;
                }, 0) / reviews.length;
            }

            // 평점 업데이트
            const ratingScoreEl = restaurantCard.querySelector('.rating-score');
            if (ratingScoreEl) {
                ratingScoreEl.textContent = avgRating > 0 ? avgRating.toFixed(1) : '0.0';
            }

            // 리뷰 수 업데이트
            const reviewCountEl = restaurantCard.querySelector('.review-count');
            if (reviewCountEl) {
                reviewCountEl.textContent = reviews.length + '개 리뷰';
            }

            // 리뷰 컨테이너 완전히 교체
            const reviewContainer = restaurantCard.querySelector('.card-reviews');
            if (!reviewContainer) return;

            // 리뷰가 없을 때
            if (reviews.length === 0) {
                reviewContainer.innerHTML = `
                    <div class="reviews-header">
                        <span>리뷰 0개</span>
                    </div>
                    <div style="text-align: center; padding: 40px 20px; color: rgba(255, 255, 255, 0.7);">
                        아직 리뷰가 없습니다.<br>
                        첫 번째 리뷰를 작성해보세요!
                    </div>
                `;
                return;
            }

            // 리뷰가 있을 때 - 전체 HTML 재생성
            const moodEmojis = {
                '행복': '😊',
                '만족함': '😋',
                '보통': '😐',
                '별로': '😔',
                '나른함': '🤤',
                '화남': '😤'
            };

            let reviewsHTML = `
                <div class="reviews-header">
                    <span>리뷰 ${reviews.length}개</span>
                </div>
            `;

            // 모든 리뷰 표시
            reviews.forEach(record => {
                // 평균 평점 계산
                const recordAvgRating = (
                    (parseFloat(record.TasteRating) || 0) +
                    (parseFloat(record.PortionRating) || 0) +
                    (parseFloat(record.ValueRating) || 0) +
                    (parseFloat(record.ServiceRating) || 0)
                ) / 4;
                const stars = '⭐'.repeat(Math.round(recordAvgRating));
                const keywords = record.Keywords ? record.Keywords.split(', ').filter(k => k.trim()) : [];
                const timeAgo = getTimeAgo(new Date(record.Timestamp));

                reviewsHTML += `
                    <div class="review-item">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <span class="reviewer-name">익명</span>
                                <span class="divider">·</span>
                                <span class="reviewer-dept">${record.Department || ''}</span>
                            </div>
                            <div class="review-stars">${stars}</div>
                            <div class="review-menu-badge">
                                <span>${record.Menu || ''}</span>
                            </div>
                        </div>
                        <div class="review-time">${timeAgo}</div>
                        <div class="review-content">${record.Review || record.Keywords || '리뷰 내용이 없습니다.'}</div>
                        <div class="review-ratings">
                            <div class="rating-item-small">
                                <span>🍜 맛</span>
                                <span class="rating-point">${record.TasteRating || 0}점</span>
                            </div>
                            <div class="rating-item-small">
                                <span>🍽️ 양</span>
                                <span class="rating-point">${record.PortionRating || 0}점</span>
                            </div>
                            <div class="rating-item-small">
                                <span>💰 가성비</span>
                                <span class="rating-point">${record.ValueRating || 0}점</span>
                            </div>
                            <div class="rating-item-small">
                                <span>😊 서비스</span>
                                <span class="rating-point">${record.ServiceRating || 0}점</span>
                            </div>
                        </div>
                        ${keywords.length > 0 ? `
                        <div class="review-keywords">
                            ${keywords.map(k => `<span class="keyword-badge-small">${k.trim()}</span>`).join('')}
                        </div>
                        ` : ''}
                    </div>
                `;
            });

            reviewContainer.innerHTML = reviewsHTML;
            
            // 스크롤을 맨 위로 초기화
            reviewContainer.scrollTop = 0;
        }

        // Toast 알림 함수 (React 스타일)
        // ============================================
        // 🎨 UI 헬퍼 함수 (UI Helper Functions)
        // ============================================
        
        function showToast(message, type = 'success') {
            // 기존 토스트 제거
            const existingToast = document.querySelector('.toast-message');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = 'toast-message';
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? '#16a34a' : type === 'error' ? '#dc2626' : '#2d2d44'};
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
                z-index: 10000;
                animation: slideUp 0.3s ease-out;
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideDown 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // CSS 애니메이션 추가
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideUp {
                from {
                    opacity: 0;
                    transform: translate(-50%, 20px);
                }
                to {
                    opacity: 1;
                    transform: translate(-50%, 0);
                }
            }
            @keyframes slideDown {
                from {
                    opacity: 1;
                    transform: translate(-50%, 0);
                }
                to {
                    opacity: 0;
                    transform: translate(-50%, 20px);
                }
            }
            .screen {
                animation: fadeIn 0.3s ease-in;
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            
            /* 드롭다운 옵션 리스트 스타일 개선 */
            .form-select option {
                background-color: #FFFFFF !important;
                color: #111827 !important;
            }
            
            .form-select option:checked,
            .form-select option:focus,
            .form-select option:active,
            .form-select option[selected],
            .form-select option[value]:checked {
                background-color: #FD4B21 !important;
                background: #FD4B21 !important;
                color: #FFFFFF !important;
            }
            
            /* 브라우저 기본 파란색 제거 */
            .form-select option:checked {
                background: #FD4B21 !important;
                background-color: #FD4B21 !important;
                -webkit-appearance: none !important;
                -moz-appearance: none !important;
            }
            
            /* 선택된 옵션의 모든 상태에서 주황색 유지 */
            select.form-select option:checked,
            select.form-select option[selected="selected"],
            select.form-select option[selected],
            select.form-select option[value]:checked {
                background: #FD4B21 !important;
                background-color: #FD4B21 !important;
                color: #FFFFFF !important;
            }
            
            /* 브라우저 기본 파란색 완전 제거 */
            select.form-select option::-moz-selection,
            select.form-select option::selection {
                background: #FD4B21 !important;
                background-color: #FD4B21 !important;
                color: #FFFFFF !important;
            }
            
            /* 모든 option 요소에 주황색 강제 적용 */
            option:checked,
            option[selected],
            option[selected="selected"] {
                background: #FD4B21 !important;
                background-color: #FD4B21 !important;
                color: #FFFFFF !important;
            }
            
            .form-select option:hover {
                background-color: #F9FAFB !important;
                color: #111827 !important;
            }
            
            /* 드롭다운 리스트 배경 제거 - 모든 상태 */
            select.form-select,
            select.form-select:focus,
            select.form-select:active,
            select.form-select:focus-visible,
            select.form-select:focus-within,
            select.form-select:hover,
            select.form-select:visited {
                background-color: #FFFFFF !important;
                border: none !important;
                outline: none !important;
                box-shadow: none !important;
                -webkit-box-shadow: none !important;
                -moz-box-shadow: none !important;
                -webkit-tap-highlight-color: transparent !important;
            }
            
            select.form-select:focus {
                background-color: #F9FAFB !important;
            }
            
            /* 드롭다운 리스트 박스 테두리 제거 */
            select.form-select option,
            select.form-select optgroup {
                border: none !important;
                outline: none !important;
                -webkit-appearance: none !important;
                -moz-appearance: none !important;
            }
            
            /* 모든 브라우저에서 드롭다운 테두리 제거 */
            select.form-select::-webkit-select,
            select.form-select::-moz-select,
            select.form-select::select {
                border: none !important;
                outline: none !important;
            }
            
            /* 드롭다운이 열렸을 때 나타나는 리스트 박스 테두리 제거 */
            select.form-select:not([multiple]) {
                border: none !important;
            }
            
            /* 드롭다운 전용 포커스 스타일 */
            .form-select:focus,
            .form-select:active,
            .form-select:focus-visible {
                outline: none !important;
                border: none !important;
                box-shadow: none !important;
                -webkit-tap-highlight-color: transparent !important;
            }
            
            /* 드롭다운이 열렸을 때 나타나는 리스트 박스 스타일 */
            select.form-select {
                -webkit-appearance: none !important;
                -moz-appearance: none !important;
                appearance: none !important;
            }
            
            /* 모든 상태에서 테두리 제거 */
            select.form-select,
            select.form-select:focus,
            select.form-select:active,
            select.form-select:focus-visible,
            select.form-select:focus-within {
                border: 0 !important;
                border-width: 0 !important;
                border-style: none !important;
                border-color: transparent !important;
                outline: 0 !important;
                outline-width: 0 !important;
                outline-style: none !important;
                outline-color: transparent !important;
            }
        `;
        document.head.appendChild(style);
        
        // ============================================
        // 📱 Bottom Sheet 스크롤 처리 (성능 최적화)
        // ============================================
        
        // ============================================
        // 🎲 랜덤 추천 기능
        // ============================================
        
        // 음식 이미지 매핑 (imgur 링크)
        const foodImages = {
            '라떼': 'https://i.imgur.com/fU8aJCc.png',
            '탕후루': 'https://i.imgur.com/UifaJ65.png',
            '케이크': 'https://i.imgur.com/0qVOT1Y.png',
            '아메리카노': 'https://i.imgur.com/5agwTll.png',
            '아이스크림': 'https://i.imgur.com/PM7d148.png',
            '빙수': 'https://i.imgur.com/wr6ZvFI.png',
            '버블티': 'https://i.imgur.com/QM3Zkgs.png',
            '마카롱': 'https://i.imgur.com/ew2n2se.png',
            '초밥': 'https://i.imgur.com/8EsUeuK.png',
            '피자': 'https://i.imgur.com/wlE5Jjm.png',
            '돈가스': 'https://i.imgur.com/vJfIXJ6.png',
            '우동': 'https://i.imgur.com/thPFy81.png',
            '라멘': 'https://i.imgur.com/11SYqua.png',
            '햄버거': 'https://i.imgur.com/KzcMLTc.png',
            '소바': 'https://i.imgur.com/FgAo9Ev.png',
            '치킨': 'https://i.imgur.com/P9MV2Gk.png',
            '김치찌개': 'https://i.imgur.com/85tFlFV.png',
            '닭갈비': 'https://i.imgur.com/pPgauWC.png',
            '부대찌개': 'https://i.imgur.com/T0w0ids.png',
            '분식': 'https://i.imgur.com/6PDtLuf.png',
            '삼겹살': 'https://i.imgur.com/D7eYsuM.png',
            '순대국': 'https://i.imgur.com/ANswrNU.png',
            '짜글이': 'https://i.imgur.com/DBYMr5Y.png',
            '칼국수': 'https://i.imgur.com/Jt7JOI7.png',
            '회덮밥': 'https://i.imgur.com/JB5tJ6N.png',
            '순두부': 'https://i.imgur.com/I3ts2kR.png',
            '돈가스덮밥': 'https://i.imgur.com/LP6mmAM.png'
        };

        // 음식 이름과 설명 매핑
        const foodDescriptions = {
            '라떼': '부드럽고 달콤한 라떼 한 잔 어떠세요?',
            '탕후루': '달콤하고 바삭한 탕후루로 달콤함을 느껴보세요!',
            '케이크': '달콤한 케이크로 특별한 하루를 만들어보세요',
            '아메리카노': '깔끔한 아메리카노로 하루를 시작해보세요',
            '아이스크림': '시원하고 달콤한 아이스크림으로 기분 전환!',
            '빙수': '시원한 빙수로 더위를 날려보세요',
            '버블티': '쫄깃한 펄과 함께하는 달콤한 버블티',
            '마카롱': '예쁘고 달콤한 마카롱으로 달콤함을 즐기세요',
            '초밥': '신선한 초밥으로 일본의 맛을 경험해보세요',
            '피자': '치즈가 가득한 피자로 배를 든든하게!',
            '돈가스': '바삭하고 고소한 돈가스 정식',
            '우동': '쫄깃한 면발의 따뜻한 우동',
            '라멘': '진한 국물의 일본식 라멘',
            '햄버거': '든든하고 맛있는 햄버거',
            '소바': '깔끔한 맛의 메밀소바',
            '치킨': '바삭하고 매콤달콤한 치킨',
            '육개장': '얼큰하고 시원한 육개장',
            '김치찌개': '얼큰한 김치찌개로 밥도둑',
            '닭갈비': '매콤달콤한 닭갈비',
            '부대찌개': '다양한 재료가 들어간 부대찌개',
            '분식': '추억의 맛, 분식',
            '삼겹살': '고소한 삼겹살 구이',
            '순대국': '든든한 순대국밥',
            '짜글이': '얼큰한 국물의 짜글이',
            '칼국수': '쫄깃한 면발의 칼국수',
            '회덮밥': '신선한 회와 밥이 만나는 회덮밥',
            '순두부': '부드럽고 얼큰한 순두부찌개',
            '돈가스덮밥': '바삭한 돈가스와 달콤한 소스가 만난 덮밥'
        };

        // 랜덤 음식 추천 함수
        function getRandomFood() {
            const foodNames = Object.keys(foodImages);
            const randomIndex = Math.floor(Math.random() * foodNames.length);
            const foodName = foodNames[randomIndex];
            
            return {
                name: foodName,
                image: foodImages[foodName],
                description: foodDescriptions[foodName] || '맛있는 음식입니다!'
            };
        }

        // 랜덤 추천 결과 표시 (섹션 내에서)
        function showRandomRecommendation() {
            const randomSection = document.getElementById('randomSection');
            const randomResult = document.getElementById('randomResult');
            const foodImage = document.getElementById('randomFoodResultImage');
            const foodName = document.getElementById('randomFoodResultName');
            
            if (!randomSection || !randomResult || !foodImage || !foodName) return;
            
            const randomFood = getRandomFood();
            
            // 이미지와 이름 설정
            foodImage.src = randomFood.image;
            foodImage.alt = randomFood.name;
            foodName.textContent = randomFood.name;
            
            // 기존 내용 숨기고 결과 표시
            randomSection.classList.add('hide-content');
            randomResult.classList.add('show');
        }

        // 랜덤 추천 초기화 (다시 버튼으로 돌아가기)
        function resetRandomRecommendation() {
            const randomSection = document.getElementById('randomSection');
            const randomResult = document.getElementById('randomResult');
            
            if (randomSection && randomResult) {
                randomSection.classList.remove('hide-content');
                randomResult.classList.remove('show');
            }
        }

        // 랜덤 추천 버튼 이벤트
        document.addEventListener('DOMContentLoaded', function() {
            const randomBtn = document.getElementById('randomRecommendBtn');
            const randomRetryBtn = document.getElementById('randomRetryBtn');
            
            if (randomBtn) {
                randomBtn.addEventListener('click', showRandomRecommendation);
            }
            
            // 다시뽑기 버튼 클릭 시 다시 추천
            if (randomRetryBtn) {
                randomRetryBtn.addEventListener('click', function(e) {
                    e.stopPropagation(); // 이벤트 버블링 방지
                    showRandomRecommendation();
                });
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const restaurantCard = document.getElementById('restaurantCard');
            if (!restaurantCard) return;
            
            // 카드가 peek 상태일 때 스크롤하면 자동으로 위로 올라가도록
            let lastScrollTop = 0;
            let scrollThreshold = 30; // 스크롤 임계값 (px) - 더 낮게 설정
            let isOpening = false; // 이미 열리는 중인지 체크
            let scrollTimeout = null;
            
            // 스크롤 이벤트 리스너 (requestAnimationFrame으로 최적화)
            restaurantCard.addEventListener('scroll', function() {
                if (isOpening) return; // 이미 열리는 중이면 무시
                
                // 기존 timeout 취소
                if (scrollTimeout) {
                    cancelAnimationFrame(scrollTimeout);
                }
                
                // requestAnimationFrame으로 다음 프레임에 실행
                scrollTimeout = requestAnimationFrame(function() {
                    const currentScrollTop = restaurantCard.scrollTop;
                    
                    // peek 상태일 때만 처리
                    if (restaurantCard.classList.contains('peek')) {
                        // 위로 스크롤하면 (스크롤 위치가 줄어들면) 카드를 완전히 열기
                        if (currentScrollTop < lastScrollTop && currentScrollTop < scrollThreshold) {
                            isOpening = true;
                            // 위로 스크롤 중이고 임계값 이하이면 카드를 완전히 열기
                            restaurantCard.classList.remove('peek');
                            restaurantCard.classList.add('show');
                            restaurantCard.style.transform = 'translateX(-50%) translateY(0)';
                            
                            // 애니메이션 완료 후 플래그 리셋
                            setTimeout(() => {
                                isOpening = false;
                            }, 300);
                        }
                    }
                    
                    lastScrollTop = currentScrollTop;
                });
            }, { passive: true });
            
            // 마우스 휠 이벤트 (컴퓨터에서 더 빠르게 반응)
            let isClosing = false; // 닫는 중 플래그
            restaurantCard.addEventListener('wheel', function(e) {
                // peek 상태에서 위로 스크롤하면 카드 열기
                if (restaurantCard.classList.contains('peek') && !isOpening) {
                    if (e.deltaY < 0 && restaurantCard.scrollTop <= 10) {
                        isOpening = true;
                        restaurantCard.classList.remove('peek');
                        restaurantCard.classList.add('show');
                        restaurantCard.style.transform = 'translateX(-50%) translateY(0)';
                        
                        setTimeout(() => {
                            isOpening = false;
                        }, 300);
                    }
                    return;
                }
                
                // show 상태에서 아래로 스크롤하면 카드 닫기 (웹 전용)
                if (restaurantCard.classList.contains('show') && !isOpening && !isClosing) {
                    // 아래로 스크롤 (deltaY > 0)하고 스크롤이 맨 위에 있으면 카드 닫기
                    if (e.deltaY > 0 && restaurantCard.scrollTop <= 10) {
                        e.preventDefault(); // 기본 스크롤 동작 방지
                        isClosing = true;
                        closeRestaurantCard();
                        setTimeout(() => {
                            isClosing = false;
                        }, 300);
                    }
                }
            }, { passive: false }); // preventDefault를 사용하기 위해 passive: false로 변경
            
            // 터치 스크롤 감지 (모바일)
            let touchStartY = 0;
            let touchMoved = false;
            
            restaurantCard.addEventListener('touchstart', function(e) {
                if (this.classList.contains('peek') && !isOpening) {
                    touchStartY = e.touches[0].clientY;
                    touchMoved = false;
                }
            }, { passive: true });
            
            restaurantCard.addEventListener('touchmove', function(e) {
                if (!restaurantCard.classList.contains('peek') || isOpening || touchMoved) return;
                
                const touchY = e.touches[0].clientY;
                const deltaY = touchStartY - touchY; // 위로 스와이프하면 양수
                
                // 위로 스와이프하고 스크롤이 맨 위에 있으면 카드를 완전히 열기
                if (deltaY > 30 && restaurantCard.scrollTop <= 10) {
                    touchMoved = true;
                    isOpening = true;
                    restaurantCard.classList.remove('peek');
                    restaurantCard.classList.add('show');
                    restaurantCard.style.transform = 'translateX(-50%) translateY(0)';
                    
                    setTimeout(() => {
                        isOpening = false;
                    }, 300);
                }
            }, { passive: true });
        });
    </script>
</body>
</html>
